<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Part 3: Database Engineering Fundamentals: MemCached In-Memory database Architecture" /><meta name="author" content="Pravin Tripathi" /><meta property="og:locale" content="en" /><meta name="description" content="MemCached In-Memory database Architecture" /><meta property="og:description" content="MemCached In-Memory database Architecture" /><link rel="canonical" href="https://pravin.dev/database-engineering-fundamental-part-3/memcached-in-memory-database-architecture/" /><meta property="og:url" content="https://pravin.dev/database-engineering-fundamental-part-3/memcached-in-memory-database-architecture/" /><meta property="og:site_name" content="Pravin on Software" /><meta property="og:image" content="https://pravin.dev/header.png" /><meta property="og:image:height" content="900" /><meta property="og:image:width" content="1600" /><meta property="og:image:alt" content="Generated using Copilot" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-07-03T04:00:00+05:30" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://pravin.dev/header.png" /><meta name="twitter:image:alt" content="Generated using Copilot" /><meta property="twitter:title" content="Part 3: Database Engineering Fundamentals: MemCached In-Memory database Architecture" /><meta name="twitter:site" content="@pravin_yo" /><meta name="twitter:creator" content="@pravin_yo" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Pravin Tripathi","url":"https://www.linkedin.com/in/pravin-r-tripathi"},"dateModified":"2025-03-22T16:02:56+05:30","datePublished":"2024-07-03T04:00:00+05:30","description":"MemCached In-Memory database Architecture","headline":"Part 3: Database Engineering Fundamentals: MemCached In-Memory database Architecture","image":{"width":1600,"height":900,"alt":"Generated using Copilot","url":"https://pravin.dev/header.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://pravin.dev/database-engineering-fundamental-part-3/memcached-in-memory-database-architecture/"},"url":"https://pravin.dev/database-engineering-fundamental-part-3/memcached-in-memory-database-architecture/"}</script><title>Part 3: Database Engineering Fundamentals: MemCached In-Memory database Architecture | Pravin on Software</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Pravin on Software"><meta name="application-name" content="Pravin on Software"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Pravin on Software</a></div><div class="site-subtitle font-italic">My Learning and Experiments in Software Engineering</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/pravinyo" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/pravin_yo" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['pravinyo12','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Part 3: Database Engineering Fundamentals: MemCached In-Memory database Architecture</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Part 3: Database Engineering Fundamentals: MemCached In-Memory database Architecture</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1719959400" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 3, 2024 </em> </span> <span> Updated <em class="" data-ts="1742639576" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Mar 22, 2025 </em> </span><div class="mt-3 mb-3"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1600 900'%3E%3C/svg%3E" data-src="/assets/img/database-engineering-fundamental-part-3/header.png" class="preview-img bg" alt="Generated using Copilot" width="1600" height="900" data-proofer-ignore><figcaption class="pt-2 pb-2">Generated using Copilot</figcaption></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://www.linkedin.com/in/pravin-r-tripathi">Pravin Tripathi</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3514 words"> <em>19 min</em> read</span></div></div></div><div class="post-content"><h1 id="memcached-in-memory-database-architecture">MemCached In-Memory database Architecture</h1><h3 id="memcached-architecture"><span class="mr-2">Memcached Architecture</span><a href="#memcached-architecture" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Memcached is an in-memory key-value store originally written in Perl and later rewritten in C. It is popular with companies such as Facebook, Netflix and Wikipedia for its simplicity.</p><p>While the word “simple” has lost its meaning when it comes to describing software, I think Memcached is one of the few remaining software that is truly simple. Memcached doesn’t try to have fancy features like persistence or rich data types. Even the distributed cache is the responsibility of the client not Memcached server.</p><p>Memcached backend has one job only, an in-memory key value store.</p><h3 id="to-cache-is-a-cop-out"><span class="mr-2">To Cache is a cop-out</span><a href="#to-cache-is-a-cop-out" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Memcached is used as a cache for slow database queries or HTTP responses that are expensive to compute. While caching is critical for scalability, it should only be used as a last resort, let me explain.</p><p>I think running a cache for every encountered slow query is cop-out. I believe understanding the cause of performance degradation is key, otherwise the cache is just a duct-tape. If it is a database query, look at the plan, do you need an index? Are there a lot logic reads can you rewrite the query or include an additional filter predict to minimize the search space?</p><p>If it is an RPC, consider why are the calls chatty in the first place and can you eliminate the calls at the client side. Often times libraries and framework issue a fleet of queries when mis-used. Another reason black-boxes must be understood.</p><p>After running out of tuning options a cache might be needed, and that’s where Memcached is best suited for.</p><h3 id="memcached-architecture-1"><span class="mr-2">Memcached Architecture</span><a href="#memcached-architecture-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>In this article I’d like to do a deep dive into the architecture of Memcached and how the devs fought to keep it simple and feature-stripped. I’ll give my opinion on certain components that I believed should have been an option.</p><p>I’ll cover the following topics in this article.</p><ul><li>Memory Management<li>Threading<li>LRU<li>Read/Writes<li>Collisions<li>Distributed Cache<li>Demo</ul><h3 id="what-is-memcached"><span class="mr-2">What is Memcached?</span><a href="#what-is-memcached" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Memcached is a key-value store used as a cache. It is designed to be simple and is, therefore, limited in some ways. These limitations can also be looked at as features because they make Memcached transparent.</p><p>Keys in Memcached are strings, and they are limited to 250 characters. Values can be any type, but they are limited to 1 MB by default. Keys also have an expiration date or time to live (TTL). However, this should not be relied on, as the least recently used (LRU) algorithm may remove expired keys before they are accessed. Memcached is a good choice for caching expensive queries, but it should not be relied on for persistent or durable storage. Always build your application around Memcached not having what you want. Plan for the worse, hope for the best.</p><h3 id="memory-management"><span class="mr-2">Memory Management</span><a href="#memory-management" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>When allocating items like arrays, strings or integers, they usually go to random places in the process memory. This leaves small gaps of unused memory scattered across the physical memory, a problem referred to as fragmentation.</p><p><img data-src="/assets/img/database-engineering-fundamental-part-3/2023-08-25_15-55-11-e39c5b6bb9455ae49b7920c205b7a132.png" alt="" data-proofer-ignore></p><p>Fragmented memory</p><p>Fragmentation occurs when the gaps between allocated items continue to increase. This makes it difficult to find a contiguous block of memory that is large enough to hold new items. Technically there might be enough memory to hold the item but the memory is scattered all over the physical space.</p><p>Does that mean that the item fails to store if no contiguous memory exists? Not really, with the help of virtual memory, the OS gives the illusion that the app is using a contiguous block of memory. Behind the scenes, this block is mapped to tiny small areas in physical memory.</p><p>When fragmentation occurs, it can cause a program to run more slowly, as the system assembles the memory fragments. The cost of virtual memory mapping and the cost of multiple I/Os to fetch what could have been a single block of memory is relatively high. That is why we try to avoid memory fragmentation.</p><p>Memcached avoids fragmentation by pre-allocating 1 MB-sized memory pages, which is why values are capped to 1 MB by default.</p><p><img data-src="/assets/img/database-engineering-fundamental-part-3/2023-08-25_15-55-11-a4cfce7ccee0b103de9189164686b67d.png" alt="" data-proofer-ignore></p><p>Memcached allocates pages</p><p>The operating system thinks that Memcached is using the allocated memory, but Memcached isn’t storing anything in it yet. As new items are created, Memcached will write items to the allocated page forcing the items to be next to each other. This avoids fragmentation by moving memory management to Memcached instead of the OS.</p><p>The pages are divided into equal size Chunks. The chunk has a fixed size determined by the slab class. A slab class defines the chunk size, for example Slab class 1 has a chunk size of 72 bytes while slab class 43 has a chunk size of a 1MB.</p><p><img data-src="/assets/img/database-engineering-fundamental-part-3/2023-08-25_15-55-12-5e287752c26c2af9faf2d8324530c592.png" alt="" data-proofer-ignore></p><p>Pages of slab class 1 (72 bytes) stores 14563 chunks per page.</p><p><img data-src="/assets/img/database-engineering-fundamental-part-3/2023-08-25_15-55-12-773173b025f866cbb08c094a05097ae0.png" alt="" data-proofer-ignore></p><p>Pages of slab class 43 (1MB) stores 1 chunk per page</p><p>Items consistent of key, value and some metadata and they are stored in chunks. For example, If the item size is 40 bytes in size, a whole chunk is used to store the item. The closest chunk size to the 40 bytes item is 72 bytes which is slab class 1, leaving 32 bytes unused in chunk. That is why the client should be smart to pick items that fit nicely in chunks leaving as little unused space as possible.</p><p>Memcached tries to minimize the unused space by putting the item in the most appropriate slab class. Each slab class has multiple pages. Slab class 1, there are 14,563 chunks per page since each chunk is 72 bytes. If an item is less than or equal 72 bytes, it’ll fit nicely in the chunk. But if the item is larger, say 900 kilobytes, it doesn’t fit slab class 1. So, Memcached finds a slab class appropriate for the item. Slab class 43 of chunk size 1MB is the closest one, and the item will be put in that chunk. The entire item fits in a single page.</p><blockquote><p>Note that we don’t need to allocate memory for the item because the memory is already pre-allocated.</p></blockquote><p><img data-src="/assets/img/database-engineering-fundamental-part-3/2023-08-25_15-55-12-dbddc90028071b4c00c4ae8a4ae6bb3f.png" alt="" data-proofer-ignore></p><p>Memcached fits items in the appropriate chunk size</p><p>Let’s take a new example where there is a new item of size 40 bytes, but all allocated pages for this slab class are full, so the item can’t be inserted.</p><p><img data-src="/assets/img/database-engineering-fundamental-part-3/2023-08-25_15-55-12-8a7aed926d9167ac1387f7237a231604.png" alt="" data-proofer-ignore></p><p>Slab class 1 is full</p><p>Memcached handles this by allocating a new page and storing the item in a free chunk.</p><p><img data-src="/assets/img/database-engineering-fundamental-part-3/2023-08-25_15-55-12-a766cce396c91b55d1829e802e9d4a94.png" alt="" data-proofer-ignore></p><p>A new page is allocated and the new item is placed</p><h3 id="threading"><span class="mr-2">Threading</span><a href="#threading" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Memcached accepts remote clients, it has to have networking. Memcached uses TCP as its native transport they support. UDP is also supported but was disabled by default because of an attack that happened in 2018 called the reflection attack.</p><p>The Memcached listener thread creates a TCP socket to listen on port 11211. It has one thread that spins up and listens for incoming connections. This thread creates a socket and accepts incoming connections.</p><p>Memcached then distributes the connections to a pool of threads. When a new connection is established, Memcached allocates a thread from the pool and gives the connection file descriptor to that thread. That worker thread is now responsible of reading data from the connection.</p><p>If a stream of data or request to get a key is sent to the connection, the thread polls the file descriptor to read the request. Each thread can hosts one or more connections and the number of threads in the pool can be configured.</p><p><img data-src="/assets/img/database-engineering-fundamental-part-3/2023-08-25_15-55-12-a8b42dfac5bdaed9419c1f680bcaa0fa.png" alt="" data-proofer-ignore></p><p>Listener thread accepts connection and distribute them to worker threads</p><p>Threading was more critical years ago when asynchronous workload wasn’t as abundant it is in 2022. You see when a thread reads from a connection, this operation used to be blocking in the early 2000s. The thread cannot do anything else until it gets the data. Engineers realized that this isn’t scalable and asynchronous I/O was born. Almost all read calls are now asynchronous, this means the thread can call read on one connection and move on to serve other connection.</p><p>However, the threading is still important in Memcached because read/write involves some CPU time in hashing and LRU computations. That one thread doing all this work for all connections might not scale.</p><h3 id="lru-least-recently-used"><span class="mr-2">LRU (Least Recently Used)</span><a href="#lru-least-recently-used" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The problem with memory is it’s limited. If you store a lot of keys, even with good expiration dates, memory eventually fills up. What would you do when memory is full?</p><p>Well, you have two options as an architect.</p><ul><li>Block new inserts and return an error to the client to free some items<li>Release old unused items</ul><p>Memcached did the latter. This is where I wished they made this an option. It is as if I’m with the designers in the room arguing what to do. Having an LRU complicated Memcached and stripped it from its pure simplicity. The voice of reason has lost, and instead the client convenience won. Alas, it is what it is.</p><p>Memcached releases anything in memory that hasn’t been used for a very long time. That’s another reason why Memcached is called transient memory. Even if you set the expiration for an hour, you can’t rely on the key being there before the hour expires. It can be released at any time, which is another limitation (or feature!) of Memcached.</p><p>Memcached uses a data structure called a linked list LRU (Least recently used) to release items when memory is full. Every item in the Memcached key-value store is in the linked list, and every slab class has its own LRU.</p><p>If an item is accessed, it is moved from its current position to the head. This process is repeated every time an item is accessed. As a result, items that are not used frequently will be pushed down to the tail of the list and eventually removed if the memory becomes full.</p><p><img data-src="/assets/img/database-engineering-fundamental-part-3/2023-08-25_15-55-12-4f430e5912d5adda7ed49dae269d7067.png" alt="" data-proofer-ignore></p><p>LRU</p><p>Here is a big picture of the LRU cache. I derived this from reading the source code and the Memcached doc. In the diagram, we have pages and chunks. Each chunk is included in an LRU cache with a head and a tail pointer, and every item between the head and tail are linked to each other.</p><p><img data-src="/assets/img/database-engineering-fundamental-part-3/2023-08-25_15-55-12-28ed5c875e7128967a235c6dfb33afb9.png" alt="" data-proofer-ignore></p><p>While the LRU is useful, it can also be quite costly in terms of performance. The locks that are necessary to maintain LRU can slow down throughput and complicate the application. If LRU was an option that could be disabled, Memcached could have remained simple. This would allow users to allocate a certain amount of memory to Memcached without having to worry about the overhead of managing LRU. The responsibility to free up items becomes the client’s.</p><h3 id="lru-locking"><span class="mr-2">LRU Locking</span><a href="#lru-locking" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>No two threads can update the same data structure concurrently. To solve this, the thread that needs to update any data structure in memory must obtain a mutex and other threads wait for the mutex to be freed. This is the basic locking model and it is used in all applications. Memcached is no different with the LRU data structures.</p><p>The original Memcached design had one global lock — all operations and LRU management were serialized rendering multi-threaded not as effective. As a result, clients could not access two different items at the same time, all reads were serialized.</p><p>Memcached fixed this by updating the locking model to LRU per slab class. This means clients can access two items from different slab classes without waits. However, they are still serialized when accessing two items from the same slab class because the LRU needs to get updated. This was later improved by minimizing the LRU updates to once every 60 seconds which allowed for multiple items to be accessed. However this wasn’t good enough.</p><p>In 2018, Memcached completely redesigned the LRU to introduce sub-LRUs per slab class breaking it by temperature. This has significantly reduced locking and improved performance, but still the locking remained for items within the same temperature.</p><p><img data-src="/assets/img/database-engineering-fundamental-part-3/2023-08-25_15-55-12-dd1aa2c65a4ea09df28a70f7ff53e3ef.png" alt="" data-proofer-ignore></p><p>Memcached New LRU design (image memcached.org)</p><p>Now you know why I wished LRU was an option.</p><h3 id="reads-and-writes"><span class="mr-2">Reads and Writes</span><a href="#reads-and-writes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h3 id="reads"><span class="mr-2">Reads</span><a href="#reads" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Let’s go through a read example in Memcached. To identify where the item lives in memory for a given key, Memcached uses hash tables. A hash table is an associative array. The beauty of an associative array is that it is consecutive, meaning that if you have an array of 1000 elements, accessing elements 7, 12, 24, 33, or 1 is just as fast because you know the index. Once you know the index, you can immediately go to that location in memory.</p><p>With hash tables, you don’t have an index — you have a key. The trick is to convert the key to an index and then access the element. We take the key and calculate its hash and do a modulus of the hash table size. Let us take an example</p><p>To read key <em>“test”</em> we hash “test” and then do modulus N where N is the size of the array of the hash table. This will give us a number between 0 and N — 1. This number can be used to index into the hash table and get the value for the key. This all happens in O(1) time.</p><p>The value of the key takes you to the page on the specific slab class for that item. When we read the value, we update the slab class LRU by pushing the item to the LRU head. This requires a mutex lock on the LRU data structure so multiple threads don’t corrupt the LRU.</p><blockquote><p>Note that if two items are trying to be read of the same slab class, then the reads are serialized because the LRU needs to be locked.</p></blockquote><p><img data-src="/assets/img/database-engineering-fundamental-part-3/2023-08-25_15-55-13-697f85b9fdad70d58696c10f6ab95f08.gif" alt="" data-proofer-ignore></p><p>Reading key “test”</p><p>When key <em>test</em> is read, and we get item <em>d</em>, the LRU is updated so that d is now in the head of the linked list.</p><p><img data-src="/assets/img/database-engineering-fundamental-part-3/2023-08-25_15-55-13-eef79f368ab6c15522850bf88daee675.png" alt="" data-proofer-ignore></p><p>d is at the head of LRU</p><p>What happens if we read the key <em>buzz</em> pointing to item <em>c</em>? The LRU is updated so that <em>c</em> is now the head right after <em>d</em>.</p><p><img data-src="/assets/img/database-engineering-fundamental-part-3/2023-08-25_15-55-13-4f0f9618412b07388c6239e91e14cd82.png" alt="" data-proofer-ignore></p><p>c is now the head, followed by d</p><h3 id="writes"><span class="mr-2">Writes</span><a href="#writes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>If we need to write a key with a new value of 44 bytes, we first need to calculate the hash and find its index in the hash table. If the index location is empty, a new pointer is created, and a slab class is allocated with a chunk. The item is then placed in memory, with the chunk fitting into the appropriate slab class.</p><p><img data-src="/assets/img/database-engineering-fundamental-part-3/2023-08-25_15-55-13-6ec529201f083704a077760509c4058a.gif" alt="" data-proofer-ignore></p><p>Writing to key</p><h3 id="collisions"><span class="mr-2">Collisions</span><a href="#collisions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Because hashing maps keys to a fixed size, two keys may hash to the same index causing a collision. Let’s say I’m going to write a new key called “<em>Nani</em>”. The hash of <em>“Nani”</em> collides with another existing key.</p><p>To solve this, Memcached makes each index in the hash table map to a chain of items as opposed to the item directly. We add the key <em>“Nani”</em> to the chain which has now two items. When the key is read, all items in the chain need to be looked up to determine which one matches the desired key, giving us a O(N) at worse case. Here is an example</p><p><img data-src="/assets/img/database-engineering-fundamental-part-3/2023-08-25_15-55-13-606e6fa85c7dfd1b2ccfd09c4fca8929.gif" alt="" data-proofer-ignore></p><p>Write and Read Collision</p><p>Memcached measures the growth of these chains. If the growth is too excessive, read performance may suffer. To read a key the entire collision chain must be looked up to find actual key. The longer the collision chain, the slower the read.</p><p>If the performance of the reads starts to decrease, Memcached does a hash resize and shifts everything around to flatten the structure down.</p><h3 id="distributed-cache"><span class="mr-2">Distributed Cache</span><a href="#distributed-cache" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Memcached servers are isolated — servers don’t talk to each other. I absolutely love the simplicity and elegance of this design. If you want to distribute your keys, the clients have to do that, and you can build your own Memcached client to do just that.</p><p><img data-src="/assets/img/database-engineering-fundamental-part-3/2023-08-25_15-55-13-0084dc0eeab8d4674e3c79938089a544.png" alt="" data-proofer-ignore></p><p>Having servers communicate complicates the architecture significantly. Just like at zookeeper.</p><h3 id="telnet-demo"><span class="mr-2">Telnet Demo</span><a href="#telnet-demo" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>In this demo, we’re going to spin up a bunch of Memcached Docker instances. You’ll need to have Docker installed and have a Docker account because the Memcached image is locked behind an account. Once you do that, you can download the image, and you can spin up as many Memcached instances as you want. One thing to note is that Memcached does not support authentication, so you’ll have to implement authentication yourself.</p><p>The first thing we’re going to do is spin up a Docker container that has a Memcached instance. This can be done with the following command. We can add <code class="language-plaintext highlighter-rouge">-d</code> to avoid blocking the terminal.</p><p><code class="language-plaintext highlighter-rouge">docker run --name mem1 -p 11211:11211 -d memcached</code></p><p>Run <code class="language-plaintext highlighter-rouge">docker ps</code> to ensure that the image is running.</p><p>Let’s test it out with <code class="language-plaintext highlighter-rouge">telnet</code>. Run <code class="language-plaintext highlighter-rouge">telnet husseinmac 11211</code> , replace <code class="language-plaintext highlighter-rouge">husseinmac</code> with your hostname. You should be logged in once this happens and can issue commands like <code class="language-plaintext highlighter-rouge">stats</code>.</p><p>We can also set key-value pairs in this console. For example, <code class="language-plaintext highlighter-rouge">set foo 0 3600 2</code>. <code class="language-plaintext highlighter-rouge">foo</code> is the name of the key, <code class="language-plaintext highlighter-rouge">0</code> is the flags, <code class="language-plaintext highlighter-rouge">3600</code> is the TTL, and <code class="language-plaintext highlighter-rouge">2</code> is the # of characters. Once you hit enter, it’ll prompt you for the value of the <code class="language-plaintext highlighter-rouge">foo</code> key. The value of the key should exactly match the # of characters that was set in the <code class="language-plaintext highlighter-rouge">set</code> command. The key-value pair can be read with the <code class="language-plaintext highlighter-rouge">get</code> command: <code class="language-plaintext highlighter-rouge">get foo</code>. It can be deleted with <code class="language-plaintext highlighter-rouge">delete foo</code>.</p><p>The interesting part of this demo is talking about the architecture of Memcached. You’ll notice that once you have added your <code class="language-plaintext highlighter-rouge">foo</code> key, you can type in <code class="language-plaintext highlighter-rouge">stats slabs</code> to get the slab statistics. You’ll see that there is one slab class (see <code class="language-plaintext highlighter-rouge">STAT 1</code>, the 1 represents the slab class). Additionally, you can see a lot of interesting statistics about chunks, pages, hits, the total amount of memory used, etc…</p><h3 id="distributed-memcached-with-nodejs"><span class="mr-2">Distributed Memcached with NodeJS</span><a href="#distributed-memcached-with-nodejs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>To test the distributed cache, NodeJS provides a smart client that supports a pool of memcached instances. First let us connect to a single memcached instance from NodeJS and write a bunch of keys.</p><p>Create a folder for your project <code class="language-plaintext highlighter-rouge">mkdir nodemem</code> and <code class="language-plaintext highlighter-rouge">cd</code> into it. Then, initialize the project with <code class="language-plaintext highlighter-rouge">npm init -y</code>. Next, we’ll create an <code class="language-plaintext highlighter-rouge">index.js</code> file with the contents: Note: you’ll need to replace <code class="language-plaintext highlighter-rouge">husseinmac</code> with your hostname.</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>  <span class="kd">const</span> <span class="nx">MEMCACHED</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">memcached</span><span class="dl">"</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">serverPool</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MEMCACHED</span><span class="p">([</span><span class="dl">"</span><span class="s2">husseinmac:11211</span><span class="dl">"</span><span class="p">]);</span>
 
  <span class="kd">function</span> <span class="nf">run</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">].</span><span class="nf">forEach</span><span class="p">(</span><span class="nx">a</span> <span class="o">=&gt;</span> <span class="nx">serverPool</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="dl">"</span><span class="s2">foo</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">a</span><span class="p">,</span> <span class="dl">"</span><span class="s2">bar</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">a</span><span class="p">,</span> <span class="mi">3600</span><span class="p">,</span> <span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">err</span><span class="p">)))</span>
  <span class="p">}</span>
  
  <span class="nf">run</span><span class="p">();</span>
</pre></table></code></div></div><p>This piece of code uses the Memcached Node.js client and initializes a server pool of Memcached servers. Then, it adds a nine key-value pairs of the format <code class="language-plaintext highlighter-rouge">foo1: bar1</code>, <code class="language-plaintext highlighter-rouge">foo2: bar2</code>, etc… to the Memcached server pool.</p><p>Before running the script, we’ll need to install the Memcached Node.js client with <code class="language-plaintext highlighter-rouge">npm install memcached</code>. Then run the code with</p><p><code class="language-plaintext highlighter-rouge">node index.js</code></p><p>After the script runs, you should be able to <code class="language-plaintext highlighter-rouge">telnet</code> into the Memcached server and read the key-value pairs with <code class="language-plaintext highlighter-rouge">get foo1</code>, <code class="language-plaintext highlighter-rouge">get foo2.</code> All keys will be stored in the 11211 server.</p><p>Now, let us spin up even more memcached instances:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>docker run <span class="nt">--name</span> mem2 <span class="nt">-p</span> 11212:11211 <span class="nt">-d</span> memcached
docker run <span class="nt">--name</span> mem3 <span class="nt">-p</span> 11213:11211 <span class="nt">-d</span> memcached
docker run <span class="nt">--name</span> mem4 <span class="nt">-p</span> 11214:11211 <span class="nt">-d</span> memcached
</pre></table></code></div></div><p>Once you start the containers, you’ll need to add the servers to the pool in your Node.js script:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>  <span class="kd">const</span> <span class="nx">MEMCACHED</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">memcached</span><span class="dl">"</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">serverPool</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MEMCACHED</span><span class="p">([</span><span class="dl">"</span><span class="s2">husseinmac:11211</span><span class="dl">"</span><span class="p">,</span> 
    <span class="dl">"</span><span class="s2">husseinmac:11212</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">husseinmac:11213</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">husseinmac:11214</span><span class="dl">"</span><span class="p">]);</span>

  <span class="kd">function</span> <span class="nf">run</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">].</span><span class="nf">forEach</span><span class="p">(</span><span class="nx">a</span> <span class="o">=&gt;</span> <span class="nx">serverPool</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="dl">"</span><span class="s2">foo</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">a</span><span class="p">,</span> <span class="dl">"</span><span class="s2">bar</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">a</span><span class="p">,</span> <span class="mi">3600</span><span class="p">,</span> <span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">err</span><span class="p">)))</span>
  <span class="p">}</span>

  <span class="nf">run</span><span class="p">();</span>
</pre></table></code></div></div><p>Once you run this script, you’ll notice that all the key-value pairs will be distributed to all 4 servers. Try it! <code class="language-plaintext highlighter-rouge">telnet</code> into the Memcached servers and run <code class="language-plaintext highlighter-rouge">get foo1</code>, <code class="language-plaintext highlighter-rouge">get foo2</code>, etc… to see which key-value pairs are where. This happens because the Node.js client picks one server in the pool to put the key-value pair based on its own hashing algorithm.</p><p>For reading, the NodeJS memcached client will do a hash to find which server has the key and issue a command to that server. Note that this hashing is different from the hash performed by memcached.</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre> <span class="kd">const</span> <span class="nx">MEMCACHED</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">memcached</span><span class="dl">"</span><span class="p">);</span>
 <span class="kd">const</span> <span class="nx">serverPool</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MEMCACHED</span><span class="p">([</span><span class="dl">"</span><span class="s2">husseinmac:11211</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">husseinmac:11212</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">husseinmac:11213</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">husseinmac:11214</span><span class="dl">"</span><span class="p">]);</span>
 
 <span class="kd">function</span> <span class="nf">run</span><span class="p">()</span> <span class="p">{</span>
  <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">].</span><span class="nf">forEach</span><span class="p">(</span><span class="nx">a</span> <span class="o">=&gt;</span> <span class="nx">serverPool</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="dl">"</span><span class="s2">foo</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">a</span><span class="p">,</span> <span class="dl">"</span><span class="s2">bar</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">a</span><span class="p">,</span> <span class="mi">3600</span><span class="p">,</span> <span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">err</span><span class="p">)))</span>
 <span class="p">}</span>
 
 <span class="kd">function</span> <span class="nf">read</span><span class="p">()</span> <span class="p">{</span>
  <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">].</span><span class="nf">forEach</span><span class="p">(</span><span class="nx">a</span> <span class="o">=&gt;</span> <span class="nx">serverPool</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">foo</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">a</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">data</span><span class="p">)))</span>
 <span class="p">}</span>
 
 <span class="nf">read</span><span class="p">();</span>
</pre></table></code></div></div><p>If you run this with <code class="language-plaintext highlighter-rouge">node index.js</code>, you’ll notice that all the values will show up despite not all Memcached servers having all the answers.</p><h3 id="summary"><span class="mr-2">Summary</span><a href="#summary" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>In this article, we talked about the Memcached architecture. We discussed the memory management and the importance to use slabs and pages to allocate memory to avoid fragmentation. We also talked about the LRU, which, in my opinion, should have been an option the user can disable. Next, we talked about threads which improve performance for high number of connections. We went through some examples of reads and writes with Memcached and how locking impacts them. Finally, we talked about the distributed cache architecture with a demo using Node.</p><p><a href="/database-engineering-fundamental-part-3/">Back to Parent Page</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/blogging/'>Blogging</a>, <a href='/categories/article/'>Article</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/softwareengineering/" class="post-tag no-text-decoration" >softwareengineering</a> <a href="/tags/backenddevelopment/" class="post-tag no-text-decoration" >backenddevelopment</a> <a href="/tags/database-engineering/" class="post-tag no-text-decoration" >database-engineering</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Part+3%3A+Database+Engineering+Fundamentals%3A+MemCached+In-Memory+database+Architecture+-+Pravin+on+Software&url=https%3A%2F%2Fpravin.dev%2Fdatabase-engineering-fundamental-part-3%2Fmemcached-in-memory-database-architecture%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Part+3%3A+Database+Engineering+Fundamentals%3A+MemCached+In-Memory+database+Architecture+-+Pravin+on+Software&u=https%3A%2F%2Fpravin.dev%2Fdatabase-engineering-fundamental-part-3%2Fmemcached-in-memory-database-architecture%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fpravin.dev%2Fdatabase-engineering-fundamental-part-3%2Fmemcached-in-memory-database-architecture%2F&text=Part+3%3A+Database+Engineering+Fundamentals%3A+MemCached+In-Memory+database+Architecture+-+Pravin+on+Software" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fpravin.dev%2Fdatabase-engineering-fundamental-part-3%2Fmemcached-in-memory-database-architecture%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/database-engineering-fundamental-part-2/">Part 2: Database Engineering Fundamentals</a><li><a href="/posts/system-design-roadmap/">Comprehensive Roadmap for Low-Level and High-Level Design Interview Preparation</a><li><a href="/database-engineering-fundamental-part-5/write-amplification-problem-in-postgresql/">Part 5: Database Engineering Fundamentals: Write Amplification Problem in PostgreSQL</a><li><a href="/database-engineering-fundamental-part-1/">Part 1: Database Engineering Fundamentals</a><li><a href="/database-engineering-fundamental-part-1/database-page/">Part 1: Database Engineering Fundamentals: Database Page</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/backenddevelopment/">backenddevelopment</a> <a class="post-tag" href="/tags/softwareengineering/">softwareengineering</a> <a class="post-tag" href="/tags/database-engineering/">database-engineering</a> <a class="post-tag" href="/tags/design/">design</a> <a class="post-tag" href="/tags/coding/">coding</a> <a class="post-tag" href="/tags/smells/">smells</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/nodejs/">nodejs</a> <a class="post-tag" href="/tags/softwaredevelopment/">softwaredevelopment</a> <a class="post-tag" href="/tags/aws/">aws</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/database-engineering-fundamental-part-5/write-amplification-problem-in-postgresql/"><div class="card-body"> <em class="small" data-ts="1720157400" data-df="ll" > Jul 5, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Part 5: Database Engineering Fundamentals: Write Amplification Problem in PostgreSQL</h3><div class="text-muted small"><p> Write Amplification Problem in PostgreSQL Write Amplification Problem in PostgreSQL The Write Amplification Problem (WAP) typically arises in systems using Solid State Drives (SSDs) or other stor...</p></div></div></a></div><div class="card"> <a href="/database-engineering-fundamental-part-1/"><div class="card-body"> <em class="small" data-ts="1719775800" data-df="ll" > Jul 1, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Part 1: Database Engineering Fundamentals</h3><div class="text-muted small"><p> Table of Contents ACID Properties Understanding Database Internals Row-Based vs Column-Based Databases Primary Key vs Secondary Key Database Indexing SQL Query Planner and Optimizer ...</p></div></div></a></div><div class="card"> <a href="/database-engineering-fundamental-part-1/database-page/"><div class="card-body"> <em class="small" data-ts="1719779400" data-df="ll" > Jul 1, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Part 1: Database Engineering Fundamentals: Database Page</h3><div class="text-muted small"><p> Databases Pages (Article) Database Pages — A deep dive Databases often use fixed-size pages to store data. Tables, collections, rows, columns, indexes, sequences, documents and more eventually en...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/database-engineering-fundamental-part-3/" class="btn btn-outline-primary" prompt="Older"><p>Part 3: Database Engineering Fundamentals</p></a> <a href="/database-engineering-fundamental-part-3/mongodb-collection-clustered-index/" class="btn btn-outline-primary" prompt="Newer"><p>Part 3: Database Engineering Fundamentals: MongoDB collection clustered index</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://pravin.dev/database-engineering-fundamental-part-3/memcached-in-memory-database-architecture/'; this.page.identifier = '/database-engineering-fundamental-part-3/memcached-in-memory-database-architecture/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://pravin-dev.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://www.linkedin.com/in/pravin-r-tripathi">Pravin Tripathi</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/backenddevelopment/">backenddevelopment</a> <a class="post-tag" href="/tags/softwareengineering/">softwareengineering</a> <a class="post-tag" href="/tags/database-engineering/">database-engineering</a> <a class="post-tag" href="/tags/design/">design</a> <a class="post-tag" href="/tags/coding/">coding</a> <a class="post-tag" href="/tags/smells/">smells</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/nodejs/">nodejs</a> <a class="post-tag" href="/tags/softwaredevelopment/">softwaredevelopment</a> <a class="post-tag" href="/tags/aws/">aws</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-WP90FFJ6SJ"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-WP90FFJ6SJ'); }); </script>
