<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Code Smell Series: Shh…something is happening there" /><meta name="author" content="Pravin Tripathi" /><meta property="og:locale" content="en" /><meta name="description" content="…Shh…let me tell you…something is happening in that code." /><meta property="og:description" content="…Shh…let me tell you…something is happening in that code." /><link rel="canonical" href="https://pravin.dev/posts/code-smell-series-ssh-something-is-happening/" /><meta property="og:url" content="https://pravin.dev/posts/code-smell-series-ssh-something-is-happening/" /><meta property="og:site_name" content="Pravin on Software" /><meta property="og:image" content="https://pravin.dev/header.jpg" /><meta property="og:image:height" content="400" /><meta property="og:image:width" content="1000" /><meta property="og:image:alt" content="Image by Michal Jarmoluk from Pixabay" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-07-02T00:00:00+05:30" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://pravin.dev/header.jpg" /><meta name="twitter:image:alt" content="Image by Michal Jarmoluk from Pixabay" /><meta property="twitter:title" content="Code Smell Series: Shh…something is happening there" /><meta name="twitter:site" content="@pravin_yo" /><meta name="twitter:creator" content="@pravin_yo" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Pravin Tripathi","url":"https://www.linkedin.com/in/pravin-r-tripathi"},"dateModified":"2022-07-02T00:00:00+05:30","datePublished":"2022-07-02T00:00:00+05:30","description":"…Shh…let me tell you…something is happening in that code.","headline":"Code Smell Series: Shh…something is happening there","image":{"width":1000,"height":400,"alt":"Image by Michal Jarmoluk from Pixabay","url":"https://pravin.dev/header.jpg","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://pravin.dev/posts/code-smell-series-ssh-something-is-happening/"},"url":"https://pravin.dev/posts/code-smell-series-ssh-something-is-happening/"}</script><title>Code Smell Series: Shh…something is happening there | Pravin on Software</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Pravin on Software"><meta name="application-name" content="Pravin on Software"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Pravin on Software</a></div><div class="site-subtitle font-italic">My Learning and Experiments in Software Engineering</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/pravinyo" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/pravin_yo" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['pravinyo12','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Code Smell Series: Shh…something is happening there</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Code Smell Series: Shh…something is happening there</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1656700200" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 2, 2022 </em> </span><div class="mt-3 mb-3"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1000 400'%3E%3C/svg%3E" data-src="/assets/img/code-smell-series/ssh-something-is-happening/header.jpg" class="preview-img bg" alt="Image by Michal Jarmoluk from Pixabay" width="1000" height="400" data-proofer-ignore><figcaption class="pt-2 pb-2">Image by Michal Jarmoluk from Pixabay</figcaption></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://www.linkedin.com/in/pravin-r-tripathi">Pravin Tripathi</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1061 words"> <em>5 min</em> read</span></div></div></div><div class="post-content"><blockquote class="prompt-warning"><div><p>…Shh…let me tell you…something is happening in that code.</p></div></blockquote><p>Last month, I encountered one problem in the code. That code act as a decision-maker to decide the next step in the application, based on the decision from the human(Team Dispatcher), which is an async task and takes time.</p><h2 id="the-problem"><span class="mr-2">The Problem</span><a href="#the-problem" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The problem was that decision-maker implementation was complex and was doing many things. Things were happening behind every line of code, Which is difficult to understand even if you read that code multiple times.</p><p>Let’s jump to the code,</p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span data-label-text="Kotlin"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">DispatcherDecisionMaker</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">onApprove</span><span class="p">:</span> <span class="nc">Step</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">onReject</span><span class="p">:</span> <span class="nc">Step</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">onPendingSettlement</span><span class="p">:</span> <span class="nc">Step</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="k">fun</span> <span class="nf">onExecute</span><span class="p">(</span>
        <span class="n">dispatcherHumanTaskResponse</span><span class="p">:</span> <span class="nc">DispatcherHumanTaskResponse</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
        <span class="n">fetchPaymentResponse</span><span class="p">:</span> <span class="nc">FetchPaymentResponse</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>
    <span class="p">):</span> <span class="nc">Step</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">when</span> <span class="p">(</span><span class="n">fetchPaymentResponse</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">true</span> <span class="p">-&gt;</span> <span class="nf">getDispatcherResponse</span><span class="p">(</span><span class="n">dispatcherHumanTaskResponse</span><span class="p">)</span>
            <span class="k">false</span> <span class="p">-&gt;</span> <span class="k">when</span> <span class="p">(</span><span class="n">fetchPaymentResponse</span><span class="p">.</span><span class="n">isPaymentSettled</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">false</span> <span class="p">-&gt;</span> <span class="n">onPendingSettlement</span>
                <span class="k">else</span> <span class="p">-&gt;</span> <span class="nf">getDispatcherResponse</span><span class="p">(</span><span class="n">dispatcherHumanTaskResponse</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">getDispatcherResponse</span><span class="p">(</span><span class="n">dispatcherHumanTaskResponse</span><span class="p">:</span> <span class="nc">DispatcherHumanTaskResponse</span><span class="p">?)</span> <span class="p">=</span>
        <span class="k">when</span> <span class="p">(</span><span class="n">dispatcherHumanTaskResponse</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">true</span> <span class="p">-&gt;</span> <span class="n">onApprove</span>
            <span class="k">false</span> <span class="p">-&gt;</span> <span class="k">when</span> <span class="p">(</span><span class="n">dispatcherHumanTaskResponse</span><span class="p">.</span><span class="n">decision</span><span class="p">)</span> <span class="p">{</span>
                <span class="nc">CaseDecision</span><span class="p">.</span><span class="nc">APPROVED</span> <span class="p">-&gt;</span> <span class="n">onApprove</span>
                <span class="k">else</span> <span class="p">-&gt;</span> <span class="n">onReject</span>
            <span class="p">}</span>
        <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><blockquote class="prompt-info"><div><p>Even today, After reading the above code and knowing the flow, I still need to check steps and other implementations to understand the code. I encourage you to once read the above code and then think about what you understood?</p></div></blockquote><p><img data-src="https://media.giphy.com/media/kkxQdM0zvG2xCmmNh5/giphy-downsized-large.gif" alt="bored funny image" data-proofer-ignore></p><h2 id="understanding"><span class="mr-2">Understanding</span><a href="#understanding" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>If you are unable to understand the above code, you are not alone. Let me brief you on what checks the above code does?</p><ul><li>Is <code class="language-plaintext highlighter-rouge">payment settlement</code> toggle/flow enabled?<li>Was there any response from the fetch <code class="language-plaintext highlighter-rouge">payment status</code> API call?<li>If there was any response, check for <code class="language-plaintext highlighter-rouge">payment settlement</code> status and decide whether to wait for settlement to complete or move on to <code class="language-plaintext highlighter-rouge">dispatcher(Team) decision</code>?<li>Is <code class="language-plaintext highlighter-rouge">dispatcher human task</code> toggle/flow enabled?<li>If it is not enabled, <code class="language-plaintext highlighter-rouge">default to as approved</code>. Otherwise, check the <strong>decision made by the Team Dispatcher and decide on the next step</strong>.</ul><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 400 600'%3E%3C/svg%3E" data-src="https://media.giphy.com/media/M8vBiv9mgpHDGpqL9y/giphy-downsized-large.gif" alt="push all thing funny image" width="400" height="600" data-proofer-ignore></p><p>I was surprised that too many things were happening and have been taken care of by the above piece of code. But reading the code again now, I still feel confused as it is implicit knowledge, and the <strong>other developer might not have that proper context, so he/she again needs to read the last step from the code itself</strong>.</p><p>From the code, we see the <strong>class is handling two responsibilities</strong> <code class="language-plaintext highlighter-rouge">Payment decision</code> and <code class="language-plaintext highlighter-rouge">Dispatcher decision</code>. Also, there is <code class="language-plaintext highlighter-rouge">naming smell</code> problem in <strong>getDispatcherResponse()</strong>.</p><blockquote class="prompt-danger"><div><p>getDispatcherResponse() method doesn’t return the dispatcher response but returns the next step to execute based on the human decision from Dispatcher Team.</p></div></blockquote><p><code class="language-plaintext highlighter-rouge">fetchPaymentResponse == null</code>, this code check whether payment settlement flow/toggle is enabled or not. Seriously, <strong>I can’t interpret this by reading this class alone. That developer will have a hard time understanding his code after a few years.</strong></p><p>What is the use of <code class="language-plaintext highlighter-rouge">else</code> in line number 15?, Why not <code class="language-plaintext highlighter-rouge">true</code>? it <strong>makes more sense than writing <code class="language-plaintext highlighter-rouge">else</code> there</strong>.</p><div class="language-diff nolineno highlighter-rouge"><div class="code-header"> <span data-label-text="Diff"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="gd">- else -&gt; getDispatcherResponse(dispatcherHumanTaskResponse)
</span><span class="gi">+ true -&gt; getDispatcherResponse(dispatcherHumanTaskResponse)
</span></pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">dispatcherHumanTaskResponse == null</code>, this code checks whether Dispatcher Human Task flow/toggle is enabled or not. Again, this is hard to understand from the code.</p><blockquote class="prompt-warning"><div><p>I am scared of the day if that change got pushed into production, and after a few months, some strange bug appears. I can’t imagine that scenario for the developer who will be debugging it as everything is happening as an event.</p></div></blockquote><p><img data-src="https://media.giphy.com/media/3iBbm6ilVZkC6RmjhL/giphy.gif" alt="scary funny image" data-proofer-ignore></p><h2 id="refactoring"><span class="mr-2">Refactoring</span><a href="#refactoring" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now, Let’s see refactored version of the above implementation.</p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span data-label-text="Kotlin"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">DispatcherDecisionMaker</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">onApprove</span><span class="p">:</span> <span class="nc">Step</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">onReject</span><span class="p">:</span> <span class="nc">Step</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">onPendingSettlement</span><span class="p">:</span> <span class="nc">Step</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="k">fun</span> <span class="nf">onExecute</span><span class="p">(</span>
        <span class="n">dispatcherHumanTaskResponse</span><span class="p">:</span> <span class="nc">DispatcherHumanTaskResponse</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
        <span class="n">fetchPaymentResponse</span><span class="p">:</span> <span class="nc">FetchPaymentResponse</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>
    <span class="p">):</span> <span class="nc">Step</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">when</span> <span class="p">(</span><span class="nf">isPaymentSettlementEnabled</span><span class="p">(</span><span class="n">fetchPaymentResponse</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">false</span> <span class="p">-&gt;</span> <span class="nf">nextStep</span><span class="p">(</span><span class="n">dispatcherHumanTaskResponse</span><span class="p">)</span>
            <span class="k">true</span> <span class="p">-&gt;</span> <span class="k">when</span> <span class="p">(</span><span class="nf">isPaymentSettled</span><span class="p">(</span><span class="n">fetchPaymentResponse</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">false</span> <span class="p">-&gt;</span> <span class="n">onPendingSettlement</span>
                <span class="k">true</span> <span class="p">-&gt;</span> <span class="nf">nextStep</span><span class="p">(</span><span class="n">dispatcherHumanTaskResponse</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">isPaymentSettlementEnabled</span><span class="p">(</span><span class="n">fetchPaymentResponse</span><span class="p">:</span> <span class="nc">FetchPaymentResponse</span><span class="p">?):</span> <span class="nc">Boolean</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">fetchPaymentResponse</span> <span class="p">!=</span> <span class="k">null</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">isPaymentSettled</span><span class="p">(</span><span class="n">fetchPaymentResponse</span><span class="p">:</span> <span class="nc">FetchPaymentResponse</span><span class="p">?):</span> <span class="nc">Boolean</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">fetchPaymentResponse</span><span class="o">!!</span><span class="p">.</span><span class="n">isPaymentSettled</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">nextStep</span><span class="p">(</span><span class="n">dispatcherHumanTaskResponse</span><span class="p">:</span> <span class="nc">DispatcherHumanTaskResponse</span><span class="p">?)</span> <span class="p">=</span>
        <span class="k">when</span> <span class="p">(</span><span class="nf">isDispatcherFlowDisabled</span><span class="p">(</span><span class="n">dispatcherHumanTaskResponse</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">true</span> <span class="p">-&gt;</span> <span class="n">onApprove</span>
            <span class="k">false</span> <span class="p">-&gt;</span> <span class="k">when</span> <span class="p">(</span><span class="nf">dispatcherDecision</span><span class="p">(</span><span class="n">dispatcherHumanTaskResponse</span><span class="p">))</span> <span class="p">{</span>
                <span class="nc">CaseDecision</span><span class="p">.</span><span class="nc">APPROVED</span> <span class="p">-&gt;</span> <span class="n">onApprove</span>
                <span class="k">else</span> <span class="p">-&gt;</span> <span class="n">onReject</span>
            <span class="p">}</span>
        <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">isDispatcherFlowDisabled</span><span class="p">(</span><span class="n">dispatcherHumanTaskResponse</span><span class="p">:</span> <span class="nc">DispatcherHumanTaskResponse</span><span class="p">?):</span> <span class="nc">Boolean</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">dispatcherHumanTaskResponse</span> <span class="p">==</span> <span class="k">null</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">dispatcherDecision</span><span class="p">(</span><span class="n">dispatcherHumanTaskResponse</span><span class="p">:</span> <span class="nc">DispatcherHumanTaskResponse</span><span class="p">?):</span> <span class="nc">CaseDecision</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">dispatcherHumanTaskResponse</span><span class="o">!!</span><span class="p">.</span><span class="n">decision</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="further-refactoring"><span class="mr-2">Further Refactoring</span><a href="#further-refactoring" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Above code is still doing multiple things. It can be further simplified into 2 separate class,<br /> Implementation of <code class="language-plaintext highlighter-rouge">Dispatcher Decision Maker</code>:</p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span data-label-text="Kotlin"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">DispatcherDecisionMaker</span> <span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">onApprove</span><span class="p">:</span> <span class="nc">Step</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">onReject</span><span class="p">:</span> <span class="nc">Step</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="k">fun</span> <span class="nf">onExecute</span><span class="p">(</span><span class="n">dispatcherHumanTaskResponse</span><span class="p">:</span> <span class="nc">DispatcherHumanTaskResponse</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span><span class="p">):</span> <span class="nc">Step</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">when</span> <span class="p">(</span><span class="nf">isDispatcherFlowDisabled</span> <span class="p">(</span><span class="n">dispatcherHumanTaskResponse</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">true</span> <span class="p">-&gt;</span> <span class="n">onApprove</span>
            <span class="k">false</span> <span class="p">-&gt;</span> <span class="k">when</span> <span class="p">(</span><span class="nf">dispatcherDecision</span> <span class="p">(</span><span class="n">dispatcherHumanTaskResponse</span><span class="p">))</span> <span class="p">{</span>
                <span class="nc">CaseDecision</span><span class="p">.</span><span class="nc">APPROVED</span> <span class="p">-&gt;</span> <span class="n">onApprove</span>
                <span class="k">else</span> <span class="p">-&gt;</span> <span class="n">onReject</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">isDispatcherFlowDisabled</span> <span class="p">(</span><span class="n">dispatcherHumanTaskResponse</span><span class="p">:</span> <span class="nc">DispatcherHumanTaskResponse</span><span class="p">?):</span> <span class="nc">Boolean</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">dispatcherHumanTaskResponse</span> <span class="p">==</span> <span class="k">null</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">dispatcherDecision</span> <span class="p">(</span><span class="n">dispatcherHumanTaskResponse</span><span class="p">:</span> <span class="nc">DispatcherHumanTaskResponse</span><span class="p">?):</span> <span class="nc">CaseDecision</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">dispatcherHumanTaskResponse</span><span class="o">!!</span><span class="p">.</span><span class="n">decision</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Implementation of <code class="language-plaintext highlighter-rouge">Payment Status Decision Maker</code>:</p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span data-label-text="Kotlin"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">PaymentStatusDecisionMaker</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">onPendingSettlementFlow</span><span class="p">:</span> <span class="nc">Step</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">onSuccess</span><span class="p">:</span> <span class="nc">Step</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">onSkip</span><span class="p">:</span> <span class="nc">Step</span>
<span class="p">){</span>
    <span class="k">fun</span> <span class="nf">onExecute</span><span class="p">(</span>
        <span class="n">fetchPaymentResponse</span><span class="p">:</span> <span class="nc">FetchPaymentResponse</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>
    <span class="p">):</span> <span class="nc">Step</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">when</span> <span class="p">(</span><span class="nf">isPaymentSettlementEnabled</span> <span class="p">(</span><span class="n">fetchPaymentResponse</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">true</span> <span class="p">-&gt;</span> <span class="k">when</span> <span class="p">(</span><span class="nf">isPaymentSettled</span><span class="p">(</span><span class="n">fetchPaymentResponse</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">true</span> <span class="p">-&gt;</span> <span class="n">onSuccess</span>
                <span class="k">false</span> <span class="p">-&gt;</span> <span class="n">onPendingSettlementFlow</span>
            <span class="p">}</span>
            <span class="k">false</span> <span class="p">-&gt;</span> <span class="n">onSkip</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">isPaymentSettlementEnabled</span> <span class="p">(</span><span class="n">fetchPaymentResponse</span><span class="p">:</span> <span class="nc">FetchPaymentResponse</span><span class="p">?):</span> <span class="nc">Boolean</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">fetchPaymentResponse</span> <span class="p">!=</span> <span class="k">null</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">isPaymentSettled</span><span class="p">(</span><span class="n">fetchPaymentResponse</span><span class="p">:</span> <span class="nc">FetchPaymentResponse</span><span class="p">?):</span> <span class="nc">Boolean</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">fetchPaymentResponse</span><span class="o">!!</span><span class="p">.</span><span class="n">isPaymentSettled</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>It looks much better as each class is doing one thing.</p><blockquote class="prompt-tip"><div><p>Even though it required to create another class but at the cost of clean responsibility and better readability, Which has more advantages than disadvantages. Also, it increases reusability.</p></div></blockquote><h2 id="conclusion"><span class="mr-2">Conclusion:</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Initially, we saw that code was doing more things that can’t be easily interpreted by just reading it. To get the full context of the whole code, I needed to read the previous flow, and then I had to figure out what was happening, which was a clear signal of code smell. Be careful next time.</p><p> </p><blockquote class="prompt-tip"><div><p>You have something to share, go ahead and add in comments 😉 » Happy Learning!!</p></div></blockquote></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/blogging/'>Blogging</a>, <a href='/categories/codesmellseries/'>CodeSmellSeries</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/coding/" class="post-tag no-text-decoration" >coding</a> <a href="/tags/smells/" class="post-tag no-text-decoration" >smells</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Code+Smell+Series%3A+Shh%E2%80%A6something+is+happening+there+-+Pravin+on+Software&url=https%3A%2F%2Fpravin.dev%2Fposts%2Fcode-smell-series-ssh-something-is-happening%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Code+Smell+Series%3A+Shh%E2%80%A6something+is+happening+there+-+Pravin+on+Software&u=https%3A%2F%2Fpravin.dev%2Fposts%2Fcode-smell-series-ssh-something-is-happening%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fpravin.dev%2Fposts%2Fcode-smell-series-ssh-something-is-happening%2F&text=Code+Smell+Series%3A+Shh%E2%80%A6something+is+happening+there+-+Pravin+on+Software" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fpravin.dev%2Fposts%2Fcode-smell-series-ssh-something-is-happening%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/database-engineering-fundamental-part-2/">Part 2: Database Engineering Fundamentals</a><li><a href="/posts/system-design-roadmap/">Comprehensive Roadmap for Low-Level and High-Level Design Interview Preparation</a><li><a href="/database-engineering-fundamental-part-5/write-amplification-problem-in-postgresql/">Part 5: Database Engineering Fundamentals: Write Amplification Problem in PostgreSQL</a><li><a href="/database-engineering-fundamental-part-1/">Part 1: Database Engineering Fundamentals</a><li><a href="/database-engineering-fundamental-part-1/database-page/">Part 1: Database Engineering Fundamentals: Database Page</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/backenddevelopment/">backenddevelopment</a> <a class="post-tag" href="/tags/softwareengineering/">softwareengineering</a> <a class="post-tag" href="/tags/database-engineering/">database-engineering</a> <a class="post-tag" href="/tags/design/">design</a> <a class="post-tag" href="/tags/coding/">coding</a> <a class="post-tag" href="/tags/smells/">smells</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/nodejs/">nodejs</a> <a class="post-tag" href="/tags/softwaredevelopment/">softwaredevelopment</a> <a class="post-tag" href="/tags/aws/">aws</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/code-smell-series-variable-name/"><div class="card-body"> <em class="small" data-ts="1655231400" data-df="ll" > Jun 15, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Code Smell Series: Naming smells - Part 1</h3><div class="text-muted small"><p> Are you sure your code is free from naming smell? You may think about ignoring it and adding to backlog due to week smell, but if that tech debt is not fixed and delayed, it will create more h...</p></div></div></a></div><div class="card"> <a href="/posts/code-smell-series-file-name/"><div class="card-body"> <em class="small" data-ts="1655577000" data-df="ll" > Jun 19, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Code Smell Series: Naming smells - Part 2</h3><div class="text-muted small"><p> …Ahem…Why I still see non-sense naming? I recall encountering a few naming smells in the legacy system, during migration activity. There I saw three files with similar name in the production i...</p></div></div></a></div><div class="card"> <a href="/posts/code-smell-in-unit-test/"><div class="card-body"> <em class="small" data-ts="1682951400" data-df="ll" > May 1, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Code Smell Series: Unit Test</h3><div class="text-muted small"><p> The secret to high-quality code is following the path of clean code. A code will remain at its highest quality if it has an understandable and meaningful test. Robert C. Martin in his book, “C...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/code-smell-series-file-name/" class="btn btn-outline-primary" prompt="Older"><p>Code Smell Series: Naming smells - Part 2</p></a> <a href="/posts/what-makes-api-documentation-terrible/" class="btn btn-outline-primary" prompt="Newer"><p>What makes API documentation terrible?</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://pravin.dev/posts/code-smell-series-ssh-something-is-happening/'; this.page.identifier = '/posts/code-smell-series-ssh-something-is-happening/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://pravin-dev.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://www.linkedin.com/in/pravin-r-tripathi">Pravin Tripathi</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/backenddevelopment/">backenddevelopment</a> <a class="post-tag" href="/tags/softwareengineering/">softwareengineering</a> <a class="post-tag" href="/tags/database-engineering/">database-engineering</a> <a class="post-tag" href="/tags/design/">design</a> <a class="post-tag" href="/tags/coding/">coding</a> <a class="post-tag" href="/tags/smells/">smells</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/nodejs/">nodejs</a> <a class="post-tag" href="/tags/softwaredevelopment/">softwaredevelopment</a> <a class="post-tag" href="/tags/aws/">aws</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-WP90FFJ6SJ"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-WP90FFJ6SJ'); }); </script>
