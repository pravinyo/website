<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Understanding Apache Camel: A Comprehensive Guide to Integration Patterns and System Management" /><meta name="author" content="Pravin Tripathi" /><meta property="og:locale" content="en" /><meta name="description" content="Table of Contents Introduction to Apache Camel Understanding Camel Routes Essential Integration Patterns Real-World Integration Examples Advanced System Management Health Check" /><meta property="og:description" content="Table of Contents Introduction to Apache Camel Understanding Camel Routes Essential Integration Patterns Real-World Integration Examples Advanced System Management Health Check" /><link rel="canonical" href="https://pravin.dev/posts/apache-camel-application-integration/" /><meta property="og:url" content="https://pravin.dev/posts/apache-camel-application-integration/" /><meta property="og:site_name" content="Pravin on Software" /><meta property="og:image" content="https://pravin.dev/header.png" /><meta property="og:image:height" content="900" /><meta property="og:image:width" content="1600" /><meta property="og:image:alt" content="Generated using Copilot" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-02-08T00:00:00+05:30" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://pravin.dev/header.png" /><meta name="twitter:image:alt" content="Generated using Copilot" /><meta property="twitter:title" content="Understanding Apache Camel: A Comprehensive Guide to Integration Patterns and System Management" /><meta name="twitter:site" content="@pravin_yo" /><meta name="twitter:creator" content="@pravin_yo" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Pravin Tripathi","url":"https://www.linkedin.com/in/pravin-r-tripathi"},"dateModified":"2025-02-08T00:00:00+05:30","datePublished":"2025-02-08T00:00:00+05:30","description":"Table of Contents Introduction to Apache Camel Understanding Camel Routes Essential Integration Patterns Real-World Integration Examples Advanced System Management Health Check","headline":"Understanding Apache Camel: A Comprehensive Guide to Integration Patterns and System Management","image":{"width":1600,"height":900,"alt":"Generated using Copilot","url":"https://pravin.dev/header.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://pravin.dev/posts/apache-camel-application-integration/"},"url":"https://pravin.dev/posts/apache-camel-application-integration/"}</script><title>Understanding Apache Camel: A Comprehensive Guide to Integration Patterns and System Management | Pravin on Software</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Pravin on Software"><meta name="application-name" content="Pravin on Software"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Pravin on Software</a></div><div class="site-subtitle font-italic">My Learning and Experiments in Software Engineering</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/pravinyo" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/pravin_yo" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['pravinyo12','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Understanding Apache Camel: A Comprehensive Guide to Integration Patterns and System Management</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Understanding Apache Camel: A Comprehensive Guide to Integration Patterns and System Management</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1738953000" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Feb 8, 2025 </em> </span><div class="mt-3 mb-3"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1600 900'%3E%3C/svg%3E" data-src="/assets/img/apache-camel-application-integration/header.png" class="preview-img bg" alt="Generated using Copilot" width="1600" height="900" data-proofer-ignore><figcaption class="pt-2 pb-2">Generated using Copilot</figcaption></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://www.linkedin.com/in/pravin-r-tripathi">Pravin Tripathi</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3462 words"> <em>19 min</em> read</span></div></div></div><div class="post-content"><h2 id="table-of-contents"><span class="mr-2">Table of Contents</span><a href="#table-of-contents" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ol><li><a href="#introduction">Introduction to Apache Camel</a><li><a href="#camel-routes">Understanding Camel Routes</a><li><a href="#integration-patterns">Essential Integration Patterns</a><li><a href="#real-world-examples">Real-World Integration Examples</a><li><a href="#advanced-management">Advanced System Management</a><li><a href="#health-checks">Health Check</a></ol><h2 id="introduction"><span class="mr-2">Introduction</span><a href="#introduction" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Apache Camel is like a universal translator and message router for different software systems. Think of it as a postal service for your applications - it picks up messages from one place, maybe transforms them, and delivers them to another place.</p><pre><code class="language-mermaid">flowchart LR
    subgraph "Sources"
        Files[Files in Folder]
        REST[Web Service]
        Email[Email]
        SQueue[Message Queue]
    end

    subgraph "Apache Camel"
        Router[Message Router]
    end

    subgraph "Destinations"
        DB[(Database)]
        Queue[Message Queue]
        API[Another Web Service]
    end

    Files --&gt; Router
    REST --&gt; Router
    Email --&gt; Router
    SQueue --&gt; Router
    
    Router --&gt; DB
    Router --&gt; Queue
    Router --&gt; API

    style Router fill:#f96,stroke:#333
</code></pre><h2 id="camel-routes"><span class="mr-2">Understanding Camel Routes</span><a href="#camel-routes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>A Camel route is like a set of instructions telling Camel how to move messages from point A to point B. Here’s a simple example:</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="c1">// This route moves files from an 'orders' folder to a 'processed' folder</span>
<span class="n">from</span><span class="o">(</span><span class="s">"file:orders"</span><span class="o">)</span>              <span class="c1">// 1. Watch the 'orders' folder for new files</span>
    <span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="s">"Found file: ${file:name}"</span><span class="o">)</span>  <span class="c1">// 2. Log the filename</span>
    <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"file:processed"</span><span class="o">);</span>       <span class="c1">// 3. Move the file to 'processed' folder</span>

<span class="c1">// This route reads files and sends important ones to a different place</span>
<span class="n">from</span><span class="o">(</span><span class="s">"file:inbox"</span><span class="o">)</span>               <span class="c1">// 1. Watch the 'inbox' folder</span>
    <span class="o">.</span><span class="na">choice</span><span class="o">()</span>                    <span class="c1">// 2. Make a decision based on file content</span>
        <span class="o">.</span><span class="na">when</span><span class="o">(</span><span class="n">simple</span><span class="o">(</span><span class="s">"${file:name} contains 'urgent'"</span><span class="o">))</span>  <span class="c1">// 3. If filename has 'urgent'</span>
            <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"direct:urgent"</span><span class="o">)</span>                         <span class="c1">// 4. Send to urgent processor</span>
        <span class="o">.</span><span class="na">otherwise</span><span class="o">()</span>                                     <span class="c1">// 5. If not urgent</span>
            <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"direct:normal"</span><span class="o">);</span>                        <span class="c1">// 6. Send to normal processor</span>

</pre></table></code></div></div><p>Let’s break down what this code does:</p><ul><li>The first route is like having someone watch a folder called “orders” for new files, and when they find one, they log its name and move it to a “processed” folder.<li>The second route shows how to make decisions - it’s like a mail sorter who looks at each envelope and sends urgent mail to one place and regular mail to another.</ul><h2 id="integration-patterns"><span class="mr-2">Essential Integration Patterns</span><a href="#integration-patterns" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="1-content-based-router"><span class="mr-2">1. Content-Based Router</span><a href="#1-content-based-router" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Routes messages based on their content:</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="n">from</span><span class="o">(</span><span class="s">"file:incoming-orders"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">choice</span><span class="o">()</span>
        <span class="o">.</span><span class="na">when</span><span class="o">(</span><span class="n">simple</span><span class="o">(</span><span class="s">"${body.orderType} == 'RUSH'"</span><span class="o">))</span>
            <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"direct:rush-orders"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">otherwise</span><span class="o">()</span>
            <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"direct:regular-orders"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">end</span><span class="o">();</span>
</pre></table></code></div></div><p>This pattern is like a traffic controller that:</p><ol><li>Examines the content of each message (the orderType)<li>Routes rush orders one way<li>Routes regular orders another way</ol><h3 id="2-filter-pattern"><span class="mr-2">2. Filter Pattern</span><a href="#2-filter-pattern" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Filters messages based on criteria:</p><pre><code class="language-mermaid">flowchart LR
    Input[Input Messages] --&gt; Filter{Contains 'important'?}
    Filter --&gt;|Yes| Output[Important Queue]
    Filter --&gt;|No| Discard[Discarded]

    style Filter fill:#f96,stroke:#333

</code></pre><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">from</span><span class="o">(</span><span class="s">"direct:start"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">simple</span><span class="o">(</span><span class="s">"${body} contains 'important'"</span><span class="o">))</span>
    <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"direct:important-messages"</span><span class="o">);</span>
</pre></table></code></div></div><p>This pattern works like a sieve that:</p><ol><li>Examines each message<li>Only lets through messages matching certain criteria<li>Discards or ignores non-matching messages</ol><h3 id="3-transformer-pattern"><span class="mr-2">3. Transformer Pattern</span><a href="#3-transformer-pattern" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Converts messages between formats:</p><pre><code class="language-mermaid">flowchart LR
    Input[JSON Input] --&gt; Transform[Transform Process]
    Transform --&gt; Output[XML Output]
    
    subgraph "Transform Process"
        M[Marshal] --&gt; U[Unmarshal]
    end

    style Transform fill:#69f,stroke:#333

</code></pre><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">from</span><span class="o">(</span><span class="s">"direct:start"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">marshal</span><span class="o">().</span><span class="na">json</span><span class="o">()</span>
    <span class="o">.</span><span class="na">unmarshal</span><span class="o">().</span><span class="na">xml</span><span class="o">()</span>
    <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"direct:xml-processor"</span><span class="o">);</span>
</pre></table></code></div></div><p>This pattern acts like a format converter that:</p><ol><li>Takes input in one format (like JSON)<li>Transforms it to another format (like XML)<li>Useful when connecting systems that speak different “languages”</ol><h3 id="4-dead-letter-channel-pattern"><span class="mr-2">4. Dead Letter Channel Pattern</span><a href="#4-dead-letter-channel-pattern" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Handles failed messages by moving them to a Dead Letter Queue (DLQ).</p><pre><code class="language-mermaid">flowchart TD
  Start[Message] --&gt; Process{Process Message}
  Process --&gt;|Success| Success[Success Queue]
  Process --&gt;|Failure| Retry{Retry?}
  Retry --&gt;|Yes| Process
  Retry --&gt;|No| Dead[Dead Letter Queue]

  style Process fill:#f69,stroke:#333
  style Retry fill:#f69,stroke:#333
</code></pre><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="n">errorHandler</span><span class="o">(</span><span class="n">deadLetterChannel</span><span class="o">(</span><span class="s">"direct:dead-letter"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">maximumRedeliveries</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
  <span class="o">.</span><span class="na">redeliveryDelay</span><span class="o">(</span><span class="mi">1000</span><span class="o">)</span>
  <span class="o">.</span><span class="na">backOffMultiplier</span><span class="o">(</span><span class="mi">2</span><span class="o">));</span>

<span class="n">from</span><span class="o">(</span><span class="s">"direct:start"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"direct:possibly-failing-service"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="s">"Message processed successfully"</span><span class="o">);</span>
</pre></table></code></div></div><p>This pattern works like a safety net that:</p><ol><li>Attempts to process a message.<li>If processing fails, retries up to 3 times.<li>Increases the delay between retries.<li>If all retries fail, moves the message to a “dead letter” queue for further investigation.</ol><h3 id="5-splitter-pattern"><span class="mr-2">5. Splitter Pattern</span><a href="#5-splitter-pattern" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Splits a single message into multiple messages:</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">from</span><span class="o">(</span><span class="s">"direct:start"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="n">body</span><span class="o">().</span><span class="na">tokenize</span><span class="o">(</span><span class="s">","</span><span class="o">))</span>
  <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"direct:process-split-message"</span><span class="o">);</span>
</pre></table></code></div></div><p>This pattern works like a paper cutter that:</p><ol><li>Takes a single message containing multiple items (e.g., a comma-separated list)<li>Splits it into individual messages for each item<li>Processes each item separately</ol><h3 id="6-aggregator-pattern"><span class="mr-2">6. Aggregator Pattern</span><a href="#6-aggregator-pattern" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Combines multiple messages into a single message:</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">from</span><span class="o">(</span><span class="s">"direct:start"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">aggregate</span><span class="o">(</span><span class="n">header</span><span class="o">(</span><span class="s">"orderId"</span><span class="o">),</span> <span class="k">new</span> <span class="nc">GroupedExchangeAggregationStrategy</span><span class="o">())</span>
  <span class="o">.</span><span class="na">completionSize</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
  <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"direct:process-aggregated-message"</span><span class="o">);</span>
</pre></table></code></div></div><p>This pattern works like a collector that:</p><ol><li>Groups messages based on a common attribute (e.g., orderId)<li>Aggregates them into a single message once a condition is met (e.g., 5 messages received)<li>Processes the aggregated message</ol><h3 id="7-wire-tap-pattern-logging-implementation"><span class="mr-2">7. Wire Tap Pattern (Logging Implementation)</span><a href="#7-wire-tap-pattern-logging-implementation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="n">from</span><span class="o">(</span><span class="s">"file:incoming-orders"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">wireTap</span><span class="o">(</span><span class="s">"direct:audit-log"</span><span class="o">)</span>      
    <span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="s">"Received order: ${file:name}"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"direct:process-order"</span><span class="o">);</span>

<span class="n">from</span><span class="o">(</span><span class="s">"direct:audit-log"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="s">"Audit: ${file:name} received at ${date:now:yyyy-MM-dd HH:mm:ss}"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"file:audit-logs"</span><span class="o">);</span>
</pre></table></code></div></div><p>This pattern works like a phone tap that:</p><ol><li>Creates a copy of each message<li>Sends the copy to a logging/monitoring system<li>Allows the original message to continue its journey<li>Useful for audit trails and monitoring</ol><h3 id="8-error-handler"><span class="mr-2">8. Error handler</span><a href="#8-error-handler" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="n">from</span><span class="o">(</span><span class="s">"direct:start"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">errorHandler</span><span class="o">(</span><span class="n">defaultErrorHandler</span><span class="o">()</span>
        <span class="o">.</span><span class="na">maximumRedeliveries</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
        <span class="o">.</span><span class="na">redeliveryDelay</span><span class="o">(</span><span class="mi">1000</span><span class="o">))</span>
    <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"direct:possibly-failing-service"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="s">"Message processed successfully"</span><span class="o">);</span>
</pre></table></code></div></div><p>This pattern help implement simple error handling,</p><ol><li>Like a persistent delivery person who tries multiple times if nobody answers the door<li>If sending a message fails, it will retry up to 3 times<li>Between each retry, it waits for 1 second<li>If all retries fail, it gives up and reports an error</ol><h2 id="real-world-examples"><span class="mr-2">Real-World Integration Examples</span><a href="#real-world-examples" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Here’s an example that tries to show different patterns in use.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="c1">// Order Processing Route</span>
<span class="n">from</span><span class="o">(</span><span class="s">"file:incoming-orders"</span><span class="o">)</span>     <span class="c1">// 1. Watch 'incoming-orders' folder for new files</span>
    <span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="s">"Received order: ${file:name}"</span><span class="o">)</span>  <span class="c1">// 2. Log when we find a new order</span>
    
    <span class="c1">// 3. Convert the file content to JSON</span>
    <span class="o">.</span><span class="na">unmarshal</span><span class="o">().</span><span class="na">json</span><span class="o">()</span>          
    
    <span class="c1">// 4. Add current timestamp to the order</span>
    <span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"ProcessingTime"</span><span class="o">,</span> <span class="n">simple</span><span class="o">(</span><span class="s">"${date:now:yyyy-MM-dd HH:mm:ss}"</span><span class="o">))</span>
    
    <span class="c1">// 5. Make decisions based on order type</span>
    <span class="o">.</span><span class="na">choice</span><span class="o">()</span>
        <span class="o">.</span><span class="na">when</span><span class="o">(</span><span class="n">simple</span><span class="o">(</span><span class="s">"${body.orderType} == 'RUSH'"</span><span class="o">))</span>
            <span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="s">"Rush order detected!"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"direct:rush-orders"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">otherwise</span><span class="o">()</span>
            <span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="s">"Regular order received"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"direct:regular-orders"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">end</span><span class="o">()</span>
    
    <span class="c1">// 6. Move processed file to archive</span>
    <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"file:processed-orders"</span><span class="o">);</span>

<span class="c1">// Rush Order Handler</span>
<span class="n">from</span><span class="o">(</span><span class="s">"direct:rush-orders"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="s">"Processing rush order"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"direct:notify-shipping"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"direct:update-inventory"</span><span class="o">);</span>

<span class="c1">// Regular Order Handler</span>
<span class="n">from</span><span class="o">(</span><span class="s">"direct:regular-orders"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="s">"Processing regular order"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">delay</span><span class="o">(</span><span class="n">simple</span><span class="o">(</span><span class="s">"${random(1000,5000)}"</span><span class="o">))</span>  <span class="c1">// Simulate processing time</span>
    <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"direct:update-inventory"</span><span class="o">);</span>

</pre></table></code></div></div><p>Let’s break down what this order processing system does:</p><ol><li>File Monitoring:<ul><li>Watches a folder called “incoming-orders” for new order files<li>When a new file appears, it starts processing it</ul><li>Initial Processing:<ul><li>Logs the filename so we know which order is being processed<li>Converts the file content from JSON format (like a digital order form)</ul><li>Adding Information:<ul><li>Adds a timestamp to track when the order was processed</ul><li>Decision Making:<ul><li>Checks if it’s a rush order or regular order<li>Rush orders get special handling<li>Regular orders follow the normal process</ul><li>Different Handling:<ul><li>Rush orders: Immediately notify shipping and update inventory<li>Regular orders: Process with some delay and update inventory</ul><li>File Management:<ul><li>Moves the processed order file to a different folder for record-keeping</ul></ol><p>This example shows how Camel can:</p><ul><li>Monitor folders for new files<li>Make decisions based on content<li>Process different types of orders differently<li>Keep track of what’s happening (logging)<li>Archive processed files</ul><p>In previous example, different patterns work together to create a robust system:</p><ol><li><strong>Content-Based Router</strong> sorts orders into rush and regular<li><strong>Wire Tap</strong> logs all activities for monitoring<li><strong>Transformer</strong> converts file contents into processable formats<li><strong>Dead Letter Channel</strong> handles any processing failures<li><strong>Filter</strong> could be used to only process orders meeting certain criteria</ol><p>These patterns are like building blocks that can be combined in different ways to handle various integration scenarios. They help solve common problems in a standardized way, making the system more maintainable and reliable.</p><h3 id="kafka-to-activemq-integration"><span class="mr-2">Kafka to ActiveMQ Integration</span><a href="#kafka-to-activemq-integration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>This example demonstrates consuming messages from Kafka and pushing them to ActiveMQ:</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">org.apache.camel.builder.RouteBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.camel.component.kafka.KafkaConstants</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.camel.LoggingLevel</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">KafkaToMQRoute</span> <span class="kd">extends</span> <span class="nc">RouteBuilder</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="c1">// Error Handler Configuration</span>
        <span class="n">errorHandler</span><span class="o">(</span><span class="n">deadLetterChannel</span><span class="o">(</span><span class="s">"activemq:queue:dead.letter"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">maximumRedeliveries</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
            <span class="o">.</span><span class="na">redeliveryDelay</span><span class="o">(</span><span class="mi">1000</span><span class="o">)</span>
            <span class="o">.</span><span class="na">backOffMultiplier</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
            <span class="o">.</span><span class="na">useExponentialBackOff</span><span class="o">()</span>
            <span class="o">.</span><span class="na">logRetryAttempted</span><span class="o">(</span><span class="kc">true</span><span class="o">));</span>

        <span class="c1">// Main route: Kafka → ActiveMQ</span>
        <span class="n">from</span><span class="o">(</span><span class="s">"kafka:orders-topic?"</span> <span class="o">+</span>
             <span class="s">"brokers=localhost:9092"</span> <span class="o">+</span>           
             <span class="s">"&amp;groupId=orders-group"</span> <span class="o">+</span>            
             <span class="s">"&amp;autoOffsetReset=earliest"</span> <span class="o">+</span>        
             <span class="s">"&amp;consumersCount=3"</span> <span class="o">+</span> 
             <span class="s">"&amp;maxPollRecords=100"</span><span class="o">)</span>
            <span class="c1">// Add correlation ID for tracking</span>
            <span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"correlationId"</span><span class="o">,</span> <span class="n">simple</span><span class="o">(</span><span class="s">"${random(1000,9999)}"</span><span class="o">))</span>
            <span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="nc">LoggingLevel</span><span class="o">.</span><span class="na">INFO</span><span class="o">,</span> <span class="s">"Received from Kafka: ${body} with key: ${headers[kafka.KEY]}"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="n">exchange</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="c1">// Example message transformation</span>
                <span class="nc">String</span> <span class="n">kafkaMessage</span> <span class="o">=</span> <span class="n">exchange</span><span class="o">.</span><span class="na">getIn</span><span class="o">().</span><span class="na">getBody</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
                <span class="nc">OrderMessage</span> <span class="n">order</span> <span class="o">=</span> <span class="n">convertToOrderMessage</span><span class="o">(</span><span class="n">kafkaMessage</span><span class="o">);</span>
                <span class="n">exchange</span><span class="o">.</span><span class="na">getIn</span><span class="o">().</span><span class="na">setBody</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>
            <span class="o">})</span>
            <span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"JMSPriority"</span><span class="o">,</span> <span class="n">simple</span><span class="o">(</span><span class="s">"${headers[kafka.PRIORITY]}"</span><span class="o">))</span>
            <span class="c1">// Send to ActiveMQ queue</span>
            <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"activemq:queue:orders?"</span> <span class="o">+</span>
                <span class="s">"timeToLive=86400000"</span> <span class="o">+</span>           
                <span class="s">"&amp;deliveryPersistent=true"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="nc">LoggingLevel</span><span class="o">.</span><span class="na">INFO</span><span class="o">,</span> <span class="s">"Successfully sent to ActiveMQ: ${header.correlationId}"</span><span class="o">);</span>

        <span class="c1">// Dead Letter Queue Handler</span>
        <span class="n">from</span><span class="o">(</span><span class="s">"activemq:queue:dead.letter"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="nc">LoggingLevel</span><span class="o">.</span><span class="na">ERROR</span><span class="o">,</span> 
                 <span class="s">"Failed to process message: ${body}. Error: ${exception.message}"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="n">handleError</span><span class="o">)</span>
            <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"activemq:queue:failed.orders"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">OrderMessage</span> <span class="nf">convertToOrderMessage</span><span class="o">(</span><span class="nc">String</span> <span class="n">kafkaMessage</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//conversion logic here</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">OrderMessage</span><span class="o">(</span><span class="cm">/* converted message */</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="nd">@Builder</span>
<span class="kd">class</span> <span class="nc">OrderMessage</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">orderId</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">customerInfo</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Double</span> <span class="n">amount</span><span class="o">;</span>
<span class="o">}</span>

</pre></table></code></div></div><p>Let’s break down this example in detail:</p><ol><li><strong>Main Components</strong>:<ul><li>Kafka Consumer: Reads messages from a Kafka topic named “orders-topic”<li>Message Transformer: Converts Kafka messages to ActiveMQ format<li>ActiveMQ Producer: Sends messages to ActiveMQ queue named “orders”</ul><li><strong>Kafka Consumer Configuration</strong>:<div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="s">"kafka:orders-topic?brokers=localhost:9092"</span> <span class="o">+</span>           
          <span class="s">"&amp;groupId=orders-group"</span> <span class="o">+</span>            
          <span class="s">"&amp;autoOffsetReset=earliest"</span> <span class="o">+</span>        
          <span class="s">"&amp;consumersCount=3"</span> <span class="o">+</span> 
          <span class="s">"&amp;maxPollRecords=100"</span>
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">brokers</code>: Kafka server address<li><code class="language-plaintext highlighter-rouge">groupId</code>: Consumer group for load balancing<li><code class="language-plaintext highlighter-rouge">autoOffsetReset</code>: Start reading position<li><code class="language-plaintext highlighter-rouge">consumersCount</code>: Number of parallel consumers<li><code class="language-plaintext highlighter-rouge">maxPollRecords</code>: Batch size for each poll</ul><li><strong>Error Handling</strong>:<div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">errorHandler</span><span class="o">(</span><span class="n">deadLetterChannel</span><span class="o">(</span><span class="s">"activemq:queue:dead.letter"</span><span class="o">)</span>
</pre></table></code></div></div><ul><li>Retries failed messages 3 times<li>Uses exponential backoff (delays increase between retries)<li>Failed messages go to a dead letter queue</ul><li><strong>Message Processing</strong>:<ul><li>Adds correlation ID for tracking<li>Logs incoming messages<li>Transforms message format<li>Sets JMS properties</ul><li><strong>ActiveMQ Configuration</strong>:<div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nl">activemq:queue:</span><span class="n">orders</span><span class="o">?</span><span class="n">timeToLive</span><span class="o">=</span><span class="mi">86400000</span>
</pre></table></code></div></div><ul><li>Sets message expiry time (24 hours)<li>Uses persistent delivery for reliability</ul></ol><p>Here’s a visualization of the message flow:</p><pre><code class="language-mermaid">flowchart LR
    subgraph Kafka
        KT[Orders Topic]
    end

    subgraph "Camel Route"
        C[Consumer]
        T[Transform]
        P[Producer]
    end

    subgraph ActiveMQ
        Q[Orders Queue]
        DL[Dead Letter Queue]
    end

    KT --&gt; C
    C --&gt; T
    T --&gt; P
    P --&gt; Q
    P -.-&gt; DL

    style C fill:#f96,stroke:#333
    style T fill:#69f,stroke:#333
    style P fill:#9f6,stroke:#333

</code></pre><p>To use this route, you would need:</p><ol><li>Dependencies in your <code class="language-plaintext highlighter-rouge">pom.xml</code>:</ol><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.apache.camel<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>camel-kafka<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.apache.camel<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>camel-activemq<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>

</pre></table></code></div></div><ol><li>Configure connection properties in your application.properties:</ol><div class="language-properties highlighter-rouge"><div class="code-header"> <span data-label-text="Properties"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="py">kafka.bootstrap.servers</span><span class="p">=</span><span class="s">localhost:9092</span>
<span class="py">activemq.broker.url</span><span class="p">=</span><span class="s">tcp://localhost:61616</span>

</pre></table></code></div></div><p>Some key features of this implementation:</p><ul><li>Reliable message delivery with retry mechanism<li>Message tracking with correlation IDs<li>Comprehensive logging<li>Dead letter queue for failed messages<li>Scalable with multiple consumers<li>Message transformation capability</ul><h2 id="advanced-management"><span class="mr-2">Advanced System Management</span><a href="#advanced-management" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>System outages are common and can impact your services. One common approach is to use circuit breakers and route-level control to manage system outages.</p><h3 id="circuit-breaker"><span class="mr-2">Circuit Breaker</span><a href="#circuit-breaker" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="c1">// Order Processing Route with Circuit Breaker</span>
<span class="n">from</span><span class="o">(</span><span class="s">"kafka:orders-topic"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">routeId</span><span class="o">(</span><span class="s">"order-processing-route"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">circuitBreaker</span><span class="o">()</span>
        <span class="o">.</span><span class="na">resilience4jConfiguration</span><span class="o">()</span>
            <span class="o">.</span><span class="na">failureRateThreshold</span><span class="o">(</span><span class="mi">50</span><span class="o">)</span>
            <span class="c1">// 50% failure rate to open circuit</span>
            <span class="o">.</span><span class="na">waitDurationInOpenState</span><span class="o">(</span><span class="mi">10000</span><span class="o">)</span>
            <span class="c1">// Wait 10 seconds in open state</span>
        <span class="o">.</span><span class="na">end</span><span class="o">()</span>
        <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"http://order-service/api/orders"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">onFallback</span><span class="o">()</span>
        <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"kafka:failed-orders"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">end</span><span class="o">();</span>
</pre></table></code></div></div><p>This code sets up a route in Apache Camel that reads messages from a Kafka topic named <code class="language-plaintext highlighter-rouge">orders-topic</code>. It uses a circuit breaker pattern to handle failures gracefully. If the failure rate exceeds 50%, the circuit breaker will open and stop sending requests to the primary endpoint (http://order-service/api/orders) for 10 seconds. During this time, any incoming messages will be sent to a fallback Kafka topic named <code class="language-plaintext highlighter-rouge">failed-orders</code>. This helps to prevent overwhelming the order service with requests when it is experiencing issues.</p><p>Implementing the circuit breaker pattern in a route is quite straightforward as it is provided out of the box by Camel.</p><p>Let’s take another example to understand how we can apply this in a Camel route.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">org.apache.camel.builder.RouteBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.camel.model.CircuitBreakerDefinition</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.camel.builder.DeadLetterChannelBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.camel.LoggingLevel</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MultiRouteWithCircuitBreaker</span> <span class="kd">extends</span> <span class="nc">RouteBuilder</span> <span class="o">{</span>
    
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">THRESHOLD</span> <span class="o">=</span> <span class="mi">5</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">HALF_OPEN_AFTER</span> <span class="o">=</span> <span class="mi">10000</span><span class="o">;</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="c1">// Global error handler</span>
        <span class="n">errorHandler</span><span class="o">(</span><span class="n">deadLetterChannel</span><span class="o">(</span><span class="s">"direct:errorHandler"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">maximumRedeliveries</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
            <span class="o">.</span><span class="na">redeliveryDelay</span><span class="o">(</span><span class="mi">1000</span><span class="o">)</span>
            <span class="o">.</span><span class="na">useExponentialBackOff</span><span class="o">()</span>
            <span class="o">.</span><span class="na">logRetryAttempted</span><span class="o">(</span><span class="kc">true</span><span class="o">));</span>

        <span class="c1">// Route Control and Monitoring</span>
        <span class="n">from</span><span class="o">(</span><span class="s">"timer:routeMonitor?period=60000"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">routeId</span><span class="o">(</span><span class="s">"monitor-route"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="n">exchange</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="n">checkDestinationHealth</span><span class="o">(</span><span class="n">exchange</span><span class="o">);</span>
            <span class="o">})</span>
            <span class="o">.</span><span class="na">choice</span><span class="o">()</span>
                <span class="o">.</span><span class="na">when</span><span class="o">(</span><span class="n">header</span><span class="o">(</span><span class="s">"systemStatus"</span><span class="o">).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"DOWN"</span><span class="o">))</span>
                    <span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="n">exchange</span> <span class="o">-&gt;</span> <span class="o">{</span>
                        <span class="c1">// Stop affected routes</span>
                        <span class="n">getContext</span><span class="o">().</span><span class="na">getRouteController</span><span class="o">().</span><span class="na">stopRoute</span><span class="o">(</span><span class="s">"order-processing-route"</span><span class="o">);</span>
                        <span class="n">getContext</span><span class="o">().</span><span class="na">getRouteController</span><span class="o">().</span><span class="na">stopRoute</span><span class="o">(</span><span class="s">"payment-processing-route"</span><span class="o">);</span>
                    <span class="o">})</span>
                <span class="o">.</span><span class="na">otherwise</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="n">exchange</span> <span class="o">-&gt;</span> <span class="o">{</span>
                        <span class="c1">// Start routes if they're stopped</span>
                        <span class="k">if</span> <span class="o">(!</span><span class="n">getContext</span><span class="o">().</span><span class="na">getRouteController</span><span class="o">().</span><span class="na">getRouteStatus</span><span class="o">(</span><span class="s">"order-processing-route"</span><span class="o">).</span><span class="na">isStarted</span><span class="o">())</span> <span class="o">{</span>
                            <span class="n">getContext</span><span class="o">().</span><span class="na">getRouteController</span><span class="o">().</span><span class="na">startRoute</span><span class="o">(</span><span class="s">"order-processing-route"</span><span class="o">);</span>
                        <span class="o">}</span>
                        <span class="k">if</span> <span class="o">(!</span><span class="n">getContext</span><span class="o">().</span><span class="na">getRouteController</span><span class="o">().</span><span class="na">getRouteStatus</span><span class="o">(</span><span class="s">"payment-processing-route"</span><span class="o">).</span><span class="na">isStarted</span><span class="o">())</span> <span class="o">{</span>
                            <span class="n">getContext</span><span class="o">().</span><span class="na">getRouteController</span><span class="o">().</span><span class="na">startRoute</span><span class="o">(</span><span class="s">"payment-processing-route"</span><span class="o">);</span>
                        <span class="o">}</span>
                    <span class="o">});</span>

        <span class="c1">// Order Processing Route with Circuit Breaker</span>
        <span class="n">from</span><span class="o">(</span><span class="s">"kafka:orders-topic"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">routeId</span><span class="o">(</span><span class="s">"order-processing-route"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">circuitBreaker</span><span class="o">()</span>
                <span class="o">.</span><span class="na">resilience4jConfiguration</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">failureRateThreshold</span><span class="o">(</span><span class="mi">50</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">waitDurationInOpenState</span><span class="o">(</span><span class="mi">10000</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">minimumNumberOfCalls</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>       <span class="c1">// Minimum calls before calculating failure rate</span>
                <span class="o">.</span><span class="na">end</span><span class="o">()</span>
                <span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="s">"Processing order: ${body}"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"http://order-service/api/orders"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"direct:payment-processor"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">onFallback</span><span class="o">()</span>
                <span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="nc">LoggingLevel</span><span class="o">.</span><span class="na">ERROR</span><span class="o">,</span> <span class="s">"Circuit Breaker triggered for order processing"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"kafka:failed-orders"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">end</span><span class="o">();</span>

        <span class="c1">// Payment Processing Route with Circuit Breaker</span>
        <span class="n">from</span><span class="o">(</span><span class="s">"direct:payment-processor"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">routeId</span><span class="o">(</span><span class="s">"payment-processing-route"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">circuitBreaker</span><span class="o">()</span>
                <span class="o">.</span><span class="na">resilience4jConfiguration</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">failureRateThreshold</span><span class="o">(</span><span class="mi">50</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">waitDurationInOpenState</span><span class="o">(</span><span class="mi">10000</span><span class="o">)</span>
                <span class="o">.</span><span class="na">end</span><span class="o">()</span>
                <span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="s">"Processing payment for order"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"http://payment-service/api/process"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">onFallback</span><span class="o">()</span>
                <span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="nc">LoggingLevel</span><span class="o">.</span><span class="na">ERROR</span><span class="o">,</span> <span class="s">"Circuit Breaker triggered for payment processing"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"kafka:failed-payments"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">end</span><span class="o">();</span>

        <span class="c1">// Error Handler Route</span>
        <span class="n">from</span><span class="o">(</span><span class="s">"direct:errorHandler"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">routeId</span><span class="o">(</span><span class="s">"error-handler-route"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="nc">LoggingLevel</span><span class="o">.</span><span class="na">ERROR</span><span class="o">,</span> <span class="s">"Error processing message: ${exception.message}"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">choice</span><span class="o">()</span>
                <span class="o">.</span><span class="na">when</span><span class="o">(</span><span class="n">header</span><span class="o">(</span><span class="s">"routeId"</span><span class="o">).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"order-processing-route"</span><span class="o">))</span>
                    <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"kafka:failed-orders"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">when</span><span class="o">(</span><span class="n">header</span><span class="o">(</span><span class="s">"routeId"</span><span class="o">).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"payment-processing-route"</span><span class="o">))</span>
                    <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"kafka:failed-payments"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">otherwise</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"kafka:dead-letter-queue"</span><span class="o">);</span>

        <span class="c1">// Recovery Route - Processes failed messages when system recovers</span>
        <span class="n">from</span><span class="o">(</span><span class="s">"kafka:failed-orders"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">routeId</span><span class="o">(</span><span class="s">"recovery-route"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">circuitBreaker</span><span class="o">()</span>
                <span class="o">.</span><span class="na">resilience4jConfiguration</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">failureRateThreshold</span><span class="o">(</span><span class="mi">50</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">waitDurationInOpenState</span><span class="o">(</span><span class="mi">30000</span><span class="o">)</span>
                <span class="o">.</span><span class="na">end</span><span class="o">()</span>
                <span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="s">"Attempting to recover failed order"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"http://order-service/api/orders"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">onFallback</span><span class="o">()</span>
                <span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="nc">LoggingLevel</span><span class="o">.</span><span class="na">ERROR</span><span class="o">,</span> <span class="s">"Recovery still not possible"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">end</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

</pre></table></code></div></div><p>Let’s visualize the route structure and circuit breaker flow:</p><pre><code class="language-mermaid">flowchart TD
    subgraph "Route Monitor"
        M[Monitor Timer] --&gt; HC{Health Check}
        HC --&gt;|Healthy| SR[Start Routes]
        HC --&gt;|Unhealthy| SP[Stop Routes]
    end

    subgraph "Order Processing"
        KO[Kafka Orders] --&gt; CB1{Circuit Breaker}
        CB1 --&gt;|Closed| OP[Process Order]
        CB1 --&gt;|Open| FB1[Fallback - Failed Orders]
        OP --&gt; PP[Payment Processing]
    end

    subgraph "Payment Processing"
        PP --&gt; CB2{Circuit Breaker}
        CB2 --&gt;|Closed| PS[Process Payment]
        CB2 --&gt;|Open| FB2[Fallback - Failed Payments]
    end

    subgraph "Recovery"
        FB1 --&gt; RR[Recovery Route]
        FB2 --&gt; RR
        RR --&gt; CB3{Circuit Breaker}
        CB3 --&gt;|Closed| RPR[Reprocess]
        CB3 --&gt;|Open| FB3[Delay Recovery]
    end

    style CB1 fill:#f96,stroke:#333
    style CB2 fill:#f96,stroke:#333
    style CB3 fill:#f96,stroke:#333
    style M fill:#69f,stroke:#333

</code></pre><p>Key features of this implementation:</p><ol><li><strong>Route Monitoring</strong>:<ul><li>Periodic health checks of destination systems<li>Automatic route stopping/starting based on system health<li>Configurable monitoring intervals</ul><li><strong>Circuit Breaker Pattern</strong>:<ul><li>Uses Resilience4j for circuit breaker implementation<li>Configurable failure thresholds and recovery times<li>Separate circuit breakers for different routes<li>Fallback mechanisms for handling failures</ul><li><strong>Multiple Routes</strong>:<ul><li>Order processing route<li>Payment processing route<li>Error handling route<li>Recovery route</ul><li><strong>Error Handling</strong>:<ul><li>Dead letter channel for failed messages<li>Different error queues for different types of failures<li>Retry mechanism with exponential backoff</ul><li><strong>Recovery Mechanism</strong>:<ul><li>Separate route for processing failed messages<li>Circuit breaker protection for recovery attempts<li>Longer wait times during recovery</ul></ol><p>To use this in your application:</p><ol><li>Add dependencies to <code class="language-plaintext highlighter-rouge">pom.xml</code>:</ol><div file="pom.xml" class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="pom.xml"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.apache.camel<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>camel-resilience4j<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.apache.camel<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>camel-kafka<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>
</pre></table></code></div></div><ol><li>Configure in <code class="language-plaintext highlighter-rouge">application.properties</code>:</ol><div file="application.properties" class="language-properties highlighter-rouge"><div class="code-header"> <span data-label-text="application.properties"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="c"># Circuit Breaker Configuration
</span><span class="py">camel.circuitbreaker.threshold</span><span class="p">=</span><span class="s">5</span>
<span class="py">camel.circuitbreaker.half-open-after</span><span class="p">=</span><span class="s">10000</span>

<span class="c"># Kafka Configuration
</span><span class="py">kafka.bootstrap.servers</span><span class="p">=</span><span class="s">localhost:9092</span>

<span class="c"># Health Check Configuration
</span><span class="py">health.check.interval</span><span class="p">=</span><span class="s">60000</span>
</pre></table></code></div></div><h2 id="health-checks"><span class="mr-2">Health Check (Optional)</span><a href="#health-checks" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In the previous example, we saw how based on a health check we can stop and start routes. The timer will invoke the health check route at fixed intervals. Let’s zoom into the implementation of the health check and see how it can be implemented to consider various different systems.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">org.apache.camel.Exchange</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.camel.builder.RouteBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.config.RequestConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClientBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpGet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.sql.DataSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.Connection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.Socket</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.extern.slf4j.Slf4j</span><span class="o">;</span>

<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HealthCheckRoute</span> <span class="kd">extends</span> <span class="nc">RouteBuilder</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">TIMEOUT</span> <span class="o">=</span> <span class="mi">5000</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">ORDER_SERVICE_URL</span> <span class="o">=</span> <span class="s">"http://order-service/health"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">PAYMENT_SERVICE_URL</span> <span class="o">=</span> <span class="s">"http://payment-service/health"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">MQ_HOST</span> <span class="o">=</span> <span class="s">"localhost"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">MQ_PORT</span> <span class="o">=</span> <span class="mi">61616</span><span class="o">;</span>
    
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">DataSource</span> <span class="n">dataSource</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">HealthCheckRoute</span><span class="o">(</span><span class="nc">DataSource</span> <span class="n">dataSource</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">dataSource</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">from</span><span class="o">(</span><span class="s">"timer:routeMonitor?period=60000"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">routeId</span><span class="o">(</span><span class="s">"health-check-route"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">checkDestinationHealth</span><span class="o">)</span>
            <span class="o">.</span><span class="na">choice</span><span class="o">()</span>
                <span class="o">.</span><span class="na">when</span><span class="o">(</span><span class="n">header</span><span class="o">(</span><span class="s">"systemStatus"</span><span class="o">).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"DOWN"</span><span class="o">))</span>
                    <span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="s">"System status is DOWN. Stopping routes..."</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="n">exchange</span> <span class="o">-&gt;</span> <span class="n">stopAffectedRoutes</span><span class="o">(</span><span class="n">exchange</span><span class="o">))</span>
                <span class="o">.</span><span class="na">otherwise</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="s">"System status is UP. Starting routes if needed..."</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="n">exchange</span> <span class="o">-&gt;</span> <span class="n">startRoutes</span><span class="o">(</span><span class="n">exchange</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">checkDestinationHealth</span><span class="o">(</span><span class="nc">Exchange</span> <span class="n">exchange</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">ServiceHealth</span><span class="o">&gt;</span> <span class="n">healthResults</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
        
        <span class="c1">// Check each service and store results</span>
        <span class="n">healthResults</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"orderService"</span><span class="o">,</span> <span class="n">checkHttpService</span><span class="o">(</span><span class="no">ORDER_SERVICE_URL</span><span class="o">));</span>
        <span class="n">healthResults</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"paymentService"</span><span class="o">,</span> <span class="n">checkHttpService</span><span class="o">(</span><span class="no">PAYMENT_SERVICE_URL</span><span class="o">));</span>
        <span class="n">healthResults</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"database"</span><span class="o">,</span> <span class="n">checkDatabase</span><span class="o">());</span>
        <span class="n">healthResults</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"messageQueue"</span><span class="o">,</span> <span class="n">checkMessageQueue</span><span class="o">());</span>
        
        <span class="c1">// Determine overall system status</span>
        <span class="kt">boolean</span> <span class="n">isSystemHealthy</span> <span class="o">=</span> <span class="n">healthResults</span><span class="o">.</span><span class="na">values</span><span class="o">().</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">allMatch</span><span class="o">(</span><span class="nl">ServiceHealth:</span><span class="o">:</span><span class="n">isHealthy</span><span class="o">);</span>
        
        <span class="c1">// Set headers with detailed health information</span>
        <span class="n">exchange</span><span class="o">.</span><span class="na">getIn</span><span class="o">().</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"systemStatus"</span><span class="o">,</span> <span class="n">isSystemHealthy</span> <span class="o">?</span> <span class="s">"UP"</span> <span class="o">:</span> <span class="s">"DOWN"</span><span class="o">);</span>
        <span class="n">exchange</span><span class="o">.</span><span class="na">getIn</span><span class="o">().</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"healthResults"</span><span class="o">,</span> <span class="n">healthResults</span><span class="o">);</span>
        
        <span class="c1">// Store specific service statuses for granular route control</span>
        <span class="n">exchange</span><span class="o">.</span><span class="na">getIn</span><span class="o">().</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"orderServiceStatus"</span><span class="o">,</span> 
            <span class="n">healthResults</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"orderService"</span><span class="o">).</span><span class="na">isHealthy</span><span class="o">()</span> <span class="o">?</span> <span class="s">"UP"</span> <span class="o">:</span> <span class="s">"DOWN"</span><span class="o">);</span>
        <span class="n">exchange</span><span class="o">.</span><span class="na">getIn</span><span class="o">().</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"paymentServiceStatus"</span><span class="o">,</span> 
            <span class="n">healthResults</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"paymentService"</span><span class="o">).</span><span class="na">isHealthy</span><span class="o">()</span> <span class="o">?</span> <span class="s">"UP"</span> <span class="o">:</span> <span class="s">"DOWN"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">ServiceHealth</span> <span class="nf">checkHttpService</span><span class="o">(</span><span class="nc">String</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">(</span><span class="nc">CloseableHttpClient</span> <span class="n">client</span> <span class="o">=</span> <span class="n">createHttpClient</span><span class="o">())</span> <span class="o">{</span>
            <span class="nc">HttpGet</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HttpGet</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
            <span class="kt">int</span> <span class="n">responseCode</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">request</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">getStatusLine</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">getStatusCode</span><span class="o">();</span>
            
            <span class="kt">boolean</span> <span class="n">isHealthy</span> <span class="o">=</span> <span class="n">responseCode</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">responseCode</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">;</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">ServiceHealth</span><span class="o">(</span>
                <span class="n">isHealthy</span><span class="o">,</span>
                <span class="n">isHealthy</span> <span class="o">?</span> <span class="s">"Service responding normally"</span> <span class="o">:</span> 
                           <span class="s">"Service returned status code: "</span> <span class="o">+</span> <span class="n">responseCode</span>
            <span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"Error checking HTTP service {}: {}"</span><span class="o">,</span> <span class="n">url</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">ServiceHealth</span><span class="o">(</span><span class="kc">false</span><span class="o">,</span> <span class="s">"Service check failed: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">ServiceHealth</span> <span class="nf">checkDatabase</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">(</span><span class="nc">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">.</span><span class="na">getConnection</span><span class="o">())</span> <span class="o">{</span>
            <span class="kt">boolean</span> <span class="n">isValid</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">isValid</span><span class="o">(</span><span class="no">TIMEOUT</span><span class="o">);</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">ServiceHealth</span><span class="o">(</span>
                <span class="n">isValid</span><span class="o">,</span>
                <span class="n">isValid</span> <span class="o">?</span> <span class="s">"Database connection is valid"</span> <span class="o">:</span> 
                         <span class="s">"Database connection test failed"</span>
            <span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"Database health check failed: {}"</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">ServiceHealth</span><span class="o">(</span><span class="kc">false</span><span class="o">,</span> <span class="s">"Database check failed: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">ServiceHealth</span> <span class="nf">checkMessageQueue</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">(</span><span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Socket</span><span class="o">(</span><span class="no">MQ_HOST</span><span class="o">,</span> <span class="no">MQ_PORT</span><span class="o">))</span> <span class="o">{</span>
            <span class="kt">boolean</span> <span class="n">isConnected</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="na">isConnected</span><span class="o">();</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">ServiceHealth</span><span class="o">(</span>
                <span class="n">isConnected</span><span class="o">,</span>
                <span class="n">isConnected</span> <span class="o">?</span> <span class="s">"Message queue is accessible"</span> <span class="o">:</span> 
                             <span class="s">"Could not connect to message queue"</span>
            <span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"Message queue health check failed: {}"</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">ServiceHealth</span><span class="o">(</span><span class="kc">false</span><span class="o">,</span> <span class="s">"Message queue check failed: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">CloseableHttpClient</span> <span class="nf">createHttpClient</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">RequestConfig</span> <span class="n">config</span> <span class="o">=</span> <span class="nc">RequestConfig</span><span class="o">.</span><span class="na">custom</span><span class="o">()</span>
                <span class="o">.</span><span class="na">setConnectTimeout</span><span class="o">(</span><span class="no">TIMEOUT</span><span class="o">)</span>
                <span class="o">.</span><span class="na">setConnectionRequestTimeout</span><span class="o">(</span><span class="no">TIMEOUT</span><span class="o">)</span>
                <span class="o">.</span><span class="na">setSocketTimeout</span><span class="o">(</span><span class="no">TIMEOUT</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
                
        <span class="k">return</span> <span class="nc">HttpClientBuilder</span><span class="o">.</span><span class="na">create</span><span class="o">()</span>
                <span class="o">.</span><span class="na">setDefaultRequestConfig</span><span class="o">(</span><span class="n">config</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">stopAffectedRoutes</span><span class="o">(</span><span class="nc">Exchange</span> <span class="n">exchange</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">ServiceHealth</span><span class="o">&gt;</span> <span class="n">healthResults</span> <span class="o">=</span> 
            <span class="n">exchange</span><span class="o">.</span><span class="na">getIn</span><span class="o">().</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"healthResults"</span><span class="o">,</span> <span class="nc">Map</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">healthResults</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"orderService"</span><span class="o">).</span><span class="na">isHealthy</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">getContext</span><span class="o">().</span><span class="na">getRouteController</span><span class="o">().</span><span class="na">stopRoute</span><span class="o">(</span><span class="s">"order-processing-route"</span><span class="o">);</span>
                <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Stopped order-processing-route due to health check failure"</span><span class="o">);</span>
            <span class="o">}</span>
            
            <span class="k">if</span> <span class="o">(!</span><span class="n">healthResults</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"paymentService"</span><span class="o">).</span><span class="na">isHealthy</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">getContext</span><span class="o">().</span><span class="na">getRouteController</span><span class="o">().</span><span class="na">stopRoute</span><span class="o">(</span><span class="s">"payment-processing-route"</span><span class="o">);</span>
                <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Stopped payment-processing-route due to health check failure"</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"Error stopping routes: {}"</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">startRoutes</span><span class="o">(</span><span class="nc">Exchange</span> <span class="n">exchange</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">ServiceHealth</span><span class="o">&gt;</span> <span class="n">healthResults</span> <span class="o">=</span> 
            <span class="n">exchange</span><span class="o">.</span><span class="na">getIn</span><span class="o">().</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"healthResults"</span><span class="o">,</span> <span class="nc">Map</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
            
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">healthResults</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"orderService"</span><span class="o">).</span><span class="na">isHealthy</span><span class="o">()</span> <span class="o">&amp;&amp;</span> 
                <span class="o">!</span><span class="n">getContext</span><span class="o">().</span><span class="na">getRouteController</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">getRouteStatus</span><span class="o">(</span><span class="s">"order-processing-route"</span><span class="o">).</span><span class="na">isStarted</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">getContext</span><span class="o">().</span><span class="na">getRouteController</span><span class="o">().</span><span class="na">startRoute</span><span class="o">(</span><span class="s">"order-processing-route"</span><span class="o">);</span>
                <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Started order-processing-route after health check recovery"</span><span class="o">);</span>
            <span class="o">}</span>
            
            <span class="k">if</span> <span class="o">(</span><span class="n">healthResults</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"paymentService"</span><span class="o">).</span><span class="na">isHealthy</span><span class="o">()</span> <span class="o">&amp;&amp;</span> 
                <span class="o">!</span><span class="n">getContext</span><span class="o">().</span><span class="na">getRouteController</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">getRouteStatus</span><span class="o">(</span><span class="s">"payment-processing-route"</span><span class="o">).</span><span class="na">isStarted</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">getContext</span><span class="o">().</span><span class="na">getRouteController</span><span class="o">().</span><span class="na">startRoute</span><span class="o">(</span><span class="s">"payment-processing-route"</span><span class="o">);</span>
                <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Started payment-processing-route after health check recovery"</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"Error starting routes: {}"</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="nd">@lombok</span><span class="o">.</span><span class="na">Value</span>
<span class="kd">class</span> <span class="nc">ServiceHealth</span> <span class="o">{</span>
    <span class="kt">boolean</span> <span class="n">healthy</span><span class="o">;</span>
    <span class="nc">String</span> <span class="n">message</span><span class="o">;</span>
<span class="o">}</span>

</pre></table></code></div></div><h3 id="health-check-visualization"><span class="mr-2">Health Check Visualization</span><a href="#health-check-visualization" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><pre><code class="language-mermaid">flowchart TD
    Timer[Timer Trigger] --&gt; HC[Health Check Process]
    
    subgraph "Health Checks"
        HC --&gt; |Check| HTTP[HTTP Services]
        HC --&gt; |Check| DB[Database]
        HC --&gt; |Check| MQ[Message Queue]
    end
    
    subgraph "Status Evaluation"
        HTTP --&gt; Eval[Evaluate Results]
        DB --&gt; Eval
        MQ --&gt; Eval
        Eval --&gt; Status{System Status}
    end
    
    Status --&gt;|DOWN| Stop[Stop Affected Routes]
    Status --&gt;|UP| Start[Start Routes if Stopped]
    
    style HC fill:#f96,stroke:#333
    style Status fill:#69f,stroke:#333
</code></pre><p>Key points about the implementation:</p><ol><li><strong>Health Check Process</strong>:<ul><li>Checks multiple services: HTTP endpoints, database, message queue<li>Each check has a timeout (5 seconds)<li>Results are stored in a <code class="language-plaintext highlighter-rouge">ServiceHealth</code> object containing:<ul><li><code class="language-plaintext highlighter-rouge">healthy</code>: boolean status<li><code class="language-plaintext highlighter-rouge">message</code>: detailed status message</ul></ul><li><strong>Status Headers</strong>:<ul><li><code class="language-plaintext highlighter-rouge">systemStatus</code>: Overall system status (“UP” or “DOWN”)<li><code class="language-plaintext highlighter-rouge">healthResults</code>: Map containing detailed health check results<li><code class="language-plaintext highlighter-rouge">orderServiceStatus</code>: Specific status for order service<li><code class="language-plaintext highlighter-rouge">paymentServiceStatus</code>: Specific status for payment service</ul><li><strong>Route Control</strong>:<ul><li>Routes are stopped/started based on their specific service health<li>Order processing route depends on order service health<li>Payment processing route depends on payment service health</ul></ol><p>To use this implementation:</p><ol><li>Add required dependencies:</ol><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.apache.httpcomponents<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>httpclient<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>
</pre></table></code></div></div><ol><li>Configure in <code class="language-plaintext highlighter-rouge">application.properties</code>:</ol><div class="language-properties highlighter-rouge"><div class="code-header"> <span data-label-text="Properties"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="c"># Health Check Configuration
</span><span class="py">health.check.timeout</span><span class="p">=</span><span class="s">5000</span>
<span class="py">health.check.order.service.url</span><span class="p">=</span><span class="s">http://order-service/health</span>
<span class="py">health.check.payment.service.url</span><span class="p">=</span><span class="s">http://payment-service/health</span>
<span class="py">health.check.mq.host</span><span class="p">=</span><span class="s">localhost</span>
<span class="py">health.check.mq.port</span><span class="p">=</span><span class="s">61616</span>
</pre></table></code></div></div><h2 id="conclusion"><span class="mr-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Apache Camel provides a powerful framework for implementing enterprise integration patterns. By combining these patterns with robust system management features like circuit breakers and health checks, you can build reliable, scalable integration solutions.</p><p>Remember to always:</p><ul><li>Implement proper error handling<li>Monitor system health<li>Use circuit breakers to prevent cascade failures<li>Maintain clear logging and monitoring<li>Consider message persistence and reliability requirements</ul><p>For more information, visit the <a href="https://camel.apache.org/documentation/">Apache Camel documentation</a>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/blogging/'>Blogging</a>, <a href='/categories/article/'>Article</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/softwareengineering/" class="post-tag no-text-decoration" >softwareengineering</a> <a href="/tags/backenddevelopment/" class="post-tag no-text-decoration" >backenddevelopment</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Understanding+Apache+Camel%3A+A+Comprehensive+Guide+to+Integration+Patterns+and+System+Management+-+Pravin+on+Software&url=https%3A%2F%2Fpravin.dev%2Fposts%2Fapache-camel-application-integration%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Understanding+Apache+Camel%3A+A+Comprehensive+Guide+to+Integration+Patterns+and+System+Management+-+Pravin+on+Software&u=https%3A%2F%2Fpravin.dev%2Fposts%2Fapache-camel-application-integration%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fpravin.dev%2Fposts%2Fapache-camel-application-integration%2F&text=Understanding+Apache+Camel%3A+A+Comprehensive+Guide+to+Integration+Patterns+and+System+Management+-+Pravin+on+Software" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fpravin.dev%2Fposts%2Fapache-camel-application-integration%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/database-engineering-fundamental-part-2/">Part 2: Database Engineering Fundamentals</a><li><a href="/posts/system-design-roadmap/">Comprehensive Roadmap for Low-Level and High-Level Design Interview Preparation</a><li><a href="/database-engineering-fundamental-part-5/write-amplification-problem-in-postgresql/">Part 5: Database Engineering Fundamentals: Write Amplification Problem in PostgreSQL</a><li><a href="/database-engineering-fundamental-part-1/">Part 1: Database Engineering Fundamentals</a><li><a href="/database-engineering-fundamental-part-1/database-page/">Part 1: Database Engineering Fundamentals: Database Page</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/backenddevelopment/">backenddevelopment</a> <a class="post-tag" href="/tags/softwareengineering/">softwareengineering</a> <a class="post-tag" href="/tags/database-engineering/">database-engineering</a> <a class="post-tag" href="/tags/design/">design</a> <a class="post-tag" href="/tags/coding/">coding</a> <a class="post-tag" href="/tags/smells/">smells</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/nodejs/">nodejs</a> <a class="post-tag" href="/tags/softwaredevelopment/">softwaredevelopment</a> <a class="post-tag" href="/tags/aws/">aws</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/database-engineering-fundamental-part-5/write-amplification-problem-in-postgresql/"><div class="card-body"> <em class="small" data-ts="1720157400" data-df="ll" > Jul 5, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Part 5: Database Engineering Fundamentals: Write Amplification Problem in PostgreSQL</h3><div class="text-muted small"><p> Write Amplification Problem in PostgreSQL Write Amplification Problem in PostgreSQL The Write Amplification Problem (WAP) typically arises in systems using Solid State Drives (SSDs) or other stor...</p></div></div></a></div><div class="card"> <a href="/posts/rate-limiting-using-spring-aop/"><div class="card-body"> <em class="small" data-ts="1722450600" data-df="ll" > Aug 1, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How to Implement Rate Limiting in Spring Boot APIs Using Aspect-Oriented Programming (AOP)</h3><div class="text-muted small"><p> Introduction Aspect-Oriented Programming (AOP) is a powerful technique in Spring Boot for separating cross-cutting concerns from the main application logic. One common use case of AOP is implementi...</p></div></div></a></div><div class="card"> <a href="/posts/caching-in-springboot-with-redis/"><div class="card-body"> <em class="small" data-ts="1725388200" data-df="ll" > Sep 4, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Comprehensive Guide to Caching in Spring Boot with Redis</h3><div class="text-muted small"><p> Introduction Caching is a crucial optimization technique that enhances application performance by reducing database load and response time. Spring Boot provides built-in support for caching via th...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/tech-blogs-become-better-software-engineer/" class="btn btn-outline-primary" prompt="Older"><p>Tech Blogs: Become better software Engineer</p></a> <a href="/posts/scalabilities-for-dummies/" class="btn btn-outline-primary" prompt="Newer"><p>Scalability for Dummies: A Comprehensive Guide to Building Scalable Web Services</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://pravin.dev/posts/apache-camel-application-integration/'; this.page.identifier = '/posts/apache-camel-application-integration/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://pravin-dev.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://www.linkedin.com/in/pravin-r-tripathi">Pravin Tripathi</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/backenddevelopment/">backenddevelopment</a> <a class="post-tag" href="/tags/softwareengineering/">softwareengineering</a> <a class="post-tag" href="/tags/database-engineering/">database-engineering</a> <a class="post-tag" href="/tags/design/">design</a> <a class="post-tag" href="/tags/coding/">coding</a> <a class="post-tag" href="/tags/smells/">smells</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/nodejs/">nodejs</a> <a class="post-tag" href="/tags/softwaredevelopment/">softwaredevelopment</a> <a class="post-tag" href="/tags/aws/">aws</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-WP90FFJ6SJ"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-WP90FFJ6SJ'); }); </script>
