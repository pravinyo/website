<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Part 2: Database Engineering Fundamentals" /><meta name="author" content="Pravin Tripathi" /><meta property="og:locale" content="en" /><meta name="description" content="Table of Contents" /><meta property="og:description" content="Table of Contents" /><link rel="canonical" href="https://pravin.dev/database-engineering-fundamental-part-2/" /><meta property="og:url" content="https://pravin.dev/database-engineering-fundamental-part-2/" /><meta property="og:site_name" content="Pravin on Software" /><meta property="og:image" content="https://pravin.dev/header.png" /><meta property="og:image:height" content="900" /><meta property="og:image:width" content="1600" /><meta property="og:image:alt" content="Generated using Copilot" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-07-02T01:00:00+05:30" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://pravin.dev/header.png" /><meta name="twitter:image:alt" content="Generated using Copilot" /><meta property="twitter:title" content="Part 2: Database Engineering Fundamentals" /><meta name="twitter:site" content="@pravin_yo" /><meta name="twitter:creator" content="@pravin_yo" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Pravin Tripathi","url":"https://www.linkedin.com/in/pravin-r-tripathi"},"dateModified":"2025-04-23T16:43:20+05:30","datePublished":"2024-07-02T01:00:00+05:30","description":"Table of Contents","headline":"Part 2: Database Engineering Fundamentals","image":{"width":1600,"height":900,"alt":"Generated using Copilot","url":"https://pravin.dev/header.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://pravin.dev/database-engineering-fundamental-part-2/"},"url":"https://pravin.dev/database-engineering-fundamental-part-2/"}</script><title>Part 2: Database Engineering Fundamentals | Pravin on Software</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Pravin on Software"><meta name="application-name" content="Pravin on Software"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Pravin on Software</a></div><div class="site-subtitle font-italic">My Learning and Experiments in Software Engineering</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/pravinyo" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/pravin_yo" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['pravinyo12','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Part 2: Database Engineering Fundamentals</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Part 2: Database Engineering Fundamentals</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1719862200" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 2, 2024 </em> </span> <span> Updated <em class="" data-ts="1745406800" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Apr 23, 2025 </em> </span><div class="mt-3 mb-3"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1600 900'%3E%3C/svg%3E" data-src="/assets/img/database-engineering-fundamental-part-2/header.png" class="preview-img bg" alt="Generated using Copilot" width="1600" height="900" data-proofer-ignore><figcaption class="pt-2 pb-2">Generated using Copilot</figcaption></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://www.linkedin.com/in/pravin-r-tripathi">Pravin Tripathi</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1502 words"> <em>8 min</em> read</span></div></div></div><div class="post-content"><h2 id="table-of-contents"><span class="mr-2">Table of Contents</span><a href="#table-of-contents" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="b-tree-vs-b-tree-in-production-database-systems"><span class="mr-2"><strong>B-Tree vs B+ Tree in Production Database Systems</strong></span><a href="#b-tree-vs-b-tree-in-production-database-systems" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><a href="#full-table-scan">Full Table Scans</a><li><a href="#b-tree">B-Tree</a><li><a href="#limitation-of-b-tree">B-Tree limitations</a><li>[B+Tree]<li>[B+Tree Considerations]<li><a href="#storage-cost-in-postgres-vs-mysql">B+Tree storage cost in MySQL vs Postgres</a></ul><h3 id="database-partitioning"><span class="mr-2"><strong>Database Partitioning</strong></span><a href="#database-partitioning" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><a href="#database-partitioning">What is Partitioning?</a><li><a href="#vertical-vs-horizontal-partitioning">Horizontal Partitioning vs Vertical Partitioning</a><li><a href="#partitioning-types">Partitioning Types</a><li><a href="#horizontal-partitioning-vs-sharding">Partitioning vs Sharding</a><li><a href="#implementing-partitioning-in-postgresql">Demo</a><li><a href="#pros-of-partitioning">Pros &amp; Cons</a></ul><h3 id="database-sharding"><span class="mr-2"><strong>Database Sharding</strong></span><a href="#database-sharding" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><a href="#what-is-sharding">What is sharding?</a><li><a href="#consistent-hashing">Consistent Hashing</a><li><a href="#horizontal-partitioning-vs-sharding-1">Horizontal Partitioning vs Sharding</a><li><a href="#pros-of-sharding">Pros &amp; Cons</a><li><a href="#when-should-you-consider-sharding-your-database">When Should You Consider Sharding Your Database?</a></ul><hr /><h2 id="b-tree-vs-b-tree-in-production-database-systems-1"><span class="mr-2">B-Tree vs B+ Tree in Production Database Systems</span><a href="#b-tree-vs-b-tree-in-production-database-systems-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><em>And their impact on production database systems</em></p><h3 id="topics-overview"><span class="mr-2">Topics Overview</span><a href="#topics-overview" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Full Table Scans<li>B-Tree<li>B-Tree limitations<li>B+Tree<li>B+Tree Considerations<li>B+Tree storage cost in MySQL vs Postgres<li>Summary</ul><h3 id="full-table-scan"><span class="mr-2">Full Table Scan</span><a href="#full-table-scan" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>To find a row in a large table we perform full table scan<li>Reading the entire table is slow (many IO to fetch pages)<li>We need a way to reduce the search space</ul><h3 id="b-tree"><span class="mr-2">B-Tree</span><a href="#b-tree" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Balanced data structure for fast traversal<li>B-Tree has nodes<li>In B-Tree of “m” degree each node can have (m) child nodes<li>Node has up to (m-1) elements<li>Each element has key and value<li>The value is usually data pointer to the row<li>Data pointer can point to primary key or tuple<li>Root Node, internal node and leaf nodes<li>A node = disk page</ul><p><img data-src="/assets/img/database-engineering-fundamental-part-2/image.png" alt="B-Tree Structure" data-proofer-ignore></p><h3 id="limitation-of-b-tree"><span class="mr-2">Limitation of B-Tree</span><a href="#limitation-of-b-tree" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Elements in all nodes store both key and value<li>Internal nodes take more space thus require more IO and can slow down traversal<li>Range queries are slow because of random access (give me all values 1-5)<li>B+Tree solves both these problems<li>Hard to fit internal nodes in memory</ul><h3 id="btree"><span class="mr-2">B+Tree</span><a href="#btree" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Exactly like B-Tree but only stores keys in internal nodes<li>Values are only stored in leaf nodes<li>Internal nodes are smaller since they only store keys and they can fit more elements<li>Leaf nodes are “linked” so once you find a key you can find all values before and after that key<li>Great for range queries</ul><h3 id="btree--dbms-considerations"><span class="mr-2">B+Tree &amp; DBMS Considerations</span><a href="#btree--dbms-considerations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Cost of leaf pointer (cheap)<li>1 Node fits a DBMS page (most DBMS)<li>Can fit internal nodes easily in memory for fast traversal<li>Leaf nodes can live in data files in the heap<li>Most DBMS systems use B+Tree<li>MongoDB (WiredTiger) uses B-Tree</ul><h3 id="storage-cost-in-postgres-vs-mysql"><span class="mr-2">Storage Cost in Postgres vs MySQL</span><a href="#storage-cost-in-postgres-vs-mysql" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>B+Trees secondary index values can either point directly to the tuple (Postgres) or to the primary key (MySQL)<li>If the Primary key data type is expensive this can cause bloat in all secondary indexes for databases such as MySQL (InnoDB)<li>Leaf nodes in MySQL (InnoDB) contains the full row since it’s an IOT / clustered index</ul><p>Reference: <a href="/assets/document/attachment/database-engineering-fundamental-part-2//b-tree-original-paper.pdf">b-tree-original-paper.pdf</a></p><hr /><h2 id="database-partitioning-1"><span class="mr-2">Database Partitioning</span><a href="#database-partitioning-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="topics-overview-1"><span class="mr-2">Topics Overview</span><a href="#topics-overview-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>What is Partitioning?<li>Horizontal Partitioning vs Vertical Partitioning<li>Partitioning Types<li>Partitioning vs Sharding<li>Demo<li>Pros &amp; Cons</ul><p><img data-src="/assets/img/database-engineering-fundamental-part-2/image%201.png" alt="Partitioning Diagram" data-proofer-ignore></p><p>Using partitioning, we can split large tables into smaller manageable tables that make lookups quite efficient.</p><h3 id="vertical-vs-horizontal-partitioning"><span class="mr-2">Vertical vs Horizontal Partitioning</span><a href="#vertical-vs-horizontal-partitioning" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><strong>Horizontal Partitioning</strong> splits rows into partitions<ul><li>Range or list</ul><li><strong>Vertical partitioning</strong> splits columns into partitions<ul><li>Large column (blob) that you can store in a slow access drive in its own tablespace</ul></ul><h3 id="partitioning-types"><span class="mr-2">Partitioning Types</span><a href="#partitioning-types" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><strong>By Range</strong><ul><li>Dates, ids (e.g., by logdate or customerid from-to)</ul><li><strong>By List</strong><ul><li>Discrete values (e.g., states CA, AL, etc.) or zip codes</ul><li><strong>By Hash</strong><ul><li>Hash functions (consistent hashing)</ul></ul><h3 id="horizontal-partitioning-vs-sharding"><span class="mr-2">Horizontal Partitioning vs Sharding</span><a href="#horizontal-partitioning-vs-sharding" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>HP splits big table into multiple tables in the same database, client is agnostic<li>Sharding splits big table into multiple tables across multiple database servers<li>HP table name changes (or schema)<li>Sharding everything is the same but server changes</ul><h3 id="implementing-partitioning-in-postgresql"><span class="mr-2">Implementing Partitioning in PostgreSQL</span><a href="#implementing-partitioning-in-postgresql" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>To create a partition, follow these steps:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c1">-- Create the parent table with partitioning scheme</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">grades_parts</span><span class="p">(</span><span class="n">id</span> <span class="nb">serial</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span> <span class="k">g</span> <span class="nb">int</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">)</span> <span class="k">PARTITION</span> <span class="k">BY</span> <span class="k">RANGE</span><span class="p">(</span><span class="k">g</span><span class="p">);</span>

<span class="c1">-- Create individual partition tables</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">grade0035</span> <span class="p">(</span><span class="k">LIKE</span> <span class="n">grades_parts</span> <span class="k">INCLUDING</span> <span class="n">INDEXES</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">grade3560</span> <span class="p">(</span><span class="k">LIKE</span> <span class="n">grades_parts</span> <span class="k">INCLUDING</span> <span class="n">INDEXES</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">grade6080</span> <span class="p">(</span><span class="k">LIKE</span> <span class="n">grades_parts</span> <span class="k">INCLUDING</span> <span class="n">INDEXES</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">grade80100</span> <span class="p">(</span><span class="k">LIKE</span> <span class="n">grades_parts</span> <span class="k">INCLUDING</span> <span class="n">INDEXES</span><span class="p">);</span>
</pre></table></code></div></div><p>Once we have created the main table and partition tables, we attach the partition tables to the main table:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c1">-- Attach partitions with their respective ranges</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">grades_parts</span> <span class="n">ATTACH</span> <span class="k">PARTITION</span> <span class="n">grade0035</span> <span class="k">FOR</span> <span class="k">VALUES</span> <span class="k">FROM</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">TO</span> <span class="p">(</span><span class="mi">35</span><span class="p">);</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">grades_parts</span> <span class="n">ATTACH</span> <span class="k">PARTITION</span> <span class="n">grade3560</span> <span class="k">FOR</span> <span class="k">VALUES</span> <span class="k">FROM</span> <span class="p">(</span><span class="mi">35</span><span class="p">)</span> <span class="k">TO</span> <span class="p">(</span><span class="mi">60</span><span class="p">);</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">grades_parts</span> <span class="n">ATTACH</span> <span class="k">PARTITION</span> <span class="n">grade6080</span> <span class="k">FOR</span> <span class="k">VALUES</span> <span class="k">FROM</span> <span class="p">(</span><span class="mi">60</span><span class="p">)</span> <span class="k">TO</span> <span class="p">(</span><span class="mi">80</span><span class="p">);</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">grades_parts</span> <span class="n">ATTACH</span> <span class="k">PARTITION</span> <span class="n">grade80100</span> <span class="k">FOR</span> <span class="k">VALUES</span> <span class="k">FROM</span> <span class="p">(</span><span class="mi">80</span><span class="p">)</span> <span class="k">TO</span> <span class="p">(</span><span class="mi">100</span><span class="p">);</span>
</pre></table></code></div></div><p>Now our partition is attached and ready to populate data.</p><p>When we insert data into the main table (grades_parts), the database will decide which partition that record should go to based on the g values.</p><p>If you want to have an index on each partition, which is a common use case, you can do so by creating an index on the parent table:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">grades_parts_idx</span> <span class="k">ON</span> <span class="n">grades_parts</span><span class="p">(</span><span class="k">g</span><span class="p">);</span>
</pre></table></code></div></div><p>This is powerful and simplified - separate indexes will be created by the database for each partition table.</p><p>Some queries may check other partitions even though data isn’t present there:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">grades_parts</span> <span class="k">WHERE</span> <span class="k">g</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
</pre></table></code></div></div><p>Even though records should only be in the first partition (<code class="language-plaintext highlighter-rouge">grade0035</code>), the database might check other partitions too.</p><p>To optimize this behavior, you can enable partition pruning:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="k">SHOW</span> <span class="n">enable_partition_pruning</span><span class="p">;</span>
<span class="k">SET</span> <span class="n">enable_partition_pruning</span> <span class="o">=</span> <span class="k">on</span><span class="p">;</span>
</pre></table></code></div></div><p>This will make lookup happen in the first partition only and avoid looking at other partitions. It’s enabled by default in PostgreSQL.</p><h3 id="pros-of-partitioning"><span class="mr-2">Pros of Partitioning</span><a href="#pros-of-partitioning" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Improves query performance when accessing a single partition<li>Sequential scan vs scattered index scan<li>Easy bulk loading (attach partition)<li>Archive old data that are barely accessed into cheap storage</ul><h3 id="cons-of-partitioning"><span class="mr-2">Cons of Partitioning</span><a href="#cons-of-partitioning" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Updates that move rows from a partition to another (slow or fail sometimes)<li>Inefficient queries could accidentally scan all partitions resulting in slower performance<li>Schema changes can be challenging (DBMS could manage it though)</ul><hr /><h2 id="database-sharding-1"><span class="mr-2">Database Sharding</span><a href="#database-sharding-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="topics-overview-2"><span class="mr-2">Topics Overview</span><a href="#topics-overview-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>What is sharding?<li>Consistent Hashing<li>Horizontal Partitioning vs Sharding<li>Pros &amp; Cons</ul><h3 id="what-is-sharding"><span class="mr-2">What is Sharding?</span><a href="#what-is-sharding" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Sharding is a database architecture pattern related to horizontal partitioning, which is the practice of separating one table’s rows into multiple different tables, known as partitions or shards. Each partition has the same schema and columns, but entirely different rows.</p><p>In sharding, these smaller partitions are distributed across separate database nodes, often on different physical servers. This approach allows for better scalability and performance in large-scale applications.</p><ul><li>Sharding distributes data across multiple machines<li>Each shard is an independent database, and collectively, the shards make up a single logical database<li>Sharding is typically used to improve the performance and scalability of very large databases<li>It allows for horizontal scaling, which can be more cost-effective than vertical scaling (upgrading to more powerful hardware)</ul><p>Sharding is particularly useful for applications that deal with big data or high traffic, as it helps distribute the load and improve query response times.</p><p><img data-src="/assets/img/database-engineering-fundamental-part-2/image%202.png" alt="Sharding Diagram 1" data-proofer-ignore></p><p><img data-src="/assets/img/database-engineering-fundamental-part-2/image%203.png" alt="Sharding Diagram 2" data-proofer-ignore></p><h3 id="consistent-hashing"><span class="mr-2">Consistent Hashing</span><a href="#consistent-hashing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Consistent hashing is a technique used in database sharding to distribute data across multiple nodes efficiently. Here’s how it works:</p><ul><li>The hash space is represented as a fixed circular ring (usually 0 to 2^32 - 1)<li>Both data items and nodes (shards) are mapped to this ring using a hash function<li>To find which shard a data item belongs to, move clockwise on the ring from the item’s hash position until a node is found<li>When adding or removing nodes, only a fraction of the data needs to be redistributed</ul><p>This approach provides better distribution and minimizes data movement when the number of shards changes, making it ideal for dynamic environments.</p><p>Benefits of consistent hashing in database sharding:</p><ul><li><strong>Scalability</strong>: Easily add or remove shards without major data redistribution<li><strong>Load balancing</strong>: Evenly distributes data across shards<li><strong>Fault tolerance</strong>: If a shard fails, its data is redistributed among remaining shards<li><strong>Reduced hotspots</strong>: Helps prevent overloading of specific shards</ul><p>Many distributed databases and caching systems, like Cassandra and Redis, use consistent hashing for efficient data distribution across shards.</p><p><img data-src="/assets/img/database-engineering-fundamental-part-2/image%204.png" alt="Consistent Hashing Diagram" data-proofer-ignore></p><h3 id="horizontal-partitioning-vs-sharding-1"><span class="mr-2">Horizontal Partitioning vs Sharding</span><a href="#horizontal-partitioning-vs-sharding-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>HP splits big table into multiple tables in the same database<li>Sharding splits big table into multiple tables across multiple database servers<li>HP table name changes (or schema)<li>Sharding everything is the same but server changes</ul><h3 id="sharding-with-postgres"><span class="mr-2">Sharding with Postgres</span><a href="#sharding-with-postgres" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="sharding-with-postgres">Sharding with Postgres</a></p><h3 id="pros-of-sharding"><span class="mr-2">Pros of Sharding</span><a href="#pros-of-sharding" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><strong>Scalability</strong><ul><li>Data<li>Memory</ul><li><strong>Security</strong> (users can access certain shards)<li><strong>Optimal and smaller index size</strong></ul><h3 id="cons-of-sharding"><span class="mr-2">Cons of Sharding</span><a href="#cons-of-sharding" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Complex client (aware of the shard)<li>Transactions across shards problem<li>Rollbacks<li>Schema changes are hard<li>Joins<li>Has to be something you know in the query</ul><h3 id="when-should-you-consider-sharding-your-database"><span class="mr-2">When Should You Consider Sharding Your Database?</span><a href="#when-should-you-consider-sharding-your-database" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><strong>It should be the last option in your scaling strategy.</strong></p><p>You should consider sharding only if these options aren’t working for you:</p><ol><li>Apply indexing to tables<li>If indexing is not working, split tables into multiple partitions, each partition maintains small tables and has their own indexes<li>Have master-slave setup<li>Replicate the setup to region-specific instances like Asia, America, or EU users</ol><p>Sharding is one of the most complicated database scaling strategies.</p><p>In sharding, ACID transactions are difficult as they are distributed across different servers, becoming a distributed transaction use case.</p><p>You typically sacrifice full rollback and commit capabilities.</p><p>The application must be aware of the shards.</p><p>There are additional server maintenance costs.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/blogging/'>Blogging</a>, <a href='/categories/article/'>Article</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/softwareengineering/" class="post-tag no-text-decoration" >softwareengineering</a> <a href="/tags/backenddevelopment/" class="post-tag no-text-decoration" >backenddevelopment</a> <a href="/tags/database-engineering/" class="post-tag no-text-decoration" >database-engineering</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Part+2%3A+Database+Engineering+Fundamentals+-+Pravin+on+Software&url=https%3A%2F%2Fpravin.dev%2Fdatabase-engineering-fundamental-part-2%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Part+2%3A+Database+Engineering+Fundamentals+-+Pravin+on+Software&u=https%3A%2F%2Fpravin.dev%2Fdatabase-engineering-fundamental-part-2%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fpravin.dev%2Fdatabase-engineering-fundamental-part-2%2F&text=Part+2%3A+Database+Engineering+Fundamentals+-+Pravin+on+Software" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fpravin.dev%2Fdatabase-engineering-fundamental-part-2%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/database-engineering-fundamental-part-2/">Part 2: Database Engineering Fundamentals</a><li><a href="/posts/system-design-roadmap/">Comprehensive Roadmap for Low-Level and High-Level Design Interview Preparation</a><li><a href="/database-engineering-fundamental-part-5/write-amplification-problem-in-postgresql/">Part 5: Database Engineering Fundamentals: Write Amplification Problem in PostgreSQL</a><li><a href="/database-engineering-fundamental-part-1/">Part 1: Database Engineering Fundamentals</a><li><a href="/database-engineering-fundamental-part-1/database-page/">Part 1: Database Engineering Fundamentals: Database Page</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/backenddevelopment/">backenddevelopment</a> <a class="post-tag" href="/tags/softwareengineering/">softwareengineering</a> <a class="post-tag" href="/tags/database-engineering/">database-engineering</a> <a class="post-tag" href="/tags/design/">design</a> <a class="post-tag" href="/tags/coding/">coding</a> <a class="post-tag" href="/tags/smells/">smells</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/nodejs/">nodejs</a> <a class="post-tag" href="/tags/softwaredevelopment/">softwaredevelopment</a> <a class="post-tag" href="/tags/aws/">aws</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/database-engineering-fundamental-part-5/write-amplification-problem-in-postgresql/"><div class="card-body"> <em class="small" data-ts="1720157400" data-df="ll" > Jul 5, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Part 5: Database Engineering Fundamentals: Write Amplification Problem in PostgreSQL</h3><div class="text-muted small"><p> Write Amplification Problem in PostgreSQL Write Amplification Problem in PostgreSQL The Write Amplification Problem (WAP) typically arises in systems using Solid State Drives (SSDs) or other stor...</p></div></div></a></div><div class="card"> <a href="/database-engineering-fundamental-part-1/"><div class="card-body"> <em class="small" data-ts="1719775800" data-df="ll" > Jul 1, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Part 1: Database Engineering Fundamentals</h3><div class="text-muted small"><p> Table of Contents ACID Properties Understanding Database Internals Row-Based vs Column-Based Databases Primary Key vs Secondary Key Database Indexing SQL Query Planner and Optimizer ...</p></div></div></a></div><div class="card"> <a href="/database-engineering-fundamental-part-1/database-page/"><div class="card-body"> <em class="small" data-ts="1719779400" data-df="ll" > Jul 1, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Part 1: Database Engineering Fundamentals: Database Page</h3><div class="text-muted small"><p> Databases Pages (Article) Database Pages — A deep dive Databases often use fixed-size pages to store data. Tables, collections, rows, columns, indexes, sequences, documents and more eventually en...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/database-engineering-fundamental-part-1/the-cost-of-long-running-transactions/" class="btn btn-outline-primary" prompt="Older"><p>Part 1: Database Engineering Fundamentals: The Cost of Long running Transactions</p></a> <a href="/database-engineering-fundamental-part-2/sharding-with-postgres/" class="btn btn-outline-primary" prompt="Newer"><p>Part 2: Database Engineering Fundamentals: Sharding with Postgres</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://pravin.dev/database-engineering-fundamental-part-2/'; this.page.identifier = '/database-engineering-fundamental-part-2/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://pravin-dev.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://www.linkedin.com/in/pravin-r-tripathi">Pravin Tripathi</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/backenddevelopment/">backenddevelopment</a> <a class="post-tag" href="/tags/softwareengineering/">softwareengineering</a> <a class="post-tag" href="/tags/database-engineering/">database-engineering</a> <a class="post-tag" href="/tags/design/">design</a> <a class="post-tag" href="/tags/coding/">coding</a> <a class="post-tag" href="/tags/smells/">smells</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/nodejs/">nodejs</a> <a class="post-tag" href="/tags/softwaredevelopment/">softwaredevelopment</a> <a class="post-tag" href="/tags/aws/">aws</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-WP90FFJ6SJ"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-WP90FFJ6SJ'); }); </script>
