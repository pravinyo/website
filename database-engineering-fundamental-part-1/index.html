<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Part 1: Database Engineering Fundamentals" /><meta name="author" content="Pravin Tripathi" /><meta property="og:locale" content="en" /><meta name="description" content="Table of Contents ACID Properties Understanding Database Internals Row-Based vs Column-Based Databases Primary Key vs Secondary Key Database Indexing SQL Query Planner and Optimizer Scan Types Key vs Non-key Column Database Indexing Index Scan vs Index Only Scan Combining Database Indexes Database Optimizer Decisions Creating Indexes Concurrently Bloom Filters Working with Billion Row Tables Articles" /><meta property="og:description" content="Table of Contents ACID Properties Understanding Database Internals Row-Based vs Column-Based Databases Primary Key vs Secondary Key Database Indexing SQL Query Planner and Optimizer Scan Types Key vs Non-key Column Database Indexing Index Scan vs Index Only Scan Combining Database Indexes Database Optimizer Decisions Creating Indexes Concurrently Bloom Filters Working with Billion Row Tables Articles" /><link rel="canonical" href="https://pravin.dev/database-engineering-fundamental-part-1/" /><meta property="og:url" content="https://pravin.dev/database-engineering-fundamental-part-1/" /><meta property="og:site_name" content="Pravin on Software" /><meta property="og:image" content="https://pravin.dev/header.png" /><meta property="og:image:height" content="900" /><meta property="og:image:width" content="1600" /><meta property="og:image:alt" content="Generated using Copilot" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-07-01T01:00:00+05:30" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://pravin.dev/header.png" /><meta name="twitter:image:alt" content="Generated using Copilot" /><meta property="twitter:title" content="Part 1: Database Engineering Fundamentals" /><meta name="twitter:site" content="@pravin_yo" /><meta name="twitter:creator" content="@pravin_yo" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Pravin Tripathi","url":"https://www.linkedin.com/in/pravin-r-tripathi"},"dateModified":"2025-03-22T16:02:56+05:30","datePublished":"2024-07-01T01:00:00+05:30","description":"Table of Contents ACID Properties Understanding Database Internals Row-Based vs Column-Based Databases Primary Key vs Secondary Key Database Indexing SQL Query Planner and Optimizer Scan Types Key vs Non-key Column Database Indexing Index Scan vs Index Only Scan Combining Database Indexes Database Optimizer Decisions Creating Indexes Concurrently Bloom Filters Working with Billion Row Tables Articles","headline":"Part 1: Database Engineering Fundamentals","image":{"width":1600,"height":900,"alt":"Generated using Copilot","url":"https://pravin.dev/header.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://pravin.dev/database-engineering-fundamental-part-1/"},"url":"https://pravin.dev/database-engineering-fundamental-part-1/"}</script><title>Part 1: Database Engineering Fundamentals | Pravin on Software</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Pravin on Software"><meta name="application-name" content="Pravin on Software"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Pravin on Software</a></div><div class="site-subtitle font-italic">My Learning and Experiments in Software Engineering</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/pravinyo" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/pravin_yo" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['pravinyo12','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Part 1: Database Engineering Fundamentals</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Part 1: Database Engineering Fundamentals</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1719775800" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 1, 2024 </em> </span> <span> Updated <em class="" data-ts="1742639576" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Mar 22, 2025 </em> </span><div class="mt-3 mb-3"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1600 900'%3E%3C/svg%3E" data-src="/assets/img/database-engineering-fundamental-part-1/header.png" class="preview-img bg" alt="Generated using Copilot" width="1600" height="900" data-proofer-ignore><figcaption class="pt-2 pb-2">Generated using Copilot</figcaption></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://www.linkedin.com/in/pravin-r-tripathi">Pravin Tripathi</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4415 words"> <em>24 min</em> read</span></div></div></div><div class="post-content"><h2 id="table-of-contents"><span class="mr-2">Table of Contents</span><a href="#table-of-contents" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><a href="#acid-properties">ACID Properties</a><li><a href="#understanding-database-internals">Understanding Database Internals</a><li><a href="#row-based-vs-column-based-databases">Row-Based vs Column-Based Databases</a><li><a href="#primary-key-vs-secondary-key">Primary Key vs Secondary Key</a><li><a href="#database-indexing">Database Indexing</a><li><a href="#sql-query-planner-and-optimizer">SQL Query Planner and Optimizer</a><li><a href="#scan-types">Scan Types</a><li><a href="#key-vs-non-key-column-database-indexing">Key vs Non-key Column Database Indexing</a><li><a href="#index-scan-vs-index-only-scan">Index Scan vs Index Only Scan</a><li><a href="#combining-database-indexes-for-better-performance">Combining Database Indexes</a><li><a href="#database-optimizer-strategies">Database Optimizer Decisions</a><li><a href="#creating-indexes-concurrently">Creating Indexes Concurrently</a><li><a href="#bloom-filters">Bloom Filters</a><li><a href="#working-with-billion-row-tables">Working with Billion Row Tables</a><li><a href="#related-articles">Articles</a></ul><hr /><h2 id="acid-properties"><span class="mr-2">ACID Properties</span><a href="#acid-properties" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="what-is-a-transaction"><span class="mr-2">What is a transaction?</span><a href="#what-is-a-transaction" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>A collection of queries<li>One unit of work<li>Example: Select, Update, Update<li>Lifespan:<ul><li>Transaction BEGIN<li>Transaction COMMIT<li>Transaction ROLLBACK<li>Transaction unexpected ending → ROLLBACK</ul></ul><p>Different databases try to optimize operations like rollback or commit. In Postgres, commit I/O is more frequent and commit is faster.</p><h3 id="nature-of-transactions"><span class="mr-2">Nature of transactions</span><a href="#nature-of-transactions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Usually transactions are used to change and modify data<li>However, it is perfectly normal to have a read-only transaction<li>Example: You want to generate a report and you want to get a consistent snapshot based at the time of transaction<li>We will learn more about this in the Isolation section</ul><h3 id="atomicity"><span class="mr-2">Atomicity</span><a href="#atomicity" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>All queries in a transaction must succeed<li>If one query fails, all prior successful queries in the transaction should rollback<li>If the database went down prior to a commit of a transaction, all the successful queries in the transaction should rollback<li>After we restart the machine, the first account has been debited but the other account has not been credited<li>This is really bad as we just lost data, and the information is inconsistent<li>An atomic transaction is a transaction that will rollback all queries if one or more queries failed<li>The database should clean this up after restart</ul><p>Some databases don’t allow operations unless rollback is completed. For long transactions, it can take longer time (like 1 hour) to rollback.</p><h3 id="isolation"><span class="mr-2">Isolation</span><a href="#isolation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Can my inflight transaction see changes made by other transactions?<li>Read phenomena<li>Isolation Levels</ul><h3 id="isolation---read-phenomena"><span class="mr-2">Isolation - Read phenomena</span><a href="#isolation---read-phenomena" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><strong>Dirty reads</strong>: Reading uncommitted data<li><strong>Non-repeatable reads</strong>: In a transaction, execution of the same read query results in different values at different times. It is expensive to undo. The value read is committed value but that happened during transaction<li><strong>Phantom reads</strong>: You are reading data which did not exist at the beginning of the transaction but got committed by another transaction in between. This data is read by a subsequent query<li><strong>Lost updates</strong>: Two transactions reading the same data and updating it in parallel. The update done by the first transaction gets modified by the second transaction. This makes the result inconsistent</ul><h3 id="isolation---levels"><span class="mr-2">Isolation - Levels</span><a href="#isolation---levels" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><strong>Read uncommitted</strong>: No isolation, any change from the outside is visible to the transaction, committed or not<li><strong>Read committed</strong>: Each query in a transaction only sees committed changes by other transactions<li><strong>Repeatable Read</strong>: The transaction will make sure that when a query reads a row, that row will remain unchanged while it’s running. (In Postgres, it is called snapshot isolation, it is versioned)<li><strong>Snapshot</strong>: Each query in a transaction only sees changes that have been committed up to the start of the transaction. It’s like a snapshot version of the database at that moment<li><strong>Serializable</strong>: Transactions are run as if they were serialized one after the other</ul><p><img data-src="/assets/img/database-engineering-fundamental-part-1/image.png" alt="Isolation Levels Comparison" data-proofer-ignore></p><ul><li><strong>Each DBMS implements isolation levels differently</strong><li><strong>Pessimistic</strong>: Row level locks, table locks, page locks to avoid lost updates<li><strong>Optimistic</strong>: No locks, just track if things changed and fail the transaction if so<li><strong>Repeatable read “locks”</strong> the rows it reads but it could be expensive if you read a lot of rows; Postgres implements RR as snapshot. That is why you don’t get phantom reads with Postgres in repeatable read<li><strong>Serializable</strong> are usually implemented with optimistic concurrency control, you can implement it pessimistically with SELECT FOR UPDATE</ul><hr /><h2 id="understanding-database-internals"><span class="mr-2">Understanding Database Internals</span><a href="#understanding-database-internals" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="how-tables-and-indexes-are-stored-on-disk"><span class="mr-2">How tables and indexes are stored on disk</span><a href="#how-tables-and-indexes-are-stored-on-disk" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Storage concepts:</p><ul><li>Table<li>Row_id<li>Page<li>IO<li>Heap data structure<li>Index data structure b-tree<li>Example of a query</ul><h4 id="logical-table"><span class="mr-2">Logical Table</span><a href="#logical-table" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><img data-src="/assets/img/database-engineering-fundamental-part-1/image%201.png" alt="Logical Table" data-proofer-ignore></p><h4 id="row_id"><span class="mr-2">Row_ID</span><a href="#row_id" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><img data-src="/assets/img/database-engineering-fundamental-part-1/image%202.png" alt="Row_ID" data-proofer-ignore></p><h4 id="page"><span class="mr-2">Page</span><a href="#page" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><img data-src="/assets/img/database-engineering-fundamental-part-1/image%203.png" alt="Page" data-proofer-ignore></p><h3 id="io"><span class="mr-2">IO</span><a href="#io" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>IO operation (input/output) is a read request to the disk<li>We try to minimize this as much as possible<li>An IO can fetch 1 page or more depending on the disk partitions and other factors<li>An IO cannot read a single row; it’s a page with many rows in them, you get them for free<li>You want to minimize the number of IOs as they are expensive<li>Some IOs in operating systems go to the operating system cache and not disk</ul><h3 id="heap"><span class="mr-2">Heap</span><a href="#heap" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>The Heap is a data structure where the table is stored with all its pages one after another<li>This is where the actual data is stored including everything<li>Traversing the heap is expensive as we need to read so much data to find what we want<li>That is why we need indexes that help tell us exactly what part of the heap we need to read, which page(s) of the heap we need to pull</ul><h3 id="index"><span class="mr-2">Index</span><a href="#index" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>An index is another data structure separate from the heap that has “pointers” to the heap<li>It has part of the data and is used to quickly search for something<li>You can index on one column or more<li>Once you find a value of the index, you go to the heap to fetch more information where everything is stored<li>Index tells you EXACTLY which page to fetch in the heap instead of taking the hit to scan every page in the heap<li>The index is also stored as pages and costs IO to pull the entries of the index<li>The smaller the index, the more it can fit in memory, and the faster the search<li>Popular data structure for index is b-trees, learn more on that in the b-tree section</ul><p><img data-src="/assets/img/database-engineering-fundamental-part-1/image%204.png" alt="Index Structure 1" data-proofer-ignore></p><p><img data-src="/assets/img/database-engineering-fundamental-part-1/image%205.png" alt="Index Structure 2" data-proofer-ignore></p><p><img data-src="/assets/img/database-engineering-fundamental-part-1/image%206.png" alt="Index Structure 3" data-proofer-ignore></p><p><img data-src="/assets/img/database-engineering-fundamental-part-1/image%207.png" alt="Index Structure 4" data-proofer-ignore></p><p><strong>Notes:</strong></p><ul><li>Sometimes the heap table can be organized around a single index. This is called a clustered index or an Index Organized Table<li>Primary key is usually a clustered index unless otherwise specified<li>MySQL InnoDB always has a primary key (clustered index); other indexes point to the primary key “value”<li>Postgres only has secondary indexes and all indexes point directly to the row_id which lives in the heap</ul><hr /><h2 id="row-based-vs-column-based-databases"><span class="mr-2">Row-Based vs Column-Based Databases</span><a href="#row-based-vs-column-based-databases" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In row-based databases, data is organized in a continuous sequence of bytes which contains all columns of the row together. When a record is fetched, the whole page is returned which contains a number of rows including the one that the query is made for.</p><ul><li>Tables are stored as rows in disk<li>A single block IO read to the table fetches multiple rows with all their columns<li>More IOs are required to find a particular row in a table scan but once you find the row, you get all columns for that row</ul><p><img data-src="/assets/img/database-engineering-fundamental-part-1/image%208.png" alt="Row-based DB" data-proofer-ignore></p><p>For column-based databases, columns are stored separately where column 1 of all records will be together and the same for all other columns.</p><ul><li>Tables are stored as columns first in disk<li>A single block IO read to the table fetches multiple columns with all matching rows<li>Less IOs are required to get more values of a given column. But working with multiple columns requires more IOs<li>Typically used for OLAP workloads</ul><p><img data-src="/assets/img/database-engineering-fundamental-part-1/image%209.png" alt="Column-based DB 1" data-proofer-ignore></p><p><img data-src="/assets/img/database-engineering-fundamental-part-1/image%2010.png" alt="Column-based DB 2" data-proofer-ignore></p><p><img data-src="/assets/img/database-engineering-fundamental-part-1/image%2011.png" alt="Column-based DB 3" data-proofer-ignore></p><hr /><h2 id="primary-key-vs-secondary-key"><span class="mr-2">Primary Key vs Secondary Key</span><a href="#primary-key-vs-secondary-key" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><strong>Clustering</strong> - organizing a table around a key → Primary key (Oracle and MySQL offer this)</p><p>A cluster is nothing but a heap → it is designed for speed for operations like range searches in one IO.</p><p><strong>Secondary key</strong> → having an additional index in the form of a btree. It has a separate structure from the order in which data is stored. It has row_id as a reference, which is used to locate the actual data.</p><p>All indexes in Postgres are secondary indexes.</p><hr /><h2 id="database-indexing"><span class="mr-2">Database Indexing</span><a href="#database-indexing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>To check query execution strategy: <code class="language-plaintext highlighter-rouge">explain analyze select id from employees e where e.id = 20000;</code></p><p>To create an index: <code class="language-plaintext highlighter-rouge">create index &lt;index_name&gt; on table(column_name);</code></p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="k">create</span> <span class="k">table</span> <span class="n">employees</span><span class="p">(</span> <span class="n">id</span> <span class="nb">serial</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span> <span class="n">name</span> <span class="nb">text</span><span class="p">);</span>

<span class="k">create</span> <span class="k">or</span> <span class="k">replace</span> <span class="k">function</span> <span class="n">random_string</span><span class="p">(</span><span class="k">length</span> <span class="nb">integer</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">text</span> <span class="k">as</span> 
<span class="err">$$</span>
<span class="k">declare</span>
  <span class="n">chars</span> <span class="nb">text</span><span class="p">[]</span> <span class="p">:</span><span class="o">=</span> <span class="s1">'{0,1,2,3,4,5,6,7,8,9,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z}'</span><span class="p">;</span>
  <span class="k">result</span> <span class="nb">text</span> <span class="p">:</span><span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
  <span class="n">i</span> <span class="nb">integer</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">length2</span> <span class="nb">integer</span> <span class="p">:</span><span class="o">=</span> <span class="p">(</span><span class="k">select</span> <span class="n">trunc</span><span class="p">(</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="k">length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
<span class="k">begin</span>
  <span class="n">if</span> <span class="n">length2</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">then</span>
    <span class="n">raise</span> <span class="n">exception</span> <span class="s1">'Given length cannot be less than 0'</span><span class="p">;</span>
  <span class="k">end</span> <span class="n">if</span><span class="p">;</span>
  <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="p">..</span><span class="n">length2</span> <span class="n">loop</span>
    <span class="k">result</span> <span class="p">:</span><span class="o">=</span> <span class="k">result</span> <span class="o">||</span> <span class="n">chars</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="n">array_length</span><span class="p">(</span><span class="n">chars</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)];</span>
  <span class="k">end</span> <span class="n">loop</span><span class="p">;</span>
  <span class="k">return</span> <span class="k">result</span><span class="p">;</span>
<span class="k">end</span><span class="p">;</span>
<span class="err">$$</span> <span class="k">language</span> <span class="n">plpgsql</span><span class="p">;</span>

<span class="k">insert</span> <span class="k">into</span> <span class="n">employees</span><span class="p">(</span><span class="n">name</span><span class="p">)(</span><span class="k">select</span> <span class="n">random_string</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">from</span> <span class="n">generate_series</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">));</span>

<span class="k">create</span> <span class="k">index</span> <span class="n">employees_name</span> <span class="k">on</span> <span class="n">employees</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
</pre></table></code></div></div><p><strong>Query:</strong> <code class="language-plaintext highlighter-rouge">explain analyze</code> select id,name from employees e where e.name like ‘%Pra%’;</p><p><strong>Output</strong>:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre>Scan <span class="nb">type</span>:
<span class="nt">---</span>
- inline index scan → when details present <span class="k">in </span>index, it will not check table/heap
Index Only Scan using employees_pkey on employees e  <span class="o">(</span><span class="nv">cost</span><span class="o">=</span>0.42..8.44 <span class="nv">rows</span><span class="o">=</span>1 <span class="nv">width</span><span class="o">=</span>4<span class="o">)</span> <span class="o">(</span>actual <span class="nb">time</span><span class="o">=</span>0.051..0.082 <span class="nv">rows</span><span class="o">=</span>1 <span class="nv">loops</span><span class="o">=</span>1<span class="o">)</span>
Index Cond: <span class="o">(</span><span class="nb">id</span> <span class="o">=</span> 20000<span class="o">)</span>
Heap Fetches: 1
Planning Time: 0.241 ms
Execution Time: 0.178 ms
- parallel sequencial  scan → when using non index column to search
Gather  <span class="o">(</span><span class="nv">cost</span><span class="o">=</span>1000.00..11310.94 <span class="nv">rows</span><span class="o">=</span>6 <span class="nv">width</span><span class="o">=</span>10<span class="o">)</span> <span class="o">(</span>actual <span class="nb">time</span><span class="o">=</span>57.742..64.152 <span class="nv">rows</span><span class="o">=</span>0 <span class="nv">loops</span><span class="o">=</span>1<span class="o">)</span>
Workers Planned: 2
Workers Launched: 2
-&gt;  Parallel Seq Scan on employees e  <span class="o">(</span><span class="nv">cost</span><span class="o">=</span>0.00..10310.34 <span class="nv">rows</span><span class="o">=</span>2 <span class="nv">width</span><span class="o">=</span>10<span class="o">)</span> <span class="o">(</span>actual <span class="nb">time</span><span class="o">=</span>30.379..30.398 <span class="nv">rows</span><span class="o">=</span>0 <span class="nv">loops</span><span class="o">=</span>3<span class="o">)</span>
Filter: <span class="o">(</span>name <span class="o">=</span> <span class="s1">'Pravin'</span>::text<span class="o">)</span>
Rows Removed by Filter: 333334
Planning Time: 0.159 ms
Execution Time: 64.236 ms
- Bitmap index scan → when using index column to search
create index using → <span class="k">**</span>create<span class="k">**</span> <span class="k">**</span>index<span class="k">**</span> employees_name <span class="k">**</span>on<span class="k">**</span> employees<span class="o">(</span><span class="k">**</span>name<span class="k">**</span><span class="o">)</span><span class="p">;</span> → this takes <span class="nb">time </span>as it build the b tree before using it. <span class="k">if </span>we run same query like above, it will <span class="k">return in </span>lesser time.
Bitmap Heap Scan on employees e  <span class="o">(</span><span class="nv">cost</span><span class="o">=</span>4.47..27.93 <span class="nv">rows</span><span class="o">=</span>6 <span class="nv">width</span><span class="o">=</span>10<span class="o">)</span> <span class="o">(</span>actual <span class="nb">time</span><span class="o">=</span>0.113..0.160 <span class="nv">rows</span><span class="o">=</span>0 <span class="nv">loops</span><span class="o">=</span>1<span class="o">)</span>
Recheck Cond: <span class="o">(</span>name <span class="o">=</span> <span class="s1">'Pravin'</span>::text<span class="o">)</span>
-&gt;  Bitmap Index Scan on employees_name  <span class="o">(</span><span class="nv">cost</span><span class="o">=</span>0.00..4.47 <span class="nv">rows</span><span class="o">=</span>6 <span class="nv">width</span><span class="o">=</span>0<span class="o">)</span> <span class="o">(</span>actual <span class="nb">time</span><span class="o">=</span>0.052..0.068 <span class="nv">rows</span><span class="o">=</span>0 <span class="nv">loops</span><span class="o">=</span>1<span class="o">)</span>
Index Cond: <span class="o">(</span>name <span class="o">=</span> <span class="s1">'Pravin'</span>::text<span class="o">)</span>
Planning Time: 0.416 ms
Execution Time: 0.261 ms
<span class="k">if </span>we use query that has like usage, it make the DB to check all the rows.
Gather  <span class="o">(</span><span class="nv">cost</span><span class="o">=</span>1000.00..11319.34 <span class="nv">rows</span><span class="o">=</span>90 <span class="nv">width</span><span class="o">=</span>10<span class="o">)</span> <span class="o">(</span>actual <span class="nb">time</span><span class="o">=</span>6.080..66.693 <span class="nv">rows</span><span class="o">=</span>19 <span class="nv">loops</span><span class="o">=</span>1<span class="o">)</span>
Workers Planned: 2
Workers Launched: 2
-&gt;  Parallel Seq Scan on employees e  <span class="o">(</span><span class="nv">cost</span><span class="o">=</span>0.00..10310.34 <span class="nv">rows</span><span class="o">=</span>38 <span class="nv">width</span><span class="o">=</span>10<span class="o">)</span> <span class="o">(</span>actual <span class="nb">time</span><span class="o">=</span>15.069..42.456 <span class="nv">rows</span><span class="o">=</span>6 <span class="nv">loops</span><span class="o">=</span>3<span class="o">)</span>
Filter: <span class="o">(</span>name ~~ <span class="s1">'%Pra%'</span>::text<span class="o">)</span>
Rows Removed by Filter: 333327
Planning Time: 3.247 ms
Execution Time: 67.227 ms
Using explain analyze, we can come to know why query is slower possibly it is using parallel <span class="nb">seq </span>scan despite presence of index. so like query is bad query <span class="k">for </span>index.
</pre></table></code></div></div><hr /><h2 id="sql-query-planner-and-optimizer"><span class="mr-2">SQL Query Planner and Optimizer</span><a href="#sql-query-planner-and-optimizer" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="k">create</span> <span class="k">table</span> <span class="n">grades</span> <span class="p">(</span>
  <span class="n">id</span> <span class="nb">serial</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span> 
  <span class="k">g</span> <span class="nb">int</span><span class="p">,</span>
  <span class="n">name</span> <span class="nb">text</span> 
<span class="p">);</span> 
<span class="k">create</span> <span class="k">index</span> <span class="n">grades_score</span> <span class="k">on</span> <span class="n">grades</span><span class="p">(</span><span class="k">g</span><span class="p">);</span>

<span class="k">insert</span> <span class="k">into</span> <span class="n">grades</span> <span class="p">(</span><span class="k">g</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">select</span> <span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="k">substring</span><span class="p">(</span><span class="n">md5</span><span class="p">(</span><span class="n">random</span><span class="p">()::</span><span class="nb">text</span> <span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">floor</span><span class="p">(</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">31</span><span class="p">)::</span><span class="nb">int</span><span class="p">)</span> <span class="k">from</span> <span class="n">generate_series</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>
<span class="k">vacuum</span> <span class="p">(</span><span class="k">analyze</span><span class="p">,</span> <span class="k">verbose</span><span class="p">,</span> <span class="k">full</span><span class="p">);</span>

<span class="k">explain</span> <span class="k">analyze</span> <span class="k">select</span> <span class="n">id</span><span class="p">,</span><span class="k">g</span> <span class="k">from</span> <span class="n">grades</span> <span class="k">where</span> <span class="k">g</span> <span class="o">&gt;</span> <span class="mi">80</span> <span class="k">and</span> <span class="k">g</span> <span class="o">&lt;</span> <span class="mi">95</span> <span class="k">order</span> <span class="k">by</span> <span class="k">g</span><span class="p">;</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">explain</code> this keyword is used to check what planning the database will use.</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">explain</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">grades</span><span class="p">;</span>
</pre></table></code></div></div><p>The output is:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">Seq</span> <span class="n">Scan</span> <span class="k">on</span> <span class="n">grades</span>  <span class="p">(</span><span class="n">cost</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="p">..</span><span class="mi">75859</span><span class="p">.</span><span class="mi">70</span> <span class="k">rows</span><span class="o">=</span><span class="mi">4218170</span> <span class="n">width</span><span class="o">=</span><span class="mi">23</span><span class="p">)</span>
</pre></table></code></div></div><ul><li>cost=<strong>0.00</strong>..75859.7 → here the first part means, the database took no time to find the first record. As we scan the next record, this time will increase and that is what the database is showing in the second part where it says that the estimate is around <code class="language-plaintext highlighter-rouge">75859.7</code> ms.<li>rows=4218170 → this is just a guess number as the database has not executed the query yet. It is the fastest approach and can be used to replace count(*). In most usecase, you want to show a close-to-exact number which the above query does very efficiently.<li>width=23, it is in bytes and represents result size.</ul><p>Let’s spice it up a bit:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">explain</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">grades</span> <span class="k">order</span> <span class="k">by</span> <span class="k">g</span><span class="p">;</span>
</pre></table></code></div></div><p>It returns:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>Index Scan using grades_score on grades  (cost=0.43..226671.63 rows=5000502 width=23)
</pre></table></code></div></div><p>Here, the database will use an index scan. It says it will take a cost of .43 ms as something more is going on here. The rows scanned it shows higher.</p><p>If you try to sort based on a non-index column:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">explain</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">grades</span> <span class="k">order</span> <span class="k">by</span> <span class="n">name</span><span class="p">;</span>
</pre></table></code></div></div><p>Here is the output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>Gather Merge  (cost=359650.50..845844.25 rows=4167084 width=23)
  Workers Planned: 2
  -&gt;  Sort  (cost=358650.48..363859.33 rows=2083542 width=23)
        Sort Key: name
        -&gt;  Parallel Seq Scan on grades  (cost=0.00..54513.43 rows=2083542 width=23)
</pre></table></code></div></div><hr /><h2 id="scan-types"><span class="mr-2">Scan Types</span><a href="#scan-types" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="sequential-scan-vs-index-scan-vs-bitmap-index-scan"><span class="mr-2">Sequential Scan vs Index Scan vs Bitmap Index Scan</span><a href="#sequential-scan-vs-index-scan-vs-bitmap-index-scan" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>All 3 are different scan types that the database uses to retrieve records.</p><p><strong>Index scan</strong> → If the database finds that the number of records is few, it uses Index scan. In index scan, it uses both the index and heap to retrieve the record.</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">explain</span> <span class="k">select</span> <span class="n">name</span> <span class="k">from</span> <span class="n">grades</span> <span class="k">where</span> <span class="k">g</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">;</span>
<span class="k">Index</span> <span class="n">Scan</span> <span class="k">using</span> <span class="n">grades_score</span> <span class="k">on</span> <span class="n">grades</span>  <span class="p">(</span><span class="n">cost</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">43</span><span class="p">..</span><span class="mi">8</span><span class="p">.</span><span class="mi">45</span> <span class="k">rows</span><span class="o">=</span><span class="mi">1</span> <span class="n">width</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
  <span class="k">Index</span> <span class="n">Cond</span><span class="p">:</span> <span class="p">(</span><span class="k">g</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span>
</pre></table></code></div></div><p>You can see the number of rows fetched is small.</p><p><strong>Sequential scan</strong> → If the database finds that the number of records is large, it will use Sequential scan instead of Index scan. It simply uses Sequential scan and avoids referring to the index to scan the record as there is too much overhead and it slows the performance. The database uses a smart approach here.</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">explain</span> <span class="k">select</span> <span class="n">name</span> <span class="k">from</span> <span class="n">grades</span> <span class="k">where</span> <span class="k">g</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span>

<span class="n">Seq</span> <span class="n">Scan</span> <span class="k">on</span> <span class="n">grades</span>  <span class="p">(</span><span class="n">cost</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="p">..</span><span class="mi">96184</span><span class="p">.</span><span class="mi">27</span> <span class="k">rows</span><span class="o">=</span><span class="mi">4977500</span> <span class="n">width</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
  <span class="n">Filter</span><span class="p">:</span> <span class="p">(</span><span class="k">g</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">)</span>
</pre></table></code></div></div><p>You can see the number of rows fetched is very high, so it uses Sequential scan.</p><p><strong>In Bitmap scan there are 3 things happening:</strong></p><ul><li><strong>Bitmap index scan</strong> → It first scans the index for grades that are more than 95, it will not visit the heap yet. It will mark the pages that contain the required index.</ul><p><img data-src="/assets/img/database-engineering-fundamental-part-1/1.png" alt="Bitmap Scan 1" data-proofer-ignore></p><ul><li><strong>Bitmap Heap scan</strong> → Once index scan is completed, it will now scan the heap and look for all the pages in the heap. The heap returns the pages which contain more rows, and can have rows which don’t have grade greater than 95. In the next step it performs recheck.<li><strong>Recheck index condition</strong> → This step applies the final filter to pick the required rows and discard others.</ul><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="k">explain</span> <span class="k">select</span> <span class="n">name</span> <span class="k">from</span> <span class="n">grades</span> <span class="k">where</span> <span class="k">g</span> <span class="o">&gt;</span> <span class="mi">95</span><span class="p">;</span>

<span class="n">Bitmap</span> <span class="n">Heap</span> <span class="n">Scan</span> <span class="k">on</span> <span class="n">grades</span>  <span class="p">(</span><span class="n">cost</span><span class="o">=</span><span class="mi">2177</span><span class="p">.</span><span class="mi">00</span><span class="p">..</span><span class="mi">38294</span><span class="p">.</span><span class="mi">62</span> <span class="k">rows</span><span class="o">=</span><span class="mi">195170</span> <span class="n">width</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
  <span class="k">Recheck</span> <span class="n">Cond</span><span class="p">:</span> <span class="p">(</span><span class="k">g</span> <span class="o">&gt;</span> <span class="mi">95</span><span class="p">)</span>
  <span class="o">-&gt;</span>  <span class="n">Bitmap</span> <span class="k">Index</span> <span class="n">Scan</span> <span class="k">on</span> <span class="n">grades_score</span>  <span class="p">(</span><span class="n">cost</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="p">..</span><span class="mi">2128</span><span class="p">.</span><span class="mi">21</span> <span class="k">rows</span><span class="o">=</span><span class="mi">195170</span> <span class="n">width</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">Index</span> <span class="n">Cond</span><span class="p">:</span> <span class="p">(</span><span class="k">g</span> <span class="o">&gt;</span> <span class="mi">95</span><span class="p">)</span>
</pre></table></code></div></div><p>Let’s take another example where we’re adding another condition for <code class="language-plaintext highlighter-rouge">id &lt; 10,000</code>:</p><p>There will be an index scan that will happen for the id column where it will mark pages that have ids less than 10000, and another bitmap index scan happens for pages that contain grades &gt; 95. Later the result from both scans undergoes a bitwise AND operation and is returned for page retrieval from Bitmap heap scan. The same can be understood from the diagram below:</p><p><img data-src="/assets/img/database-engineering-fundamental-part-1/2.png" alt="Bitmap Scan with AND" data-proofer-ignore></p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">explain</span> <span class="k">select</span> <span class="n">name</span> <span class="k">from</span> <span class="n">grades</span> <span class="k">where</span> <span class="k">g</span> <span class="o">&gt;</span> <span class="mi">95</span> <span class="k">and</span> <span class="n">id</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">;</span>

<span class="n">Bitmap</span> <span class="n">Heap</span> <span class="n">Scan</span> <span class="k">on</span> <span class="n">grades</span>  <span class="p">(</span><span class="n">cost</span><span class="o">=</span><span class="mi">3988</span><span class="p">.</span><span class="mi">96</span><span class="p">..</span><span class="mi">5479</span><span class="p">.</span><span class="mi">62</span> <span class="k">rows</span><span class="o">=</span><span class="mi">394</span> <span class="n">width</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
  <span class="k">Recheck</span> <span class="n">Cond</span><span class="p">:</span> <span class="p">((</span><span class="k">g</span> <span class="o">&gt;</span> <span class="mi">95</span><span class="p">)</span> <span class="k">AND</span> <span class="p">(</span><span class="n">id</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">))</span>
  <span class="o">-&gt;</span> <span class="n">BitmapAnd</span> <span class="p">(</span><span class="n">cost</span><span class="o">=</span><span class="mi">3988</span><span class="p">.</span><span class="mi">96</span><span class="p">..</span><span class="mi">3988</span><span class="p">.</span><span class="mi">96</span> <span class="k">rows</span><span class="o">=</span><span class="mi">394</span> <span class="n">width</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
      <span class="o">-&gt;</span>  <span class="n">Bitmap</span> <span class="k">Index</span> <span class="n">Scan</span> <span class="k">on</span> <span class="n">grades_score</span>  <span class="p">(</span><span class="n">cost</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="p">..</span><span class="mi">180</span><span class="p">.</span><span class="mi">21</span> <span class="k">rows</span><span class="o">=</span><span class="mi">9570</span> <span class="n">width</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">Index</span> <span class="n">Cond</span><span class="p">:</span> <span class="p">(</span><span class="k">g</span> <span class="o">&gt;</span> <span class="mi">95</span><span class="p">)</span>
      <span class="o">-&gt;</span>  <span class="n">Bitmap</span> <span class="k">Index</span> <span class="n">Scan</span> <span class="k">on</span> <span class="n">grades_pkey</span>  <span class="p">(</span><span class="n">cost</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="p">..</span><span class="mi">3803</span><span class="p">.</span><span class="mi">31</span> <span class="k">rows</span><span class="o">=</span><span class="mi">195170</span> <span class="n">width</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">Index</span> <span class="n">Cond</span><span class="p">:</span> <span class="p">(</span><span class="n">id</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">)</span>
</pre></table></code></div></div><h2 id="key-vs-non-key-column-database-indexing"><span class="mr-2">Key vs Non-key Column Database Indexing</span><a href="#key-vs-non-key-column-database-indexing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Let’s understand using an example to see performance when data is added in index vs not in index.</p><p>For a table created using this script:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
</pre><td class="rouge-code"><pre><span class="k">create</span> <span class="k">table</span> <span class="n">students</span> <span class="p">(</span>
  <span class="n">id</span> <span class="nb">serial</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span> 
  <span class="k">g</span> <span class="nb">int</span><span class="p">,</span>
  <span class="n">firstname</span> <span class="nb">text</span><span class="p">,</span> 
  <span class="n">lastname</span> <span class="nb">text</span><span class="p">,</span> 
  <span class="n">middlename</span> <span class="nb">text</span><span class="p">,</span>
  <span class="n">address</span> <span class="nb">text</span><span class="p">,</span>
  <span class="n">bio</span> <span class="nb">text</span><span class="p">,</span>
  <span class="n">dob</span> <span class="nb">date</span><span class="p">,</span>
  <span class="n">id1</span> <span class="nb">int</span><span class="p">,</span>
  <span class="n">id2</span> <span class="nb">int</span><span class="p">,</span>
  <span class="n">id3</span> <span class="nb">int</span><span class="p">,</span>
  <span class="n">id4</span> <span class="nb">int</span><span class="p">,</span>
  <span class="n">id5</span> <span class="nb">int</span><span class="p">,</span>
  <span class="n">id6</span> <span class="nb">int</span><span class="p">,</span>
  <span class="n">id7</span> <span class="nb">int</span><span class="p">,</span>
  <span class="n">id8</span> <span class="nb">int</span><span class="p">,</span>
  <span class="n">id9</span> <span class="nb">int</span>
<span class="p">);</span> 

<span class="k">insert</span> <span class="k">into</span> <span class="n">students</span> <span class="p">(</span><span class="k">g</span><span class="p">,</span>
  <span class="n">firstname</span><span class="p">,</span> 
  <span class="n">lastname</span><span class="p">,</span> 
  <span class="n">middlename</span><span class="p">,</span>
  <span class="n">address</span><span class="p">,</span>
  <span class="n">bio</span><span class="p">,</span>
  <span class="n">dob</span><span class="p">,</span>
  <span class="n">id1</span><span class="p">,</span>
  <span class="n">id2</span><span class="p">,</span>
  <span class="n">id3</span><span class="p">,</span>
  <span class="n">id4</span><span class="p">,</span>
  <span class="n">id5</span><span class="p">,</span>
  <span class="n">id6</span><span class="p">,</span>
  <span class="n">id7</span><span class="p">,</span>
  <span class="n">id8</span><span class="p">,</span>
  <span class="n">id9</span><span class="p">)</span> 
<span class="k">select</span> 
  <span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span>
  <span class="k">substring</span><span class="p">(</span><span class="n">md5</span><span class="p">(</span><span class="n">random</span><span class="p">()::</span><span class="nb">text</span> <span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">floor</span><span class="p">(</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">31</span><span class="p">)::</span><span class="nb">int</span><span class="p">),</span>
  <span class="k">substring</span><span class="p">(</span><span class="n">md5</span><span class="p">(</span><span class="n">random</span><span class="p">()::</span><span class="nb">text</span> <span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">floor</span><span class="p">(</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">31</span><span class="p">)::</span><span class="nb">int</span><span class="p">),</span>
  <span class="k">substring</span><span class="p">(</span><span class="n">md5</span><span class="p">(</span><span class="n">random</span><span class="p">()::</span><span class="nb">text</span> <span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">floor</span><span class="p">(</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">31</span><span class="p">)::</span><span class="nb">int</span><span class="p">),</span>
  <span class="k">substring</span><span class="p">(</span><span class="n">md5</span><span class="p">(</span><span class="n">random</span><span class="p">()::</span><span class="nb">text</span> <span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">floor</span><span class="p">(</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">31</span><span class="p">)::</span><span class="nb">int</span><span class="p">),</span>
  <span class="k">substring</span><span class="p">(</span><span class="n">md5</span><span class="p">(</span><span class="n">random</span><span class="p">()::</span><span class="nb">text</span> <span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">floor</span><span class="p">(</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">31</span><span class="p">)::</span><span class="nb">int</span><span class="p">),</span>
  <span class="n">now</span><span class="p">(),</span>
  <span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">100000</span><span class="p">,</span>
  <span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">100000</span><span class="p">,</span>
  <span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">100000</span><span class="p">,</span>
  <span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">100000</span><span class="p">,</span>
  <span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">100000</span><span class="p">,</span>
  <span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">100000</span><span class="p">,</span>
  <span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">100000</span><span class="p">,</span>
  <span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">100000</span><span class="p">,</span>
  <span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">100000</span>
<span class="k">from</span> <span class="n">generate_series</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5000000</span><span class="p">);</span>

<span class="k">vacuum</span> <span class="p">(</span><span class="k">analyze</span><span class="p">,</span> <span class="k">verbose</span><span class="p">,</span> <span class="k">full</span><span class="p">);</span>
</pre></table></code></div></div><p>Result of this query:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">explain</span> <span class="k">analyze</span> <span class="k">select</span> <span class="n">id</span><span class="p">,</span><span class="k">g</span> <span class="k">from</span> <span class="n">students</span> <span class="k">where</span> <span class="k">g</span> <span class="o">&gt;</span> <span class="mi">80</span> <span class="k">and</span> <span class="k">g</span> <span class="o">&lt;</span> <span class="mi">95</span> <span class="k">order</span> <span class="k">by</span> <span class="k">g</span><span class="p">;</span>
</pre></table></code></div></div><p>The output shows:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>Gather Merge  (cost=157048.00..223006.83 rows=565322 width=8) (actual time=6018.645..21020.085 rows=700746 loops=1)
  Workers Planned: 2
  Workers Launched: 2
  -&gt;  Sort  (cost=156047.97..156754.63 rows=282661 width=8) (actual time=5979.320..8942.869 rows=233582 loops=3)
        Sort Key: g
        Sort Method: external merge  Disk: 4136kB
        Worker 0:  Sort Method: external merge  Disk: 4128kB
        Worker 1:  Sort Method: external merge  Disk: 4120kB
        -&gt;  Parallel Seq Scan on students  (cost=0.00..126587.34 rows=282661 width=8) (actual time=4.775..3025.051 rows=233582 loops=3)
              Filter: ((g &gt; 80) AND (g &lt; 95))
              Rows Removed by Filter: 1433085
Planning Time: 0.138 ms
JIT:
  Functions: 12
  Options: Inlining false, Optimization false, Expressions true, Deforming true
  Timing: Generation 0.986 ms, Inlining 0.000 ms, Optimization 0.717 ms, Emission 13.269 ms, Total 14.972 ms
Execution Time: 29755.348 ms
</pre></table></code></div></div><p>As we can see, the query is very slow for 5 million records. Now let’s create an index on the <code class="language-plaintext highlighter-rouge">g</code> column:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">create</span> <span class="k">index</span> <span class="n">g_idx</span> <span class="k">on</span> <span class="n">students</span><span class="p">(</span><span class="k">g</span><span class="p">);</span>
</pre></table></code></div></div><p>Now if we run the query again:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">explain</span> <span class="k">analyze</span> <span class="k">select</span> <span class="n">id</span><span class="p">,</span><span class="k">g</span> <span class="k">from</span> <span class="n">students</span> <span class="k">where</span> <span class="k">g</span> <span class="o">&gt;</span> <span class="mi">80</span> <span class="k">and</span> <span class="k">g</span> <span class="o">&lt;</span> <span class="mi">95</span> <span class="k">order</span> <span class="k">by</span> <span class="k">g</span><span class="p">;</span>
</pre></table></code></div></div><p>The output is:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre>Gather Merge  (cost=157015.38..222971.41 rows=565298 width=8) (actual time=5943.602..20992.052 rows=700746 loops=1)
  Workers Planned: 2
  Workers Launched: 2
  -&gt;  Sort  (cost=156015.35..156721.97 rows=282649 width=8) (actual time=5906.640..8890.320 rows=233582 loops=3)
        Sort Key: g
        Sort Method: external merge  Disk: 4128kB
        Worker 0:  Sort Method: external merge  Disk: 4128kB
        Worker 1:  Sort Method: external merge  Disk: 4128kB
        -&gt;  Parallel Bitmap Heap Scan on students  (cost=9253.60..126555.89 rows=282649 width=8) (actual time=64.650..3006.930 rows=233582 loops=3)
              Recheck Cond: ((g &gt; 80) AND (g &lt; 95))
              Rows Removed by Index Recheck: 494862
              Heap Blocks: exact=20568 lossy=11260
              -&gt;  Bitmap Index Scan on g_idx  (cost=0.00..9084.01 rows=678358 width=0) (actual time=66.808..66.819 rows=700746 loops=1)
                    Index Cond: ((g &gt; 80) AND (g &lt; 95))
Planning Time: 0.378 ms
JIT:
  Functions: 12
  Options: Inlining false, Optimization false, Expressions true, Deforming true
  Timing: Generation 1.021 ms, Inlining 0.000 ms, Optimization 0.769 ms, Emission 13.504 ms, Total 15.294 ms
Execution Time: 29852.581 ms
</pre></table></code></div></div><p>Normally anyone would expect the query to be faster now that we’re using an index, but the execution time is still the same or increased a little bit.</p><p>One theory is that previously the database was looking only in the table, but now it is looking in the table plus at the primary key index <code class="language-plaintext highlighter-rouge">id</code> to retrieve the fields.</p><p>Using this command we can determine whether a query is using buffer/cached data and for how many records:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">explain</span> <span class="p">(</span><span class="k">analyze</span><span class="p">,</span><span class="n">buffers</span><span class="p">)</span> <span class="k">select</span> <span class="n">id</span><span class="p">,</span><span class="k">g</span> <span class="k">from</span> <span class="n">students</span> <span class="k">where</span> <span class="k">g</span> <span class="o">&gt;</span> <span class="mi">80</span> <span class="k">and</span> <span class="k">g</span> <span class="o">&lt;</span> <span class="mi">95</span> <span class="k">order</span> <span class="k">by</span> <span class="k">g</span> <span class="k">desc</span> <span class="k">limit</span> <span class="mi">1000</span><span class="p">;</span>
</pre></table></code></div></div><p>Output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>Limit  (cost=0.43..585.94 rows=1000 width=8) (actual time=0.072..51.714 rows=1000 loops=1)
  Buffers: shared hit=782 read=3
  -&gt;  Index Scan Backward using g_idx on students  (cost=0.43..397181.31 rows=678358 width=8) (actual time=0.034..19.658 rows=1000 loops=1)
        Index Cond: ((g &gt; 80) AND (g &lt; 95))
        Buffers: shared hit=782 read=3
Planning:
  Buffers: shared hit=10 read=6
Planning Time: 0.222 ms
Execution Time: 67.558 ms
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">read=3</code> → 3 IO operations to disk</p><p>Let’s drop the index:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">drop</span> <span class="k">index</span> <span class="n">g_idx</span><span class="p">;</span>
</pre></table></code></div></div><p>Since we are retrieving id also with grade, let’s include id in the index:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">create</span> <span class="k">index</span> <span class="n">g_idx</span> <span class="k">on</span> <span class="n">students</span><span class="p">(</span><span class="k">g</span><span class="p">)</span> <span class="n">include</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
</pre></table></code></div></div><p>Now if we run our query:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">explain</span> <span class="p">(</span><span class="k">analyze</span><span class="p">,</span><span class="n">buffers</span><span class="p">)</span> <span class="k">select</span> <span class="n">id</span><span class="p">,</span><span class="k">g</span> <span class="k">from</span> <span class="n">students</span> <span class="k">where</span> <span class="k">g</span> <span class="o">&gt;</span> <span class="mi">80</span> <span class="k">and</span> <span class="k">g</span> <span class="o">&lt;</span> <span class="mi">95</span><span class="p">;</span>
</pre></table></code></div></div><p>Output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>Bitmap Heap Scan on students  (cost=14256.95..162273.28 rows=671270 width=8) (actual time=128.376..9821.213 rows=700746 loops=1)
  Recheck Cond: ((g &gt; 80) AND (g &lt; 95))
  Rows Removed by Index Recheck: 1484586
  Heap Blocks: exact=62039 lossy=33262
  Buffers: shared hit=2 read=97217
  -&gt;  Bitmap Index Scan on g_idx  (cost=0.00..14089.13 rows=671270 width=0) (actual time=111.000..111.011 rows=700746 loops=1)
        Index Cond: ((g &gt; 80) AND (g &lt; 95))
        Buffers: shared hit=1 read=1917
Planning:
  Buffers: shared hit=10 read=6
Planning Time: 0.237 ms
JIT:
  Functions: 4
  Options: Inlining false, Optimization false, Expressions true, Deforming true
  Timing: Generation 0.249 ms, Inlining 0.000 ms, Optimization 0.211 ms, Emission 2.586 ms, Total 3.046 ms
Execution Time: 18434.583 ms
</pre></table></code></div></div><p>We see there is some improvement, but even though id is present in the index, it is not being used and the query planner is using the heap for scanning id. The expectation is that it should not refer to the heap. On repeat queries, it uses cache. High IO means that some part of the index is loaded from disk.</p><h2 id="index-scan-vs-index-only-scan"><span class="mr-2">Index Scan vs Index Only Scan</span><a href="#index-scan-vs-index-only-scan" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="k">explain</span> <span class="k">analyze</span> <span class="k">select</span> <span class="n">id</span><span class="p">,</span> <span class="n">name</span> <span class="k">from</span> <span class="n">grades</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>

<span class="k">Index</span> <span class="n">Scan</span> <span class="k">using</span> <span class="n">grades_pkey</span> <span class="k">on</span> <span class="n">grades</span>  <span class="p">(</span><span class="n">cost</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">43</span><span class="p">..</span><span class="mi">8</span><span class="p">.</span><span class="mi">45</span> <span class="k">rows</span><span class="o">=</span><span class="mi">1</span> <span class="n">width</span><span class="o">=</span><span class="mi">19</span><span class="p">)</span> <span class="p">(</span><span class="n">actual</span> <span class="nb">time</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">098</span><span class="p">..</span><span class="mi">0</span><span class="p">.</span><span class="mi">135</span> <span class="k">rows</span><span class="o">=</span><span class="mi">1</span> <span class="n">loops</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">Index</span> <span class="n">Cond</span><span class="p">:</span> <span class="p">(</span><span class="n">id</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">)</span>
<span class="n">Planning</span> <span class="nb">Time</span><span class="p">:</span> <span class="mi">1</span><span class="p">.</span><span class="mi">225</span> <span class="n">ms</span>
<span class="n">Execution</span> <span class="nb">Time</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">246</span> <span class="n">ms</span>
</pre></table></code></div></div><p>Here we had an index on the id column, so when we queried using <code class="language-plaintext highlighter-rouge">id =</code> it performed an index scan and returned the data.</p><p>In this case, first an index lookup happens, then it uses the row_id (internal reference) to fetch the row from the heap. All columns of the row are retrieved, then it picks name and displays it.</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">explain</span> <span class="k">analyze</span> <span class="k">select</span> <span class="n">id</span> <span class="k">from</span> <span class="n">grades</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>

<span class="k">Index</span> <span class="k">Only</span> <span class="n">Scan</span> <span class="k">using</span> <span class="n">grades_pkey</span> <span class="k">on</span> <span class="n">grades</span>  <span class="p">(</span><span class="n">cost</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">43</span><span class="p">..</span><span class="mi">8</span><span class="p">.</span><span class="mi">45</span> <span class="k">rows</span><span class="o">=</span><span class="mi">1</span> <span class="n">width</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="p">(</span><span class="n">actual</span> <span class="nb">time</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">056</span><span class="p">..</span><span class="mi">0</span><span class="p">.</span><span class="mi">089</span> <span class="k">rows</span><span class="o">=</span><span class="mi">1</span> <span class="n">loops</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">Index</span> <span class="n">Cond</span><span class="p">:</span> <span class="p">(</span><span class="n">id</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">)</span>
  <span class="n">Heap</span> <span class="n">Fetches</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">Planning</span> <span class="nb">Time</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">077</span> <span class="n">ms</span>
<span class="n">Execution</span> <span class="nb">Time</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">183</span> <span class="n">ms</span>
</pre></table></code></div></div><p>For this query, the DB doesn’t have to lookup the heap to fetch the id as it is already part of the index and it returns that data back. That’s why it’s an Index Only Scan.</p><p>If our query somehow uses index only scan then it’s a jackpot as it reduces the response time of the DB to a very low value. One way to use this is to include non-key columns in the index. It is possible to include commonly retrieved data in the index so next time it can use the index.</p><p>Here’s an example:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">create</span> <span class="k">index</span> <span class="n">id_idx</span> <span class="k">on</span> <span class="n">grades</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="n">include</span> <span class="p">(</span><span class="n">name</span><span class="p">);</span>

<span class="k">explain</span> <span class="k">analyze</span> <span class="k">select</span> <span class="n">id</span><span class="p">,</span><span class="n">name</span> <span class="k">from</span> <span class="n">grades</span> <span class="k">where</span> <span class="n">id</span><span class="o">=</span><span class="mi">1000</span><span class="p">;</span>

<span class="k">Index</span> <span class="k">Only</span> <span class="n">Scan</span> <span class="k">using</span> <span class="n">id_idx</span> <span class="k">on</span> <span class="n">grades</span>  <span class="p">(</span><span class="n">cost</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">43</span><span class="p">..</span><span class="mi">8</span><span class="p">.</span><span class="mi">45</span> <span class="k">rows</span><span class="o">=</span><span class="mi">1</span> <span class="n">width</span><span class="o">=</span><span class="mi">19</span><span class="p">)</span> <span class="p">(</span><span class="n">actual</span> <span class="nb">time</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">036</span><span class="p">..</span><span class="mi">0</span><span class="p">.</span><span class="mi">069</span> <span class="k">rows</span><span class="o">=</span><span class="mi">1</span> <span class="n">loops</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">Index</span> <span class="n">Cond</span><span class="p">:</span> <span class="p">(</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>
  <span class="n">Heap</span> <span class="n">Fetches</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">Planning</span> <span class="nb">Time</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">082</span> <span class="n">ms</span>
<span class="n">Execution</span> <span class="nb">Time</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">164</span> <span class="n">ms</span>
</pre></table></code></div></div><p>Now I am able to retrieve name from the index and avoid lookup from the table.</p><p>We need to have a good reason to include non-key columns in an index as it could create more IO operations for index loading once it starts growing larger. Size will become an issue.</p><h2 id="combining-database-indexes-for-better-performance"><span class="mr-2">Combining Database Indexes for Better Performance</span><a href="#combining-database-indexes-for-better-performance" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Let’s consider a table:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">test</span><span class="p">(</span>
  <span class="n">a</span> <span class="nb">INT</span><span class="p">,</span>
  <span class="n">b</span> <span class="nb">INT</span><span class="p">,</span>
  <span class="k">c</span> <span class="nb">TEXT</span>
<span class="p">);</span>

<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">a_idx</span> <span class="k">ON</span> <span class="n">test</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">b_idx</span> <span class="k">ON</span> <span class="n">test</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
</pre></table></code></div></div><h3 id="query-behavior-analysis"><span class="mr-2">Query Behavior Analysis</span><a href="#query-behavior-analysis" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><strong>Case 1: Simple WHERE Clause</strong></p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="k">c</span> <span class="k">FROM</span> <span class="n">test</span> <span class="k">WHERE</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">70</span><span class="p">;</span>
</pre></table></code></div></div><ul><li>Database will use <strong>Bitmap index scan</strong> to check <code class="language-plaintext highlighter-rouge">a=70</code> in different parts of the page<li>Later retrieves all records at once using <strong>Bitmap heap scan</strong><li>If we add <code class="language-plaintext highlighter-rouge">LIMIT</code> (e.g., <code class="language-plaintext highlighter-rouge">LIMIT 2</code>), it will use <strong>Index scan</strong> instead to avoid Bitmap overhead</ul><p><strong>Case 2: AND Condition</strong></p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="k">c</span> <span class="k">FROM</span> <span class="n">test</span> <span class="k">WHERE</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">100</span> <span class="k">AND</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
</pre></table></code></div></div><ul><li>Uses <strong>Bitmap Index scan</strong> for both <code class="language-plaintext highlighter-rouge">a</code> and <code class="language-plaintext highlighter-rouge">b</code> separately<li>Performs an <strong>AND</strong> operation on the results<li>Returns the final result from the heap</ul><p><strong>Case 3: OR Condition</strong></p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="k">c</span> <span class="k">FROM</span> <span class="n">test</span> <span class="k">WHERE</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">100</span> <span class="k">OR</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
</pre></table></code></div></div><ul><li>Execution time is longer than the AND query<li>Performs a <strong>union</strong> of results from both index scans<li>More pages to read due to the OR operation</ul><h3 id="composite-index-approach"><span class="mr-2">Composite Index Approach</span><a href="#composite-index-approach" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="k">DROP</span> <span class="k">INDEX</span> <span class="n">a_idx</span><span class="p">,</span> <span class="n">b_idx</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">a_b_idx</span> <span class="k">ON</span> <span class="n">test</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
</pre></table></code></div></div><p><strong>Composite Index Behavior:</strong></p><ul><li>It does better job then doing AND on a and b or search on a <code class="language-plaintext highlighter-rouge">but not search on b.</code><li>It is a limitation of Postgres that for a composite key, it will use the index when both column is involved or only left side of the key column (<code class="language-plaintext highlighter-rouge">a</code> in our case) but not right side of the key column (<code class="language-plaintext highlighter-rouge">b</code> in our case will not use index if queried).<li>For <code class="language-plaintext highlighter-rouge">b</code>-only queries, PostgreSQL will use a full table scan in parallel.<li>If you want have faster scan for b column, you can separate index so in case for query involving b column, it will use index specific for b column.<li>The advantage for this approach is, in case of <code class="language-plaintext highlighter-rouge">OR</code> operation, DB will use composite index when scanning for rows for a column and use b_idx for b column when scanning for rows for B column.<li>It will leverage both index to avoid full table scan.</ul><p><strong>Best Practice:</strong></p><ul><li>For frequently queried columns, maintain separate indexes<li>For <code class="language-plaintext highlighter-rouge">OR</code> operations, database will use appropriate indexes for each column<li>This approach leverages both indexes to avoid full table scans</ul><h2 id="database-optimizer-strategies"><span class="mr-2">Database Optimizer Strategies</span><a href="#database-optimizer-strategies" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><em>Reference:</em> <a href="/assets/document/attachment/database-engineering-fundamental-part-1//multiple-indexes.pdf">multiple-indexes.pdf</a></p><h2 id="creating-indexes-concurrently"><span class="mr-2">Creating Indexes Concurrently</span><a href="#creating-indexes-concurrently" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="standard-index-creation"><span class="mr-2">Standard Index Creation</span><a href="#standard-index-creation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">idx</span> <span class="k">ON</span> <span class="n">grade</span><span class="p">(</span><span class="k">g</span><span class="p">);</span>
</pre></table></code></div></div><ul><li>Blocks write operations<li>Allows read operations<li>Makes application partially unusable during creation</ul><h3 id="concurrent-index-creation"><span class="mr-2">Concurrent Index Creation</span><a href="#concurrent-index-creation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">CONCURRENTLY</span> <span class="k">g</span> <span class="k">ON</span> <span class="n">grades</span><span class="p">(</span><span class="k">g</span><span class="p">);</span>
</pre></table></code></div></div><p><strong>Benefits:</strong></p><ul><li>Allows index creation alongside write operations<li>Waits for transaction completion before proceeding<li>Application remains fully functional</ul><p><strong>Drawbacks:</strong></p><ul><li>Slower index creation process<li>Will fail if there are constraint violations<li>Risk of failure increases as application continues adding records</ul><h2 id="bloom-filters"><span class="mr-2">Bloom Filters</span><a href="#bloom-filters" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><em>Reference:</em> <a href="/assets/document/attachment/database-engineering-fundamental-part-1//bloom-filter.pdf">bloom-filter.pdf</a></p><h2 id="working-with-billion-row-tables"><span class="mr-2">Working with Billion-Row Tables</span><a href="#working-with-billion-row-tables" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="approach-1-brute-force"><span class="mr-2">Approach 1: Brute Force</span><a href="#approach-1-brute-force" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Full scan table with parallel workers<li>Not practical - database will be very slow</ul><h3 id="approach-2-indexing"><span class="mr-2">Approach 2: Indexing</span><a href="#approach-2-indexing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Reduces search from billions to millions of rows<li>Significant performance improvement</ul><h3 id="approach-3-partitioning"><span class="mr-2">Approach 3: Partitioning</span><a href="#approach-3-partitioning" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Slice table into smaller parts<li>Apply indexing to each partition<li>Each partition can be replicated across different nodes<li>Further narrows down search space</ul><h3 id="approach-4-sharding--partitioning"><span class="mr-2">Approach 4: Sharding + Partitioning</span><a href="#approach-4-sharding--partitioning" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Multiple shards, each with multiple partitions<li>Each partition has indexing for efficient searching<li>Reduces search space to few thousand records</ul><p><strong>Last Resort:</strong></p><ul><li>If none of the above works, use MapReduce<li>Process all records in parallel</ul><h2 id="related-articles"><span class="mr-2">Related Articles</span><a href="#related-articles" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><a href="the-cost-of-long-running-transactions"><strong>Article - The Cost of Long running Transactions</strong></a><li><a href="microsoft-sql-server-clustered-index-des"><strong>Article - Microsoft SQL Server Clustered Index Design</strong></a><li><a href="database-page"><strong>Database Page</strong></a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/blogging/'>Blogging</a>, <a href='/categories/article/'>Article</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/softwareengineering/" class="post-tag no-text-decoration" >softwareengineering</a> <a href="/tags/backenddevelopment/" class="post-tag no-text-decoration" >backenddevelopment</a> <a href="/tags/database-engineering/" class="post-tag no-text-decoration" >database-engineering</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Part+1%3A+Database+Engineering+Fundamentals+-+Pravin+on+Software&url=https%3A%2F%2Fpravin.dev%2Fdatabase-engineering-fundamental-part-1%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Part+1%3A+Database+Engineering+Fundamentals+-+Pravin+on+Software&u=https%3A%2F%2Fpravin.dev%2Fdatabase-engineering-fundamental-part-1%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fpravin.dev%2Fdatabase-engineering-fundamental-part-1%2F&text=Part+1%3A+Database+Engineering+Fundamentals+-+Pravin+on+Software" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fpravin.dev%2Fdatabase-engineering-fundamental-part-1%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/database-engineering-fundamental-part-2/">Part 2: Database Engineering Fundamentals</a><li><a href="/posts/system-design-roadmap/">Comprehensive Roadmap for Low-Level and High-Level Design Interview Preparation</a><li><a href="/database-engineering-fundamental-part-5/write-amplification-problem-in-postgresql/">Part 5: Database Engineering Fundamentals: Write Amplification Problem in PostgreSQL</a><li><a href="/database-engineering-fundamental-part-1/">Part 1: Database Engineering Fundamentals</a><li><a href="/database-engineering-fundamental-part-1/database-page/">Part 1: Database Engineering Fundamentals: Database Page</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/backenddevelopment/">backenddevelopment</a> <a class="post-tag" href="/tags/softwareengineering/">softwareengineering</a> <a class="post-tag" href="/tags/database-engineering/">database-engineering</a> <a class="post-tag" href="/tags/design/">design</a> <a class="post-tag" href="/tags/coding/">coding</a> <a class="post-tag" href="/tags/smells/">smells</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/nodejs/">nodejs</a> <a class="post-tag" href="/tags/softwaredevelopment/">softwaredevelopment</a> <a class="post-tag" href="/tags/aws/">aws</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/database-engineering-fundamental-part-5/write-amplification-problem-in-postgresql/"><div class="card-body"> <em class="small" data-ts="1720157400" data-df="ll" > Jul 5, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Part 5: Database Engineering Fundamentals: Write Amplification Problem in PostgreSQL</h3><div class="text-muted small"><p> Write Amplification Problem in PostgreSQL Write Amplification Problem in PostgreSQL The Write Amplification Problem (WAP) typically arises in systems using Solid State Drives (SSDs) or other stor...</p></div></div></a></div><div class="card"> <a href="/database-engineering-fundamental-part-1/database-page/"><div class="card-body"> <em class="small" data-ts="1719779400" data-df="ll" > Jul 1, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Part 1: Database Engineering Fundamentals: Database Page</h3><div class="text-muted small"><p> Databases Pages (Article) Database Pages — A deep dive Databases often use fixed-size pages to store data. Tables, collections, rows, columns, indexes, sequences, documents and more eventually en...</p></div></div></a></div><div class="card"> <a href="/database-engineering-fundamental-part-1/microsoft-sql-server-clustered-index-des/"><div class="card-body"> <em class="small" data-ts="1719783000" data-df="ll" > Jul 1, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Part 1: Database Engineering Fundamentals: Microsoft SQL Server Clustered Index Design</h3><div class="text-muted small"><p> Article - Microsoft SQL Server Clustered Index Design This is one of the most interesting documentation pages I have read and I really thought I would share it with you. You can read the entire de...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/system-design-roadmap/" class="btn btn-outline-primary" prompt="Older"><p>Comprehensive Roadmap for Low-Level and High-Level Design Interview Preparation</p></a> <a href="/database-engineering-fundamental-part-1/database-page/" class="btn btn-outline-primary" prompt="Newer"><p>Part 1: Database Engineering Fundamentals: Database Page</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://pravin.dev/database-engineering-fundamental-part-1/'; this.page.identifier = '/database-engineering-fundamental-part-1/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://pravin-dev.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://www.linkedin.com/in/pravin-r-tripathi">Pravin Tripathi</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/backenddevelopment/">backenddevelopment</a> <a class="post-tag" href="/tags/softwareengineering/">softwareengineering</a> <a class="post-tag" href="/tags/database-engineering/">database-engineering</a> <a class="post-tag" href="/tags/design/">design</a> <a class="post-tag" href="/tags/coding/">coding</a> <a class="post-tag" href="/tags/smells/">smells</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/nodejs/">nodejs</a> <a class="post-tag" href="/tags/softwaredevelopment/">softwaredevelopment</a> <a class="post-tag" href="/tags/aws/">aws</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-WP90FFJ6SJ"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-WP90FFJ6SJ'); }); </script>
